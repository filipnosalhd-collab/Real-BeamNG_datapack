<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>BeamNG Drive - Datapack PL</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #1a1a2e 0%,
          #16213e 50%,
          #0f3460 100%
        );
        min-height: 100vh;
        color: #fff;
        padding: 10px;
        transition: background 0.5s ease;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        padding: 20px;
        padding-top: 50px;
        background: rgba(0, 0, 0, 0.4);
        border-radius: 15px;
        margin-bottom: 15px;
        border: 2px solid #ff6b35;
        position: relative;
      }

      header h1 {
        font-size: clamp(1.5em, 5vw, 2.2em);
        color: #ff6b35;
        text-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
      }

      header h2 {
        font-size: clamp(0.9em, 3vw, 1.1em);
        color: #ffd700;
      }

      .header-btns-left,
      .header-btns-right {
        position: absolute;
        top: 10px;
        display: flex;
        gap: 5px;
      }

      .header-btns-left {
        left: 10px;
      }

      .header-btns-right {
        right: 10px;
      }

      .lang-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid #555;
        color: #fff;
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1em;
        min-width: 44px;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .lang-btn:hover,
      .lang-btn:active {
        background: rgba(255, 255, 255, 0.2);
      }

      @media (max-width: 400px) {
        .lang-btn {
          padding: 6px 10px;
          font-size: 1em;
          min-width: 40px;
          min-height: 40px;
        }

        header {
          padding-top: 45px;
        }
      }

      .money-display {
        background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        margin-bottom: 15px;
        border: 2px solid #444;
      }

      .money-display h3 {
        color: #888;
        font-size: 0.9em;
        margin-bottom: 5px;
      }

      .money-amount {
        font-size: clamp(2em, 8vw, 3em);
        font-weight: bold;
        color: #4ade80;
        text-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
      }

      .money-amount.low {
        color: #f87171;
      }

      .debt-display {
        background: rgba(239, 68, 68, 0.2);
        border: 2px solid #ef4444;
        border-radius: 10px;
        padding: 10px;
        margin-top: 10px;
        display: none;
      }

      .debt-display.active {
        display: block;
      }

      .debt-display h4 {
        color: #ef4444;
        font-size: 0.9em;
      }

      .debt-amount {
        font-size: 1.5em;
        color: #ef4444;
        font-weight: bold;
      }

      .debt-deadline {
        font-size: 0.8em;
        color: #f87171;
      }

      .buttons-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-bottom: 15px;
      }

      .btn {
        padding: 15px 10px;
        font-size: clamp(0.85em, 2.5vw, 1em);
        font-weight: bold;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      }

      .btn:active {
        transform: scale(0.98);
      }

      .btn-icon {
        font-size: 1.8em;
      }

      .btn-instruction {
        background: linear-gradient(145deg, #3b82f6, #2563eb);
        color: white;
      }
      .btn-repair {
        background: linear-gradient(145deg, #f59e0b, #d97706);
        color: white;
      }
      .btn-buy {
        background: linear-gradient(145deg, #10b981, #059669);
        color: white;
      }
      .btn-sell {
        background: linear-gradient(145deg, #ec4899, #db2777);
        color: white;
      }
      .btn-earn {
        background: linear-gradient(145deg, #8b5cf6, #7c3aed);
        color: white;
      }
      .btn-tax {
        background: linear-gradient(145deg, #ef4444, #dc2626);
        color: white;
      }
      .btn-card {
        background: linear-gradient(145deg, #06b6d4, #0891b2);
        color: white;
      }
      .btn-inventory {
        background: linear-gradient(145deg, #f59e0b, #d97706);
        color: white;
      }
      .btn-shop {
        background: linear-gradient(145deg, #10b981, #059669);
        color: white;
      }
      .btn-insurance {
        background: linear-gradient(145deg, #ec4899, #db2777);
        color: white;
      }

      /* Paski statusu */
      .status-bars {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 12px 15px;
        margin-bottom: 15px;
      }

      .status-bar {
        margin: 8px 0;
      }

      .status-bar:first-child {
        margin-top: 0;
      }
      .status-bar:last-child {
        margin-bottom: 0;
      }

      .status-label {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.8em;
        margin-bottom: 4px;
        color: #ccc;
      }

      .status-track {
        background: rgba(0, 0, 0, 0.4);
        border-radius: 8px;
        height: 16px;
        overflow: hidden;
      }

      .status-fill {
        height: 100%;
        border-radius: 8px;
        transition: width 0.3s ease;
      }

      .status-fill.health {
        background: linear-gradient(90deg, #ef4444, #f87171);
      }
      .status-fill.food {
        background: linear-gradient(90deg, #f59e0b, #fbbf24);
      }
      .status-fill.water {
        background: linear-gradient(90deg, #3b82f6, #60a5fa);
      }

      .status-value {
        font-size: 0.7em;
        color: #888;
        text-align: right;
        margin-top: 2px;
      }

      /* Sklep/Ekwipunek */
      .shop-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        max-height: 350px;
        overflow-y: auto;
        padding: 5px;
      }

      .shop-item {
        background: rgba(255, 255, 255, 0.08);
        border: 2px solid #444;
        border-radius: 12px;
        padding: 10px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
      }

      .shop-item:hover {
        border-color: #ff6b35;
        background: rgba(255, 107, 53, 0.15);
        transform: scale(1.02);
      }

      .shop-item .item-icon {
        font-size: 1.8em;
      }
      .shop-item .item-name {
        font-weight: bold;
        font-size: 0.85em;
        margin: 5px 0;
      }
      .shop-item .item-stats {
        font-size: 0.7em;
        color: #aaa;
        line-height: 1.3;
      }
      .shop-item .item-stats .positive {
        color: #4ade80;
      }
      .shop-item .item-stats .negative {
        color: #f87171;
      }
      .shop-item .item-price {
        margin-top: 6px;
        font-weight: bold;
        color: #ff6b35;
        font-size: 0.9em;
      }

      .inventory-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }

      .inv-tab {
        flex: 1;
        padding: 10px 5px;
        border: none;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.1);
        color: #888;
        font-weight: bold;
        cursor: pointer;
        font-size: 0.85em;
        transition: all 0.2s;
      }

      .inv-tab.active {
        background: #ff6b35;
        color: white;
      }

      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 10px;
        overflow-y: auto;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
        border-radius: 15px;
        padding: 20px;
        max-width: 450px;
        width: calc(100% - 20px);
        margin: 10px;
        border: 2px solid #ff6b35;
        max-height: 90vh;
        overflow-y: auto;
      }

      @media (max-width: 480px) {
        .modal-content {
          padding: 15px;
          border-radius: 12px;
        }
      }

      .modal-content h2 {
        color: #ff6b35;
        text-align: center;
        margin-bottom: 15px;
        font-size: clamp(1.3em, 4vw, 1.6em);
      }

      .modal-close {
        background: #ef4444;
        color: white;
        border: none;
        padding: 12px;
        border-radius: 10px;
        font-size: 1em;
        cursor: pointer;
        width: 100%;
        margin-top: 15px;
      }

      .instruction-section {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 12px;
        margin-bottom: 12px;
      }

      .instruction-section h3 {
        color: #ffd700;
        margin-bottom: 8px;
        font-size: 1em;
      }

      .instruction-section ul {
        list-style: none;
      }

      .instruction-section li {
        padding: 6px 0;
        border-bottom: 1px solid #333;
        display: flex;
        justify-content: space-between;
        font-size: 0.9em;
      }

      .instruction-section li:last-child {
        border-bottom: none;
      }

      .price.earn {
        color: #4ade80;
        font-weight: bold;
      }
      .price.cost {
        color: #f87171;
        font-weight: bold;
      }

      .upload-section {
        text-align: center;
      }

      .upload-section > p {
        color: #aaa;
        margin-bottom: 10px;
        font-size: 0.9em;
      }

      .upload-area {
        border: 3px dashed #555;
        border-radius: 15px;
        padding: 25px 15px;
        margin: 10px 0;
        cursor: pointer;
        transition: all 0.3s;
      }

      .upload-area:hover,
      .upload-area.dragover {
        border-color: #ff6b35;
        background: rgba(255, 107, 53, 0.1);
      }

      .upload-icon {
        font-size: 2.5em;
        margin-bottom: 5px;
      }

      .preview-image {
        max-width: 100%;
        max-height: 150px;
        border-radius: 10px;
        margin: 10px 0;
        object-fit: contain;
      }

      .ai-response {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        margin: 10px 0;
        text-align: center;
        display: none;
      }

      .ai-response.active {
        display: block;
      }

      .ai-response .loader {
        width: 35px;
        height: 35px;
        border: 3px solid #333;
        border-top-color: #ff6b35;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .ai-response .result-icon {
        font-size: 2.5em;
        margin-bottom: 5px;
      }

      .ai-response .result-text {
        font-size: 1em;
        margin-bottom: 5px;
      }

      .ai-response .result-amount {
        font-size: 2em;
        font-weight: bold;
      }

      .ai-response .result-amount.cost {
        color: #f87171;
      }
      .ai-response .result-amount.earn {
        color: #4ade80;
      }

      .qr-section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 20px;
        margin: 15px 0;
        text-align: center;
      }

      .qr-section h4 {
        color: #1a1a2e;
        margin-bottom: 10px;
        font-size: 1em;
      }

      .qr-section p {
        color: #666;
        font-size: 0.85em;
        margin-bottom: 15px;
      }

      #qrcode,
      .qr-container {
        display: flex;
        justify-content: center;
        margin: 10px 0;
      }

      .qr-status {
        margin-top: 15px;
        padding: 10px;
        border-radius: 8px;
        font-weight: bold;
      }

      .qr-status.waiting {
        background: rgba(251, 191, 36, 0.2);
        color: #f59e0b;
      }

      .qr-status.success {
        background: rgba(74, 222, 128, 0.2);
        color: #22c55e;
      }

      .qr-status.rejected {
        background: rgba(248, 113, 113, 0.2);
        color: #ef4444;
      }

      .garage-item {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid #444;
        border-radius: 10px;
        padding: 12px;
        margin: 8px 0;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .garage-item:hover {
        border-color: #ff6b35;
        background: rgba(255, 107, 53, 0.1);
      }

      .garage-item.selected {
        border-color: #4ade80;
        background: rgba(74, 222, 128, 0.1);
      }

      .garage-item .car-name {
        font-weight: bold;
        font-size: 1.1em;
      }

      .garage-item .car-price {
        color: #4ade80;
        font-size: 0.9em;
      }

      .verify-page {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        text-align: center;
      }

      .verify-page img {
        max-width: 100%;
        max-height: 300px;
        border-radius: 15px;
        margin: 20px 0;
        border: 3px solid #ff6b35;
      }

      .verify-page h2 {
        color: #ff6b35;
        margin-bottom: 10px;
      }

      .verify-page p {
        color: #aaa;
        margin-bottom: 20px;
        font-size: 1.1em;
      }

      .verify-buttons {
        display: flex;
        gap: 15px;
        margin-top: 20px;
      }

      .verify-btn {
        padding: 15px 40px;
        font-size: 1.2em;
        font-weight: bold;
        border: none;
        border-radius: 12px;
        cursor: pointer;
      }

      .verify-btn.yes {
        background: linear-gradient(145deg, #4ade80, #22c55e);
        color: white;
      }

      .verify-btn.no {
        background: linear-gradient(145deg, #f87171, #ef4444);
        color: white;
      }

      .verify-result {
        font-size: 3em;
        margin: 30px 0;
      }

      .confirm-btn {
        background: linear-gradient(145deg, #4ade80, #22c55e);
        color: white;
        border: none;
        padding: 12px;
        border-radius: 10px;
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        margin-top: 10px;
        display: none;
      }

      .confirm-btn.active {
        display: block;
      }

      .confirm-btn.pay {
        background: linear-gradient(145deg, #f87171, #ef4444);
      }

      .beam-pay-card {
        width: 100%;
        aspect-ratio: 1.6;
        border-radius: 15px;
        background: linear-gradient(
          135deg,
          #1e40af,
          #3b82f6,
          #60a5fa,
          #3b82f6,
          #1e40af
        );
        background-size: 400% 400%;
        animation: cardShine 3s ease infinite;
        padding: 20px;
        position: relative;
        box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        overflow: hidden;
      }

      @keyframes cardShine {
        0%,
        100% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
      }

      .card-logo {
        font-size: 1.2em;
        font-weight: bold;
        color: #fff;
      }

      .card-code {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: clamp(1.5em, 6vw, 2.2em);
        font-weight: bold;
        color: #fff;
        letter-spacing: 8px;
        font-family: "Courier New", monospace;
      }

      .card-balance {
        position: absolute;
        bottom: 15px;
        right: 20px;
        text-align: right;
      }

      .card-balance .label {
        font-size: 0.7em;
        color: rgba(255, 255, 255, 0.7);
      }

      .card-balance .amount {
        font-size: 1.2em;
        font-weight: bold;
        color: #fff;
      }

      .card-settings {
        margin-top: 15px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 12px;
      }

      .card-settings h4 {
        color: #ffd700;
        margin-bottom: 10px;
        font-size: 0.95em;
      }

      .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #333;
        font-size: 0.9em;
      }

      .setting-row:last-child {
        border-bottom: none;
      }

      .setting-label {
        color: #aaa;
      }
      .setting-value {
        font-weight: bold;
        color: #fff;
      }

      .limit-bar {
        width: 100%;
        height: 8px;
        background: #333;
        border-radius: 4px;
        margin-top: 8px;
        overflow: hidden;
      }

      .limit-fill {
        height: 100%;
        background: linear-gradient(90deg, #4ade80, #fbbf24, #ef4444);
        transition: width 0.3s;
      }

      .card-btn {
        background: linear-gradient(145deg, #8b5cf6, #7c3aed);
        color: white;
        border: none;
        padding: 10px;
        border-radius: 8px;
        font-size: 0.85em;
        cursor: pointer;
        margin-top: 8px;
        width: 100%;
      }

      .tax-info {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid #ef4444;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
      }

      .tax-info h4 {
        color: #ef4444;
        margin-bottom: 10px;
      }

      .tax-stat {
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
        font-size: 0.9em;
      }

      .tax-toggle {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(255, 255, 255, 0.05);
        padding: 12px;
        border-radius: 10px;
        margin: 10px 0;
      }

      .toggle-switch {
        width: 50px;
        height: 26px;
        background: #333;
        border-radius: 13px;
        position: relative;
        cursor: pointer;
        transition: background 0.3s;
      }

      .toggle-switch.active {
        background: #4ade80;
      }

      .toggle-switch::after {
        content: "";
        position: absolute;
        width: 22px;
        height: 22px;
        background: #fff;
        border-radius: 50%;
        top: 2px;
        left: 2px;
        transition: transform 0.3s;
      }

      .toggle-switch.active::after {
        transform: translateX(24px);
      }

      .pin-display {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin: 15px 0;
      }

      .pin-digit {
        width: 40px;
        height: 50px;
        background: #1a1a1a;
        border: 2px solid #444;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5em;
        font-weight: bold;
        color: #fff;
      }

      .pin-digit.filled {
        border-color: #4ade80;
      }

      .pin-keypad {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        max-width: 220px;
        margin: 0 auto;
      }

      .pin-key {
        padding: 12px;
        font-size: 1.3em;
        border: none;
        border-radius: 8px;
        background: #333;
        color: #fff;
        cursor: pointer;
      }

      .pin-key:active {
        transform: scale(0.95);
      }

      .pin-key.delete {
        background: #ef4444;
      }
      .pin-key.confirm {
        background: #4ade80;
      }

      .lang-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        max-height: 400px;
        overflow-y: auto;
      }

      .lang-option {
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid #333;
        border-radius: 8px;
        cursor: pointer;
        text-align: center;
        font-size: 0.85em;
        transition: all 0.2s;
      }

      .lang-option:hover,
      .lang-option.selected {
        border-color: #ff6b35;
        background: rgba(255, 107, 53, 0.2);
      }

      .input-group {
        margin: 10px 0;
      }

      .input-group label {
        display: block;
        color: #aaa;
        margin-bottom: 5px;
        font-size: 0.9em;
      }

      .input-group input {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 2px solid #444;
        background: #1a1a1a;
        color: #fff;
        font-size: 1.1em;
        text-align: center;
      }

      .input-group input:focus {
        outline: none;
        border-color: #ff6b35;
      }

      .ocr-progress {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        height: 6px;
        margin-top: 10px;
        overflow: hidden;
      }

      .ocr-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #ff6b35, #ffd700);
        width: 0%;
        transition: width 0.3s;
      }

      @media (max-width: 400px) {
        .buttons-grid {
          gap: 8px;
        }

        .btn {
          padding: 12px 8px;
        }

        .btn-icon {
          font-size: 1.5em;
        }

        .pin-digit {
          width: 35px;
          height: 45px;
          font-size: 1.3em;
        }

        .pin-keypad {
          max-width: 180px;
        }

        .pin-key {
          padding: 10px;
          font-size: 1.1em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-btns-left">
          <button class="lang-btn" onclick="openModal('saves')" title="Save'y">
            ğŸ’¾
          </button>
          <button class="lang-btn" onclick="openModal('vouchers')" title="Bony">
            ğŸ
          </button>
        </div>
        <div class="header-btns-right">
          <button
            class="lang-btn"
            onclick="openModal('language')"
            title="JÄ™zyk"
          >
            ğŸŒ
          </button>
        </div>
        <div onclick="openModal('gameMode')" style="cursor: pointer">
          <h1 id="gameModeTitle">ğŸš— BeamNG Drive</h1>
          <h2 id="gameModeSubtitle">Datapack</h2>
        </div>
        <div
          id="currentSaveDisplay"
          style="font-size: 0.8em; color: #888; margin-top: 5px"
        ></div>
      </header>

      <div class="money-display">
        <h3>ğŸ’° <span data-translate="yourMoney">TWOJE PIENIÄ„DZE</span></h3>
        <div class="money-amount" id="moneyDisplay">50 000 zÅ‚</div>

        <div class="debt-display" id="debtDisplay">
          <h4>âš ï¸ <span data-translate="debt">DÅUG</span></h4>
          <div class="debt-amount" id="debtAmount">0 zÅ‚</div>
          <div class="debt-deadline" id="debtDeadline"></div>
        </div>
      </div>

      <!-- Paski statusu -->
      <div class="status-bars">
        <div class="status-bar">
          <div class="status-label">
            â¤ï¸ <span data-translate="health">Zdrowie</span>
          </div>
          <div class="status-track">
            <div
              class="status-fill health"
              id="healthBar"
              style="width: 100%"
            ></div>
          </div>
          <div class="status-value" id="healthValue">100/100</div>
        </div>
        <div class="status-bar">
          <div class="status-label">
            ğŸ” <span data-translate="food">Jedzenie</span>
          </div>
          <div class="status-track">
            <div
              class="status-fill food"
              id="foodBar"
              style="width: 100%"
            ></div>
          </div>
          <div class="status-value" id="foodValue">1000/1000 kcal</div>
        </div>
        <div class="status-bar">
          <div class="status-label">
            ğŸ’§ <span data-translate="water">Picie</span>
          </div>
          <div class="status-track">
            <div
              class="status-fill water"
              id="waterBar"
              style="width: 100%"
            ></div>
          </div>
          <div class="status-value" id="waterValue">1000/1000 ml</div>
        </div>
      </div>

      <div class="buttons-grid">
        <button class="btn btn-instruction" onclick="openModal('instruction')">
          <span class="btn-icon">ğŸ“–</span>
          <span data-translate="instructions">Instrukcja</span>
        </button>
        <button class="btn btn-earn" onclick="openModal('work')">
          <span class="btn-icon">ğŸ’¼</span>
          <span data-translate="work">Praca</span>
        </button>
        <button class="btn btn-repair" onclick="openModal('repair')">
          <span class="btn-icon">ğŸ”§</span>
          <span data-translate="repair">Napraw Auto</span>
        </button>
        <button class="btn btn-buy" onclick="openModal('buy')">
          <span class="btn-icon">ğŸš™</span>
          <span data-translate="buyCar">Kup Auto</span>
        </button>
        <button class="btn btn-sell" onclick="openModal('sell')">
          <span class="btn-icon">ğŸ’¸</span>
          <span data-translate="sellCar">Sprzedaj Auto</span>
        </button>
        <button class="btn btn-shop" onclick="openModal('shop')">
          <span class="btn-icon">ğŸ›’</span>
          <span data-translate="shop">Sklep</span>
        </button>
        <button class="btn btn-inventory" onclick="openModal('inventory')">
          <span class="btn-icon">ğŸ’</span>
          <span data-translate="inventory">Ekwipunek</span>
        </button>
        <button
          class="btn"
          onclick="openModal('garage')"
          style="background: linear-gradient(145deg, #6366f1, #4f46e5)"
        >
          <span class="btn-icon">ğŸš—</span>
          <span data-translate="garage">GaraÅ¼</span>
        </button>
        <button class="btn btn-insurance" onclick="openModal('insurance')">
          <span class="btn-icon">ğŸ¥</span>
          <span data-translate="insurance">Ubezpieczenia</span>
        </button>
        <button class="btn btn-tax" onclick="openModal('tax')">
          <span class="btn-icon">ğŸ›ï¸</span>
          <span data-translate="taxes">Podatki</span>
        </button>
        <button class="btn btn-card" onclick="openModal('card')">
          <span class="btn-icon">ğŸ’³</span>
          <span data-translate="card">Karta Beam-Pay</span>
        </button>
      </div>
    </div>

    <!-- Modal Instrukcja -->
    <div class="modal" id="modalInstruction">
      <div class="modal-content">
        <h2>ğŸ“– <span data-translate="instructions">Instrukcja</span></h2>

        <div style="max-height: 60vh; overflow-y: auto; padding-right: 10px">
          <div class="instruction-section">
            <h3>ğŸ’¼ <span data-translate="workSystem">System pracy</span></h3>
            <p
              style="color: #aaa; font-size: 0.9em; margin-bottom: 10px"
              data-translate="workDesc"
            >
              Wybierz zawÃ³d i pracuj 2 minuty w mini-grze:
            </p>
            <ul style="list-style: none; padding: 0">
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 4px;
                  "
                >
                  <span>ğŸ§¹ SprzÄ…tacz â†’ ğŸ‘¨â€âš•ï¸ Chirurg</span>
                  <span style="color: #4ade80">500 - 7000 zÅ‚</span>
                </div>
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="jobsRange"
                  >13 zawodÃ³w od Å‚atwych do trudnych</span
                >
              </li>
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <div style="color: #f59e0b; margin-bottom: 4px">
                  ğŸ’° <span data-translate="coinGame">Åapanie monet</span>
                </div>
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="coinGameDesc"
                  >Klikaj spadajÄ…ce monety +100 zÅ‚ za kaÅ¼dÄ…!</span
                >
              </li>
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <div style="color: #ef4444; margin-bottom: 4px">
                  ğŸ˜´ <span data-translate="sleepMechanic">Zasypianie</span>
                </div>
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="sleepMechanicDesc"
                  >Trzymaj ekran Å¼eby nie zasnÄ…Ä‡! Spanie = strata do 90%
                  zarobku</span
                >
              </li>
            </ul>
          </div>

          <div class="instruction-section">
            <h3>ğŸš— <span data-translate="garageSystem">System garaÅ¼u</span></h3>
            <p
              style="color: #aaa; font-size: 0.9em; margin-bottom: 10px"
              data-translate="garageDesc"
            >
              Kupuj, ulepszaj i sprzedawaj auta:
            </p>
            <ul style="list-style: none; padding: 0">
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <div style="color: #6366f1; margin-bottom: 4px">
                  â¬†ï¸ <span data-translate="upgrading">Ulepszanie</span>
                </div>
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="upgradeInfo"
                  >Kliknij raz - auto ulepsza siÄ™ w tle. WartoÅ›Ä‡ roÅ›nie (50% â†’
                  1000%)</span
                >
              </li>
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <div style="color: #ef4444; margin-bottom: 4px">
                  ğŸ’¥ <span data-translate="breakRisk">Ryzyko zepsucia</span>
                </div>
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="breakInfo"
                  >0.5%/s szansy na zepsucie. Koszt: 150 zÅ‚ + -5% wartoÅ›ci</span
                >
              </li>
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <div style="color: #10b981; margin-bottom: 4px">
                  ğŸ’° <span data-translate="selling">SprzedaÅ¼</span>
                </div>
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="sellInfo"
                  >Cena = cena bazowa Ã— procent ulepszenia</span
                >
              </li>
            </ul>
          </div>

          <div class="instruction-section">
            <h3>
              ğŸ’³ <span data-translate="payments">PÅ‚atnoÅ›ci i opÅ‚aty</span>
            </h3>
            <ul style="list-style: none; padding: 0">
              <li
                style="
                  padding: 8px;
                  background: rgba(239, 68, 68, 0.1);
                  border-radius: 8px;
                  margin-bottom: 6px;
                  display: flex;
                  justify-content: space-between;
                  border: 1px solid #ef4444;
                "
              >
                <span>ğŸ›ï¸ <span data-translate="taxes">Podatki</span></span>
                <span style="color: #ef4444">-500 zÅ‚ / 5 min</span>
              </li>
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <div style="color: #f59e0b; margin-bottom: 4px">
                  âš¡ <span data-translate="autoPay">Auto-pÅ‚atnoÅ›Ä‡</span>
                </div>
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="autoPayInfo2"
                  >WÅ‚Ä…cz w ustawieniach karty - automatycznie pÅ‚aci podatki i
                  ubezpieczenia</span
                >
              </li>
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <div style="color: #ef4444; margin-bottom: 4px">
                  âš ï¸ <span data-translate="debtSystem">System dÅ‚ugÃ³w</span>
                </div>
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="debtInfo2"
                  >Brak kasy = dÅ‚ug. Masz 7 dni na spÅ‚atÄ™!</span
                >
              </li>
            </ul>
          </div>

          <div class="instruction-section">
            <h3>ğŸ›¡ï¸ <span data-translate="insurances">Ubezpieczenia</span></h3>
            <p
              style="color: #aaa; font-size: 0.9em; margin-bottom: 10px"
              data-translate="insuranceDesc"
            >
              RÃ³Å¼ne pakiety dajÄ…ce bonusy:
            </p>
            <ul style="list-style: none; padding: 0">
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <span style="color: #4ade80">â¤ï¸ğŸ”ğŸ’§</span>
                <span data-translate="healthIns">Zdrowotne</span> -
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="healthInsDesc"
                  >regeneracja HP, jedzenia, picia</span
                >
              </li>
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <span style="color: #6366f1">ğŸ”§âš™ï¸</span>
                <span data-translate="upgradeIns">Na ulepszanie</span> -
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="upgradeInsDesc"
                  >szybsze ulepszanie, mniejsza szansa zepsucia</span
                >
              </li>
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <span style="color: #f59e0b">ğŸ›¡ï¸ğŸ©¹</span>
                <span data-translate="repairIns">Na naprawÄ™</span> -
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="repairInsDesc"
                  >pokrywa 30-100% kosztÃ³w naprawy</span
                >
              </li>
            </ul>
          </div>

          <div class="instruction-section">
            <h3>â¤ï¸ <span data-translate="survival">Przetrwanie</span></h3>
            <ul style="list-style: none; padding: 0">
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <span style="color: #ef4444"
                  >ğŸ” <span data-translate="hungerDrain">GÅ‚Ã³d</span>:</span
                >
                <span style="color: #888; font-size: 0.85em"
                  >-10 kcal / 5 min</span
                >
              </li>
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <span style="color: #3b82f6"
                  >ğŸ’§
                  <span data-translate="thirstDrain">Pragnienie</span>:</span
                >
                <span style="color: #888; font-size: 0.85em"
                  >-15 ml / 5 min</span
                >
              </li>
              <li
                style="
                  padding: 8px;
                  background: rgba(239, 68, 68, 0.2);
                  border-radius: 8px;
                  margin-bottom: 6px;
                  border: 1px solid #ef4444;
                "
              >
                <div style="color: #ef4444; margin-bottom: 4px">
                  ğŸ’€ <span data-translate="death">ÅšmierÄ‡</span>
                </div>
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="deathDesc"
                  >GÅ‚Ã³d/woda = 0 â†’ tracisz HP. HP = 0 â†’ zginiesz i wrÃ³cisz do
                  checkpointu!</span
                >
              </li>
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="survivalTip"
                  >Kupuj jedzenie i napoje w sklepie, lub wykup
                  ubezpieczenie!</span
                >
              </li>
            </ul>
          </div>

          <div class="instruction-section">
            <h3>
              ğŸ’¾
              <span data-translate="checkpointSystem">System checkpointÃ³w</span>
            </h3>
            <ul style="list-style: none; padding: 0">
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <div style="color: #10b981; margin-bottom: 4px">
                  ğŸ’¾
                  <span data-translate="createCheckpointInfo">Tworzenie</span>
                </div>
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="createCheckpointDesc"
                  >W menu Save'Ã³w kliknij "Zapisz checkpoint" Å¼eby zapisaÄ‡
                  aktualny postÄ™p</span
                >
              </li>
              <li
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 6px;
                "
              >
                <div style="color: #f59e0b; margin-bottom: 4px">
                  ğŸ”„ <span data-translate="respawn">Odrodzenie</span>
                </div>
                <span
                  style="color: #888; font-size: 0.85em"
                  data-translate="respawnDesc"
                  >Po Å›mierci wrÃ³cisz do checkpointu. Brak checkpointu = reset
                  postÄ™pu!</span
                >
              </li>
            </ul>
          </div>

          <div class="instruction-section">
            <h3>ğŸ <span data-translate="voucherSystem">System bonÃ³w</span></h3>
            <p
              style="color: #aaa; font-size: 0.9em"
              data-translate="voucherDesc"
            >
              TwÃ³rz bony pieniÄ™Å¼ne i wysyÅ‚aj znajomym przez WhatsApp, Messenger,
              Email lub SMS. PieniÄ…dze pobierane sÄ… dopiero gdy odbiorca
              zaakceptuje bon.
            </p>
          </div>

          <div class="instruction-section">
            <h3>ğŸ® <span data-translate="gameModes">Tryby gry</span></h3>
            <p
              style="color: #aaa; font-size: 0.9em"
              data-translate="gameModesDesc"
            >
              Kliknij tytuÅ‚ gry aby przeÅ‚Ä…czyÄ‡ miÄ™dzy trybem BeamNG (fikcyjne
              auta) a Real Life (prawdziwe marki). KaÅ¼dy tryb ma osobny postÄ™p!
            </p>
          </div>
        </div>

        <button
          class="modal-close"
          onclick="closeModal('instruction')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Zarobek -->
    <div class="modal" id="modalEarn">
      <div class="modal-content">
        <h2>ğŸ›£ï¸ <span data-translate="earnKm">Zarobek za kilometry</span></h2>

        <div class="upload-section">
          <div class="ai-response active" id="earnResponse">
            <div class="result-icon">ğŸ›£ï¸</div>
            <div class="result-text" data-translate="enterKm">
              Wpisz przejechane kilometry:
            </div>
            <input
              type="number"
              id="kmInput"
              step="0.1"
              min="0.1"
              style="
                width: 120px;
                padding: 12px;
                font-size: 1.2em;
                border-radius: 8px;
                border: 2px solid #ff6b35;
                text-align: center;
                margin: 10px 0;
                background: #1a1a2e;
                color: white;
              "
              placeholder="km"
            />
            <div style="color: #888; font-size: 0.9em">
              Ã— 100 zÅ‚ = <span id="kmCalc" style="color: #4ade80">0</span> zÅ‚
            </div>
          </div>

          <button class="confirm-btn" id="earnBtn" onclick="confirmEarn()">
            ğŸ’° <span data-translate="collectEarnings">Odbierz zarobek</span>
          </button>
        </div>

        <button
          class="modal-close"
          onclick="closeModal('earn')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Naprawa -->
    <div class="modal" id="modalRepair">
      <div class="modal-content">
        <h2>ğŸ”§ <span data-translate="repair">Napraw Auto</span></h2>

        <div class="upload-section">
          <p>
            <span data-translate="selectCarToRepair"
              >Wybierz auto do naprawy:</span
            >
          </p>

          <div
            id="repairCarList"
            style="max-height: 300px; overflow-y: auto; margin-bottom: 15px"
          ></div>

          <div class="ai-response" id="repairResponse" style="display: none">
            <div class="result-icon">ğŸ”§</div>
            <div class="result-text" data-translate="repairCostInfo">
              Koszt naprawy:
            </div>
            <div class="result-amount cost" id="repairCostDisplay">
              -5,000 zÅ‚
            </div>
          </div>

          <button
            class="confirm-btn pay"
            id="repairBtn"
            onclick="confirmRepair()"
            style="display: none"
          >
            ğŸ”§ <span data-translate="payAndRepair">ZapÅ‚aÄ‡ i napraw</span>
          </button>
        </div>

        <button
          class="modal-close"
          onclick="closeModal('repair')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Kup Auto -->
    <div class="modal" id="modalBuy">
      <div class="modal-content">
        <h2>ğŸš™ <span data-translate="buyCar">Kup Auto</span></h2>

        <!-- Wyszukiwarka -->
        <input
          type="text"
          id="carSearchInput"
          placeholder="ğŸ” Szukaj auta..."
          style="
            width: 100%;
            padding: 12px;
            font-size: 1em;
            border-radius: 10px;
            border: 2px solid #444;
            background: #1a1a2e;
            color: white;
            margin-bottom: 15px;
          "
          oninput="filterCars()"
        />

        <!-- Lista aut -->
        <div class="shop-grid" id="carBuyGrid" style="max-height: 400px"></div>

        <button
          class="modal-close"
          onclick="closeModal('buy')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Sprzedaj Auto -->
    <div class="modal" id="modalSell">
      <div class="modal-content">
        <h2>ğŸ’¸ <span data-translate="sellCar">Sprzedaj Auto</span></h2>

        <p
          style="color: #888; text-align: center; margin-bottom: 15px"
          data-translate="get50percent"
        >
          Dostaniesz 50% wartoÅ›ci
        </p>

        <div id="sellGarageSection">
          <div
            id="sellGarageList"
            style="max-height: 350px; overflow-y: auto"
          ></div>
        </div>

        <div
          id="sellEmptyGarage"
          style="text-align: center; padding: 30px; color: #888; display: none"
        >
          <div style="font-size: 3em">ğŸ…¿ï¸</div>
          <p data-translate="noCarInGarage">Nie masz Å¼adnych aut w garaÅ¼u</p>
        </div>

        <button
          class="modal-close"
          onclick="closeModal('sell')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Sklep -->
    <div class="modal" id="modalShop">
      <div class="modal-content">
        <h2>ğŸ›’ <span data-translate="shop">Sklep</span></h2>

        <!-- ZakÅ‚adki -->
        <div class="inventory-tabs">
          <button class="inv-tab active" onclick="showShopTab('food')">
            ğŸ” <span data-translate="foodTab">Jedzenie</span>
          </button>
          <button class="inv-tab" onclick="showShopTab('drinks')">
            ğŸ¥¤ <span data-translate="drinksTab">Napoje</span>
          </button>
        </div>

        <!-- Produkty do kupienia -->
        <div class="shop-grid" id="shopGrid"></div>

        <button
          class="modal-close"
          onclick="closeModal('shop')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Ekwipunek (Plecak) -->
    <!-- Modal GaraÅ¼ -->
    <div class="modal" id="modalGarage">
      <div class="modal-content">
        <h2>ğŸš— <span data-translate="garage">GaraÅ¼</span></h2>

        <div
          id="garageEmpty"
          style="text-align: center; padding: 30px; color: #888; display: none"
        >
          <div style="font-size: 3em">ğŸš—</div>
          <p data-translate="noCarInGarage">Brak aut w garaÅ¼u</p>
          <p
            style="font-size: 0.85em; margin-top: 5px"
            data-translate="buyCarFirst"
          >
            Kup auto w salonie!
          </p>
        </div>

        <div id="garageList" style="max-height: 60vh; overflow-y: auto"></div>

        <button
          class="modal-close"
          onclick="closeModal('garage')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Ulepszanie Auta -->
    <div class="modal" id="modalUpgrade">
      <div class="modal-content">
        <h2>ğŸ”§ <span data-translate="upgradeCar">Ulepszanie</span></h2>

        <div
          id="upgradeCarInfo"
          style="text-align: center; margin-bottom: 15px"
        ></div>

        <div
          style="
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
          "
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              margin-bottom: 10px;
            "
          >
            <span data-translate="sellValue">WartoÅ›Ä‡ sprzedaÅ¼y:</span>
            <span
              id="upgradeSellPercent"
              style="color: #4ade80; font-weight: bold"
              >50%</span
            >
          </div>
          <div
            style="
              width: 100%;
              height: 20px;
              background: #333;
              border-radius: 10px;
              overflow: hidden;
            "
          >
            <div
              id="upgradeProgressBar"
              style="
                width: 5%;
                height: 100%;
                background: linear-gradient(90deg, #ef4444, #f59e0b, #4ade80);
                transition: width 0.1s;
              "
            ></div>
          </div>
          <div
            style="
              display: flex;
              justify-content: space-between;
              font-size: 0.8em;
              color: #888;
              margin-top: 5px;
            "
          >
            <span>50%</span>
            <span>1000%</span>
          </div>
        </div>

        <div
          id="upgradeStatus"
          style="
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
          "
        ></div>

        <button
          id="upgradeBtn"
          onclick="toggleUpgrade()"
          style="
            width: 100%;
            padding: 15px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            margin-bottom: 10px;
          "
        >
          â–¶ï¸ <span data-translate="startUpgrade">Rozpocznij ulepszanie</span>
        </button>

        <div
          style="
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
          "
        >
          <p style="font-size: 0.85em; color: #ef4444; text-align: center">
            âš ï¸
            <span data-translate="upgradeWarning"
              >Podczas ulepszania auto moÅ¼e siÄ™ zepsuÄ‡! (150 zÅ‚ + -5%)</span
            >
          </p>
        </div>

        <button
          class="modal-close"
          onclick="closeUpgradeModal()"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Praca -->
    <div class="modal" id="modalWork">
      <div class="modal-content">
        <h2>ğŸ’¼ <span data-translate="work">Praca</span></h2>

        <p
          style="color: #888; text-align: center; margin-bottom: 15px"
          data-translate="chooseJob"
        >
          Wybierz pracÄ™:
        </p>

        <div id="jobsList" style="max-height: 50vh; overflow-y: auto"></div>

        <button
          class="modal-close"
          onclick="closeModal('work')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Mini-gra Praca -->
    <div class="modal" id="modalWorkGame">
      <div
        class="modal-content"
        style="
          max-width: 100%;
          width: 100%;
          height: 90vh;
          padding: 10px;
          position: relative;
          overflow: hidden;
        "
      >
        <div
          id="workGameHeader"
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
          "
        >
          <span
            id="workJobName"
            style="font-size: 1.2em; font-weight: bold"
          ></span>
          <span id="workTimer" style="font-size: 1.5em; color: #f59e0b"
            >2:00</span
          >
        </div>

        <div
          style="
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
          "
        >
          <span>ğŸ’° <span id="workEarned">0</span> zÅ‚</span>
          <span
            >ğŸ“ˆ +<span id="workBonus">0</span> zÅ‚
            <span data-translate="bonus">bonus</span></span
          >
        </div>

        <!-- Obszar gry -->
        <div
          id="workGameArea"
          style="
            position: relative;
            width: 100%;
            height: calc(100% - 120px);
            background: #1a1a2e;
            border-radius: 10px;
            overflow: hidden;
          "
        >
          <!-- Ciemnienie (zasypianie) -->
          <div
            id="sleepOverlayTop"
            style="
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              height: 0;
              background: linear-gradient(to bottom, #000, transparent);
              pointer-events: none;
              z-index: 10;
            "
          ></div>
          <div
            id="sleepOverlayBottom"
            style="
              position: absolute;
              bottom: 0;
              left: 0;
              right: 0;
              height: 0;
              background: linear-gradient(to top, #000, transparent);
              pointer-events: none;
              z-index: 10;
            "
          ></div>

          <!-- SpadajÄ…ce pieniÄ…dze -->
          <div
            id="coinsContainer"
            style="position: absolute; top: 0; left: 0; right: 0; bottom: 0"
          ></div>
        </div>

        <!-- Przycisk "nie zasypiaj" - trzeba TRZYMAÄ† -->
        <button
          id="wakeUpBtn"
          onmousedown="startWakeUp()"
          onmouseup="stopWakeUp()"
          onmouseleave="stopWakeUp()"
          ontouchstart="startWakeUp()"
          ontouchend="stopWakeUp()"
          style="
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 40px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            cursor: pointer;
            z-index: 20;
            user-select: none;
            -webkit-user-select: none;
          "
        >
          ğŸ‘ï¸ <span data-translate="stayAwake">Trzymaj Å¼eby nie zasnÄ…Ä‡!</span>
        </button>
      </div>
    </div>

    <div class="modal" id="modalInventory">
      <div class="modal-content">
        <h2>ğŸ’ <span data-translate="inventory">Ekwipunek</span></h2>

        <!-- Status gracza -->
        <div
          style="
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
          "
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              margin-bottom: 8px;
            "
          >
            <span>â¤ï¸ <span data-translate="health">Zdrowie</span></span>
            <span id="invHealth">100/100 HP</span>
          </div>
          <div
            style="
              display: flex;
              justify-content: space-between;
              margin-bottom: 8px;
            "
          >
            <span>ğŸ” <span data-translate="food">Jedzenie</span></span>
            <span id="invFood">1000/1000 kcal</span>
          </div>
          <div style="display: flex; justify-content: space-between">
            <span>ğŸ’§ <span data-translate="water">Picie</span></span>
            <span id="invWater">1000/1000 ml</span>
          </div>
        </div>

        <!-- ZawartoÅ›Ä‡ plecaka -->
        <h4 style="margin-bottom: 10px">
          ğŸ“¦ <span data-translate="backpackContents">ZawartoÅ›Ä‡ plecaka:</span>
        </h4>
        <div class="shop-grid" id="backpackGrid"></div>

        <div
          id="emptyBackpack"
          style="text-align: center; padding: 30px; color: #888; display: none"
        >
          <div style="font-size: 3em">ğŸ’</div>
          <p data-translate="emptyBackpack">Plecak jest pusty</p>
          <p
            style="font-size: 0.85em; margin-top: 5px"
            data-translate="goToShop"
          >
            IdÅº do sklepu kupiÄ‡ jedzenie!
          </p>
        </div>

        <button
          class="modal-close"
          onclick="closeModal('inventory')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Ubezpieczenia -->
    <div class="modal" id="modalInsurance">
      <div class="modal-content">
        <h2>ğŸ¥ <span data-translate="insurance">Ubezpieczenia</span></h2>

        <!-- Aktywne ubezpieczenia -->
        <div
          id="activeInsurancesSection"
          style="margin-bottom: 15px; display: none"
        >
          <h4 style="color: #4ade80; margin-bottom: 10px">
            âœ…
            <span data-translate="activeInsurances">Aktywne ubezpieczenia</span>
            (<span id="activeCount">0</span>)
          </h4>
          <div
            id="activeInsurancesList"
            style="max-height: 150px; overflow-y: auto"
          ></div>
        </div>

        <p
          style="color: #888; text-align: center; margin-bottom: 10px"
          data-translate="chooseInsurance"
        >
          Wybierz pakiet:
        </p>

        <!-- Lista pakietÃ³w -->
        <div
          id="insuranceList"
          style="max-height: 300px; overflow-y: auto"
        ></div>

        <button
          class="modal-close"
          onclick="closeModal('insurance')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal wyboru okresu ubezpieczenia -->
    <div class="modal" id="modalInsurancePeriod">
      <div class="modal-content">
        <h2>ğŸ“… <span data-translate="choosePeriod">Wybierz okres</span></h2>

        <div
          id="insurancePeriodDetails"
          style="text-align: center; margin-bottom: 15px"
        ></div>

        <div
          id="periodOptions"
          style="display: flex; flex-direction: column; gap: 10px"
        ></div>

        <button
          class="modal-close"
          onclick="closeModal('insurancePeriod')"
          data-translate="cancel"
        >
          Anuluj
        </button>
      </div>
    </div>

    <!-- Modal szczegÃ³Å‚Ã³w ubezpieczenia -->
    <div class="modal" id="modalInsuranceDetails">
      <div class="modal-content">
        <h2>ğŸ“‹ <span data-translate="insuranceDetails">SzczegÃ³Å‚y</span></h2>

        <div id="insuranceDetailsContent"></div>

        <button
          class="modal-close"
          onclick="closeModal('insuranceDetails')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Podatki -->
    <div class="modal" id="modalTax">
      <div class="modal-content">
        <h2>ğŸ›ï¸ <span data-translate="taxes">Podatki</span></h2>

        <div class="tax-info">
          <h4><span data-translate="taxInfo">Informacje o podatkach</span></h4>
          <div class="tax-stat">
            <span data-translate="taxRate">Stawka:</span>
            <span class="price cost">500 zÅ‚ / 5 min</span>
          </div>
          <div class="tax-stat">
            <span data-translate="totalPaid">ZapÅ‚acono Å‚Ä…cznie:</span>
            <span id="totalTaxPaid">0 zÅ‚</span>
          </div>
          <div class="tax-stat">
            <span data-translate="nextTax">NastÄ™pny podatek za:</span>
            <span id="nextTaxTime">10:00</span>
          </div>
        </div>

        <div class="tax-toggle">
          <div>
            <strong data-translate="autoPay">Automatyczne pÅ‚acenie</strong>
            <p
              style="font-size: 0.8em; color: #888"
              data-translate="autoPayDesc"
            >
              Karta pÅ‚aci automatycznie w tle
            </p>
          </div>
          <div
            class="toggle-switch"
            id="autoPayToggle"
            onclick="toggleAutoPay()"
          ></div>
        </div>

        <div class="instruction-section">
          <h3>âš ï¸ <span data-translate="debtInfo">Informacje o dÅ‚ugu</span></h3>
          <p style="font-size: 0.9em; color: #aaa" data-translate="debtDesc">
            JeÅ›li zabraknie pieniÄ™dzy na podatek, powstanie dÅ‚ug. Masz 7 dni na
            spÅ‚atÄ™ dÅ‚ugu.
          </p>
          <div class="tax-stat" style="margin-top: 10px">
            <span data-translate="currentDebt">Aktualny dÅ‚ug:</span>
            <span id="currentDebt" class="price cost">0 zÅ‚</span>
          </div>
        </div>

        <button
          class="confirm-btn active"
          onclick="payDebt()"
          id="payDebtBtn"
          style="display: none"
        >
          ğŸ’³ <span data-translate="payDebt">SpÅ‚aÄ‡ dÅ‚ug</span>
        </button>

        <button
          class="modal-close"
          onclick="closeModal('tax')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Karta -->
    <div class="modal" id="modalCard">
      <div class="modal-content">
        <h2>ğŸ’³ <span data-translate="card">Karta Beam-Pay</span></h2>

        <div class="beam-pay-card">
          <div class="card-logo">Beam-Pay</div>
          <div class="card-code" id="cardCode">000000</div>
          <div class="card-balance">
            <div class="label" data-translate="balance">Saldo</div>
            <div class="amount" id="cardBalance">50 000 zÅ‚</div>
          </div>
        </div>

        <div class="card-settings">
          <h4>
            âš™ï¸ <span data-translate="cardSettings">Ustawienia karty</span>
          </h4>

          <div class="setting-row">
            <span class="setting-label" data-translate="spendingLimit"
              >Limit wydatkÃ³w:</span
            >
            <span class="setting-value" id="limitValue">10 000 zÅ‚</span>
          </div>

          <div class="setting-row">
            <span class="setting-label" data-translate="spent"
              >Wydano z limitu:</span
            >
            <span class="setting-value" id="spentValue">0 zÅ‚</span>
          </div>

          <div class="setting-row">
            <span class="setting-label" data-translate="remaining"
              >PozostaÅ‚o:</span
            >
            <span class="setting-value" id="remainingValue">10 000 zÅ‚</span>
          </div>

          <div class="limit-bar">
            <div class="limit-fill" id="limitBar" style="width: 0%"></div>
          </div>

          <button class="card-btn" onclick="openModal('setLimit')">
            <span data-translate="setLimit">ğŸ“Š Ustaw limit</span>
          </button>
          <button
            class="card-btn"
            onclick="pendingAction = 'resetLimit'; openModal('pin');"
          >
            <span data-translate="resetSpent">ğŸ”„ Resetuj wydatki</span>
          </button>

          <div
            style="
              margin-top: 15px;
              padding-top: 15px;
              border-top: 1px solid #444;
            "
          >
            <h4 style="margin-bottom: 10px">
              ğŸ’³
              <span data-translate="autoPayments">Automatyczne pÅ‚atnoÅ›ci</span>
            </h4>
            <p
              style="font-size: 0.8em; color: #888; margin-bottom: 10px"
              data-translate="autoPayInfo"
            >
              Podatki i ubezpieczenia nie liczÄ… siÄ™ do limitu
            </p>

            <div id="insuranceAutoPayList"></div>

            <div
              id="noInsurancesCard"
              style="
                text-align: center;
                color: #888;
                padding: 10px;
                display: none;
              "
            >
              <span data-translate="noActiveInsurance"
                >Brak aktywnych ubezpieczeÅ„</span
              >
            </div>
          </div>
        </div>

        <button
          class="modal-close"
          onclick="closeModal('card')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Ustaw Limit -->
    <div class="modal" id="modalSetLimit">
      <div class="modal-content">
        <h2>ğŸ“Š <span data-translate="setLimit">Ustaw limit wydatkÃ³w</span></h2>

        <div class="input-group">
          <label data-translate="newLimit">Nowy limit (zÅ‚)</label>
          <input
            type="number"
            id="newLimitInput"
            min="100"
            placeholder="np. 10000"
          />
        </div>

        <button class="confirm-btn active" onclick="setNewLimit()">
          âœ… <span data-translate="setLimitBtn">Ustaw limit</span>
        </button>
        <button
          class="modal-close"
          onclick="closeModal('setLimit')"
          data-translate="cancel"
        >
          Anuluj
        </button>
      </div>
    </div>

    <!-- Modal PIN -->
    <div class="modal" id="modalPin">
      <div class="modal-content">
        <h2>ğŸ” <span data-translate="enterPin">Wpisz PIN</span></h2>
        <p
          style="
            text-align: center;
            color: #aaa;
            margin-bottom: 10px;
            font-size: 0.9em;
          "
          data-translate="enter6digitPin"
        >
          Wpisz 6-cyfrowy PIN z karty Beam-Pay
        </p>

        <div class="pin-display">
          <div class="pin-digit" id="pin1"></div>
          <div class="pin-digit" id="pin2"></div>
          <div class="pin-digit" id="pin3"></div>
          <div class="pin-digit" id="pin4"></div>
          <div class="pin-digit" id="pin5"></div>
          <div class="pin-digit" id="pin6"></div>
        </div>

        <div class="pin-keypad">
          <button class="pin-key" onclick="addPinDigit('1')">1</button>
          <button class="pin-key" onclick="addPinDigit('2')">2</button>
          <button class="pin-key" onclick="addPinDigit('3')">3</button>
          <button class="pin-key" onclick="addPinDigit('4')">4</button>
          <button class="pin-key" onclick="addPinDigit('5')">5</button>
          <button class="pin-key" onclick="addPinDigit('6')">6</button>
          <button class="pin-key" onclick="addPinDigit('7')">7</button>
          <button class="pin-key" onclick="addPinDigit('8')">8</button>
          <button class="pin-key" onclick="addPinDigit('9')">9</button>
          <button class="pin-key delete" onclick="deletePinDigit()">âŒ«</button>
          <button class="pin-key" onclick="addPinDigit('0')">0</button>
          <button class="pin-key confirm" onclick="confirmPin()">âœ“</button>
        </div>

        <button
          class="modal-close"
          onclick="closeModal('pin'); pendingAction = null;"
          data-translate="cancel"
        >
          Anuluj
        </button>
      </div>
    </div>

    <!-- Modal Limit Exceeded -->
    <div class="modal" id="modalLimitExceeded">
      <div class="modal-content">
        <h2>
          âš ï¸ <span data-translate="limitExceeded">Przekroczono limit!</span>
        </h2>

        <div
          style="
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
          "
        >
          <h3 style="color: #ef4444">
            ğŸš« <span data-translate="pinRequired">Wymagany PIN</span>
          </h3>
          <p
            style="color: #aaa; margin-top: 10px"
            data-translate="transactionExceedsLimit"
          >
            Ta transakcja przekracza TwÃ³j limit wydatkÃ³w. Wpisz PIN z karty aby
            potwierdziÄ‡.
          </p>
        </div>

        <button
          class="confirm-btn active"
          onclick="closeModal('limitExceeded'); openModal('pin');"
        >
          ğŸ” <span data-translate="enterPinBtn">Wpisz PIN</span>
        </button>
        <button
          class="modal-close"
          onclick="closeModal('limitExceeded'); pendingAction = null;"
          data-translate="cancel"
        >
          Anuluj
        </button>
      </div>
    </div>

    <!-- Modal WybÃ³r Trybu Gry -->
    <div class="modal" id="modalGameMode">
      <div class="modal-content">
        <h2>ğŸ® <span data-translate="selectMode">Wybierz tryb</span></h2>

        <div style="display: flex; flex-direction: column; gap: 15px">
          <button
            onclick="switchGameMode('beamng')"
            id="modeBeamNG"
            style="
              padding: 20px;
              background: linear-gradient(145deg, #ff6b35, #f7931e);
              border: 3px solid transparent;
              border-radius: 15px;
              cursor: pointer;
              text-align: left;
              transition: all 0.3s;
            "
          >
            <div style="font-size: 1.5em; margin-bottom: 8px">
              ğŸš— BeamNG Drive
            </div>
            <div style="font-size: 0.9em; color: rgba(255, 255, 255, 0.9)">
              Datapack
            </div>
            <div
              style="
                font-size: 0.8em;
                color: rgba(255, 255, 255, 0.7);
                margin-top: 8px;
              "
              data-translate="beamngDesc"
            >
              Auta z gry BeamNG.drive - fikcyjne marki
            </div>
          </button>

          <button
            onclick="switchGameMode('reallife')"
            id="modeRealLife"
            style="
              padding: 20px;
              background: linear-gradient(145deg, #10b981, #059669);
              border: 3px solid transparent;
              border-radius: 15px;
              cursor: pointer;
              text-align: left;
              transition: all 0.3s;
            "
          >
            <div style="font-size: 1.5em; margin-bottom: 8px">ğŸŒ Real Life</div>
            <div
              style="font-size: 0.9em; color: rgba(255, 255, 255, 0.9)"
              data-translate="simulator"
            >
              Symulator
            </div>
            <div
              style="
                font-size: 0.8em;
                color: rgba(255, 255, 255, 0.7);
                margin-top: 8px;
              "
              data-translate="reallifeDesc"
            >
              Prawdziwe marki aut w realnych cenach (-10%)
            </div>
          </button>
        </div>

        <div
          style="
            margin-top: 15px;
            padding: 12px;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid #f59e0b;
            border-radius: 10px;
            font-size: 0.85em;
            color: #f59e0b;
          "
        >
          âš ï¸
          <span data-translate="modeWarning"
            >KaÅ¼dy tryb ma osobny postÄ™p na tym samym save'ie!</span
          >
        </div>

        <button
          class="modal-close"
          onclick="closeModal('gameMode')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal JÄ™zyki -->
    <div class="modal" id="modalLanguage">
      <div class="modal-content">
        <h2>ğŸŒ <span data-translate="selectLanguage">Wybierz jÄ™zyk</span></h2>

        <div class="lang-grid" id="langGrid"></div>

        <button
          class="modal-close"
          onclick="closeModal('language')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Save'y -->
    <div class="modal" id="modalSaves">
      <div class="modal-content">
        <h2>ğŸ’¾ <span data-translate="saves">Save'y</span></h2>

        <div
          id="savesList"
          style="
            max-height: 50vh;
            overflow-y: auto;
            margin-bottom: 15px;
            -webkit-overflow-scrolling: touch;
          "
        ></div>

        <div
          style="
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
          "
        >
          <p style="margin-bottom: 10px; font-weight: bold; font-size: 0.95em">
            <span data-translate="createSave">Nowy save</span>
          </p>
          <input
            type="text"
            id="newSaveName"
            placeholder="Save 2"
            style="
              width: 100%;
              padding: 12px;
              border: 1px solid #333;
              border-radius: 8px;
              background: #1a1a2e;
              color: white;
              margin-bottom: 10px;
              font-size: 16px;
            "
          />
          <button
            onclick="handleCreateSave()"
            style="
              width: 100%;
              padding: 14px;
              background: #10b981;
              color: white;
              border: none;
              border-radius: 8px;
              font-size: 1em;
              cursor: pointer;
              -webkit-tap-highlight-color: transparent;
            "
          >
            â• <span data-translate="createSave">Nowy save</span>
          </button>
        </div>

        <button
          class="modal-close"
          onclick="closeModal('saves')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal Bony -->
    <div class="modal" id="modalVouchers">
      <div class="modal-content">
        <h2>ğŸ <span data-translate="vouchers">Bony</span></h2>

        <!-- Opisik -->
        <div
          style="
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid #8b5cf6;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 0.85em;
            color: #aaa;
            line-height: 1.4;
          "
        >
          <span data-translate="vouchersDescription"
            >Bony to wirtualne pieniÄ…dze ktÃ³re moÅ¼esz wysÅ‚aÄ‡ znajomym przez
            WhatsApp, Messenger, Email lub SMS. Odbiorca moÅ¼e przyjÄ…Ä‡ bon
            (dostanie pieniÄ…dze) lub przekazaÄ‡ go komuÅ› innemu.</span
          >
        </div>

        <!-- Twoje bony do wysÅ‚ania -->
        <div style="margin-bottom: 15px">
          <h3 style="font-size: 0.95em; margin-bottom: 10px">
            ğŸ“¤ <span data-translate="vouchersToSend">Bony do wysÅ‚ania</span>
          </h3>
          <div
            id="vouchersToSendList"
            style="
              max-height: 30vh;
              overflow-y: auto;
              -webkit-overflow-scrolling: touch;
            "
          ></div>
        </div>

        <!-- Otrzymane bony -->
        <div style="margin-bottom: 15px">
          <h3 style="font-size: 0.95em; margin-bottom: 10px">
            ğŸ“¥ <span data-translate="receivedVouchers">Otrzymane bony</span>
          </h3>
          <div
            id="receivedVouchersList"
            style="
              max-height: 30vh;
              overflow-y: auto;
              -webkit-overflow-scrolling: touch;
            "
          ></div>
        </div>

        <!-- UtwÃ³rz bon -->
        <div
          style="
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 15px;
          "
        >
          <p style="margin-bottom: 10px; font-weight: bold; font-size: 0.95em">
            <span data-translate="createVoucher">UtwÃ³rz bon</span>
          </p>
          <input
            type="number"
            id="voucherAmountInput"
            placeholder="100"
            min="1"
            inputmode="numeric"
            style="
              width: 100%;
              padding: 12px;
              border: 1px solid #333;
              border-radius: 8px;
              background: #1a1a2e;
              color: white;
              margin-bottom: 10px;
              font-size: 16px;
            "
          />
          <input
            type="text"
            id="voucherMessageInput"
            placeholder="WiadomoÅ›Ä‡ (opcjonalna)"
            style="
              width: 100%;
              padding: 12px;
              border: 1px solid #333;
              border-radius: 8px;
              background: #1a1a2e;
              color: white;
              margin-bottom: 10px;
              font-size: 16px;
            "
          />
          <button
            onclick="handleCreateVoucher()"
            style="
              width: 100%;
              padding: 14px;
              background: #8b5cf6;
              color: white;
              border: none;
              border-radius: 8px;
              font-size: 1em;
              cursor: pointer;
              -webkit-tap-highlight-color: transparent;
            "
          >
            ğŸ <span data-translate="createVoucher">UtwÃ³rz bon</span>
          </button>
        </div>

        <button
          class="modal-close"
          onclick="closeModal('vouchers')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal PodglÄ…d Bonu -->
    <div class="modal" id="modalVoucherPreview">
      <div class="modal-content">
        <div id="voucherPreviewContent"></div>
        <button
          class="modal-close"
          onclick="closeModal('voucherPreview')"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <!-- Modal UdostÄ™pnij Bon -->
    <div class="modal" id="modalShareVoucher">
      <div class="modal-content">
        <h2>ğŸ“¤ <span data-translate="shareVoucher">WyÅ›lij bon</span></h2>
        <div id="shareVoucherPreview" style="margin-bottom: 15px"></div>
        <div id="shareVoucherButtons"></div>
        <button
          class="modal-close"
          onclick="closeModal('shareVoucher')"
          style="margin-top: 15px"
          data-translate="close"
        >
          Zamknij
        </button>
      </div>
    </div>

    <script>
      // ==================== JÄ˜ZYKI ====================
      const languages = {
        pl: { name: "Polski", flag: "ğŸ‡µğŸ‡±" },
        en: { name: "English", flag: "ğŸ‡¬ğŸ‡§" },
      };

      const translations = {
        pl: {
          yourMoney: "TWOJE PIENIÄ„DZE",
          debt: "DÅUG",
          instructions: "Instrukcja",
          earnKm: "Zarobek (km)",
          repair: "Napraw Auto",
          buyCar: "Kup Auto",
          sellCar: "Sprzedaj Auto",
          work: "Praca",
          garage: "GaraÅ¼",
          upgrade: "Ulepsz",
          sellValue: "WartoÅ›Ä‡",
          sell: "Sprzedaj",
          carBroken: "Auto zepsute!",
          cantSellBroken: "Nie moÅ¼esz sprzedaÄ‡ zepsutego auta!",
          confirmSell: "SprzedaÄ‡",
          forPrice: "za",
          sold: "Sprzedano!",
          basePrice: "Cena bazowa",
          buyQuestion: "KupiÄ‡",
          carBought: "Kupiono",
          upgradeCar: "Ulepszanie",
          startUpgrade: "Rozpocznij ulepszanie",
          stopUpgrade: "Zatrzymaj",
          upgrading: "Ulepszanie w toku...",
          upgradeStopped: "Zatrzymane",
          clickToStart: "Kliknij aby rozpoczÄ…Ä‡",
          upgradeWarning:
            "Podczas ulepszania auto moÅ¼e siÄ™ zepsuÄ‡! (150 zÅ‚ + -5%)",
          carBrokeMsg: "Auto siÄ™ zepsuÅ‚o! -150 zÅ‚, -5%",
          carBreakDebt: "Zepsucie auta",
          buyCarFirst: "Kup auto w salonie!",
          chooseJob: "Wybierz pracÄ™:",
          bonuses: "bonusy",
          bonus: "bonus",
          stayAwake: "Trzymaj Å¼eby nie zasnÄ…Ä‡!",
          workDone: "Praca zakoÅ„czona!",
          basePay: "Podstawa",
          sleepPenalty: "Kara za spanie",
          total: "Razem",
          taxes: "Podatki",
          card: "Karta Beam-Pay",
          cardRealLife: "Karta Real-Card",
          howToEarn: "Jak zdobyÄ‡ pieniÄ…dze?",
          perKm: "Za kaÅ¼dy km",
          sellCarTo: "SprzedaÅ¼ auta",
          carPrice: "ceny auta",
          fees: "OpÅ‚aty",
          fuel: "Paliwo (max 10 PkA)",
          startFuel: "Start: 10 punktÃ³w paliwa",
          taxesPer2km: "Podatki (co 2 km)",
          taxesPer10min: "Podatki (co 10 min)",
          repairCost: "Naprawa auta",
          fine: "Mandat",
          close: "Zamknij",
          sendScreenshotKm: "WyÅ›lij screenshot z przejechanych kilometrÃ³w",
          clickOrDrag: "Kliknij lub przeciÄ…gnij screenshot",
          analyzing: "AnalizujÄ™ screenshot...",
          collectEarnings: "Odbierz zarobek",
          sendScreenshotDamage: "WyÅ›lij screenshot uszkodzonego auta",
          repairCostInfo: "Koszt naprawy:",
          payAndRepair: "ZapÅ‚aÄ‡ i napraw",
          sendScreenshotCar: "WyÅ›lij screenshot z cenÄ… auta",
          get50percent: "Dostaniesz 50% wartoÅ›ci",
          buyCarBtn: "Kup auto",
          sellCarBtn: "Sprzedaj auto",
          taxInfo: "Informacje o podatkach",
          taxRate: "Stawka:",
          totalPaid: "ZapÅ‚acono Å‚Ä…cznie:",
          nextTax: "NastÄ™pny podatek za:",
          autoPay: "Automatyczne pÅ‚acenie",
          autoPayDesc: "Karta pÅ‚aci automatycznie w tle",
          debtInfo: "Informacje o dÅ‚ugu",
          debtDesc:
            "JeÅ›li zabraknie pieniÄ™dzy na podatek, powstanie dÅ‚ug. Masz 7 dni na spÅ‚atÄ™ dÅ‚ugu.",
          currentDebt: "Aktualny dÅ‚ug:",
          payDebt: "SpÅ‚aÄ‡ dÅ‚ug",
          balance: "Saldo",
          cardSettings: "Ustawienia karty",
          spendingLimit: "Limit wydatkÃ³w:",
          spent: "Wydano z limitu:",
          remaining: "PozostaÅ‚o:",
          setLimit: "ğŸ“Š Ustaw limit",
          resetSpent: "ğŸ”„ Resetuj wydatki",
          newLimit: "Nowy limit (zÅ‚)",
          setLimitBtn: "Ustaw limit",
          cancel: "Anuluj",
          enterPin: "Wpisz PIN",
          enter6digitPin: "Wpisz 6-cyfrowy PIN z karty Beam-Pay",
          limitExceeded: "Przekroczono limit!",
          pinRequired: "Wymagany PIN",
          transactionExceedsLimit:
            "Ta transakcja przekracza TwÃ³j limit. Wpisz PIN aby potwierdziÄ‡.",
          enterPinBtn: "Wpisz PIN",
          selectLanguage: "Wybierz jÄ™zyk",
          daysLeft: "dni do spÅ‚aty",
          notEnoughMoney: "Nie masz wystarczajÄ…co pieniÄ™dzy!",
          invalidScreenshot: "Nie rozpoznano danych!",
          foundKm: "Znaleziono:",
          foundPrice: "Cena auta:",
          noCarFound: "Nie znaleziono auta na obrazku!",
          enterKm: "Wpisz przejechane kilometry:",
          enterPrice: "Wpisz cenÄ™ auta:",
          youGet50: "Dostaniesz 50%:",
          youPay: "ZapÅ‚acisz:",
          generateQR: "Generuj kod QR",
          carName: "Nazwa auta (np. ETK 800)",
          carPricePlaceholder: "Cena ze screena",
          selectCarToSell: "Wybierz auto z garaÅ¼u:",
          sendCarPhoto: "WyÅ›lij zdjÄ™cie tego auta",
          noCarInGarage: "Nie masz Å¼adnych aut w garaÅ¼u",
          boughtFor: "Kupiono za",
          inventory: "Ekwipunek",
          health: "Zdrowie",
          food: "Jedzenie",
          water: "Picie",
          foodTab: "Jedzenie",
          drinksTab: "Napoje",
          foodFull: "Nie moÅ¼esz wiÄ™cej jeÅ›Ä‡!",
          waterFull: "Nie moÅ¼esz wiÄ™cej piÄ‡!",
          shop: "Sklep",
          backpackContents: "ZawartoÅ›Ä‡ plecaka:",
          emptyBackpack: "Plecak jest pusty",
          goToShop: "IdÅº do sklepu kupiÄ‡ jedzenie!",
          useItem: "UÅ¼yj",
          tooFull: "JesteÅ› peÅ‚ny!",
          insurance: "Ubezpieczenia",
          activeInsurances: "Aktywne ubezpieczenia",
          chooseInsurance: "Wybierz pakiet:",
          cancelInsurance: "Zrezygnuj",
          confirmCancelWithRefund: "ZrezygnowaÄ‡? Zwrot",
          confirmCancelNoRefund:
            "ZrezygnowaÄ‡? Brak zwrotu (uÅ¼yto mniej niÅ¼ 3 razy)",
          choosePeriod: "Wybierz okres",
          hour: "Godzina",
          day: "DzieÅ„",
          week: "TydzieÅ„",
          month: "MiesiÄ…c",
          perHour: "/godz",
          perDay: "/dzieÅ„",
          perWeek: "/tydzieÅ„",
          perMonth: "/miesiÄ…c",
          activated: "Aktywowane",
          remaining: "PozostaÅ‚o",
          expired: "WygasÅ‚o",
          autoPayments: "Automatyczne pÅ‚atnoÅ›ci",
          autoPayInfo: "Podatki i ubezpieczenia nie liczÄ… siÄ™ do limitu",
          autoPay: "Auto-pÅ‚aÄ‡",
          noActiveInsurance: "Brak aktywnych ubezpieczeÅ„",
          alreadyHaveInsurance: "JuÅ¼ masz to ubezpieczenie!",
          insuranceDetails: "SzczegÃ³Å‚y",
          price: "Cena",
          totalPaid: "ZapÅ‚acono Å‚Ä…cznie",
          benefitsReceived: "Otrzymane korzyÅ›ci",
          nextPayment: "NastÄ™pna pÅ‚atnoÅ›Ä‡",
          refund: "zwrot",
          noRefund: "brak zwrotu",
          // Produkty - jedzenie
          itemBurger: "Burger",
          itemPizza: "Pizza",
          itemHotdog: "Hot Dog",
          itemFries: "Frytki",
          itemSandwich: "Kanapka",
          itemSalad: "SaÅ‚atka",
          itemApple: "JabÅ‚ko",
          itemBanana: "Banan",
          itemWatermelon: "Arbuz",
          itemChicken: "Kurczak",
          itemSteak: "Stek",
          itemSushi: "Sushi",
          itemDonut: "PÄ…czek",
          itemIcecream: "Lody",
          itemChocolate: "Czekolada",
          // Produkty - napoje
          itemWater: "Woda",
          itemCola: "Cola",
          itemJuice: "Sok",
          itemCoffee: "Kawa",
          itemTea: "Herbata",
          itemMilk: "Mleko",
          itemBeer: "Piwo",
          itemWine: "Wino",
          itemSmoothie: "Smoothie",
          itemEnergyDrink: "Energetyk",
          itemLemonade: "Lemoniada",
          itemCoconut: "Woda kokosowa",
          // Ubezpieczenia - nazwy
          insBasic: "Basic",
          insStandard: "Standard",
          insPremium: "Premium",
          insVip: "VIP",
          insUltimate: "Ultimate",
          insHealthBasic: "Zdrowie Basic",
          insHealthPlus: "Zdrowie Plus",
          insFoodBasic: "Jedzenie Basic",
          insFoodPlus: "Jedzenie Plus",
          insWaterBasic: "Picie Basic",
          insWaterPlus: "Picie Plus",
          insHealthFood: "Zdrowie + Jedzenie",
          insHealthWater: "Zdrowie + Picie",
          insFoodWater: "Jedzenie + Picie",
          // Ubezpieczenia ulepszanie
          insUpgradeBasic: "Ulepszanie Basic",
          insUpgradePlus: "Ulepszanie Plus",
          insUpgradePro: "Ulepszanie Pro",
          insUpgradeMax: "Ulepszanie Max",
          insUpgradeBasicDesc: "+0.05%/s, -10% szansy zepsucia",
          insUpgradePlusDesc: "+0.1%/s, -20% szansy zepsucia",
          insUpgradeProDesc: "+0.15%/s, -30% szansy zepsucia",
          insUpgradeMaxDesc: "+0.2%/s, -40% szansy zepsucia",
          // Ubezpieczenia naprawa
          insRepairBasic: "Naprawa Basic",
          insRepairPlus: "Naprawa Plus",
          insRepairFull: "Naprawa Full",
          insRepairBasicDesc: "30% kosztÃ³w naprawy pokryte",
          insRepairPlusDesc: "50% kosztÃ³w naprawy pokryte",
          insRepairFullDesc: "100% kosztÃ³w naprawy pokryte",
          noBrokenCars: "Wszystkie auta sÄ… sprawne!",
          goToGarage: "IdÅº do GaraÅ¼u Å¼eby ulepszaÄ‡ auta",
          carNotBroken: "To auto nie jest zepsute!",
          repairDebt: "Naprawa auta",
          addedToDebt: "Dodano do dÅ‚ugu",
          insuranceCovered: "Ubezpieczenie pokryÅ‚o",
          coinsCollected: "Zebrane monety",
          // Save'y
          saves: "Save'y",
          currentSave: "Aktualny save",
          createSave: "Nowy save",
          deleteSave: "UsuÅ„ save",
          switchSave: "PrzeÅ‚Ä…cz",
          saveName: "Nazwa save'a",
          confirmDeleteSave: "UsunÄ…Ä‡ ten save?",
          cannotDeleteLastSave: "Nie moÅ¼na usunÄ…Ä‡ ostatniego save'a!",
          saveCreated: "Save utworzony!",
          active: "aktywny",
          enterNewName: "WprowadÅº nowÄ… nazwÄ™:",
          // Bony
          vouchers: "Bony",
          vouchersRealLife: "Kupony",
          createVoucher: "UtwÃ³rz bon",
          createVoucherRealLife: "UtwÃ³rz kupon",
          voucherAmount: "Kwota bonu",
          voucherMessage: "WiadomoÅ›Ä‡ (opcjonalna)",
          redeemVoucher: "Zrealizuj bon",
          enterVoucherCode: "WprowadÅº kod bonu",
          voucherRedeemed: "Bon zrealizowany!",
          invalidVoucher: "NieprawidÅ‚owy kod bonu!",
          voucherCreated: "Bon utworzony! Kod:",
          voucherFrom: "Od:",
          yourVouchers: "Twoje bony",
          noVouchers: "Brak bonÃ³w",
          // Naprawa
          selectCarToRepair: "Wybierz auto do naprawy:",
          repairSelectedCar: "Napraw wybrane auto",
          repaired: "Naprawione!",
          // Bony - rozszerzone
          vouchersToSend: "Bony do wysÅ‚ania",
          receivedVouchers: "Otrzymane bony",
          sendVoucher: "WyÅ›lij",
          acceptVoucher: "Przyjmij",
          rejectVoucher: "PrzekaÅ¼ dalej",
          shareVoucher: "WyÅ›lij bon",
          copyLink: "Kopiuj link",
          linkCopied: "Link skopiowany!",
          cancelVoucherConfirm: "AnulowaÄ‡ bon? PieniÄ…dze wrÃ³cÄ… na konto.",
          youReceivedVoucher: "DostaÅ‚eÅ›/aÅ› bon o wartoÅ›ci",
          voucherAccepted: "Bon przyjÄ™ty!",
          noReceivedVouchers: "Brak otrzymanych bonÃ³w",
          invalidAmount: "WprowadÅº prawidÅ‚owÄ… kwotÄ™!",
          pendingVoucher: "WysÅ‚ano - oczekuje",
          cancelVoucherConfirm: "AnulowaÄ‡ bon?",
          shareTo: "UdostÄ™pnij do:",
          sendToOtherSave: "Lub wyÅ›lij na inny zapis:",
          voucherSentToSave: "Bon wysÅ‚any do",
          selectSaveForVoucher: "Na ktÃ³ry zapis przyjÄ…Ä‡ bon?",
          cannotAcceptOwnVoucher: "Nie moÅ¼esz przyjÄ…Ä‡ wÅ‚asnego bonu!",
          vouchersDescription:
            "Bony to wirtualne pieniÄ…dze ktÃ³re moÅ¼esz wysÅ‚aÄ‡ znajomym przez WhatsApp, Messenger, Email lub SMS. Odbiorca moÅ¼e przyjÄ…Ä‡ bon (dostanie pieniÄ…dze) lub przekazaÄ‡ go komuÅ› innemu.",
          // Tryb gry
          selectMode: "Wybierz tryb",
          beamngDesc: "Auta z gry BeamNG.drive - fikcyjne marki",
          simulator: "Symulator",
          reallifeDesc: "Prawdziwe marki aut w realnych cenach (-10%)",
          modeWarning: "KaÅ¼dy tryb ma osobny postÄ™p na tym samym save'ie!",
          // Instrukcje
          earnDesc: "Wykonuj prace aby zarabiaÄ‡ pieniÄ…dze:",
          driverJob: "Kierowca",
          factoryJob: "Praca w fabryce",
          sleepJob: "Sen (AFK)",
          sellCarProfit: "SprzedaÅ¼ auta",
          ofValue: "wartoÅ›ci",
          garageSystem: "System garaÅ¼u",
          garageDesc: "Kupuj, ulepszaj i sprzedawaj auta:",
          upgradeInfo:
            "Kliknij raz - auto ulepsza siÄ™ w tle. WartoÅ›Ä‡ roÅ›nie (50% â†’ 1000%)",
          breakRisk: "Ryzyko zepsucia",
          breakInfo: "0.5%/s szansy na zepsucie. Koszt: 150 zÅ‚ + -5% wartoÅ›ci",
          selling: "SprzedaÅ¼",
          sellInfo: "Cena = cena bazowa Ã— procent ulepszenia",
          payments: "PÅ‚atnoÅ›ci i opÅ‚aty",
          autoPayInfo2:
            "WÅ‚Ä…cz w ustawieniach karty - automatycznie pÅ‚aci podatki i ubezpieczenia",
          debtSystem: "System dÅ‚ugÃ³w",
          debtInfo2: "Brak kasy = dÅ‚ug. Masz 7 dni na spÅ‚atÄ™!",
          insurances: "Ubezpieczenia",
          insuranceDesc: "RÃ³Å¼ne pakiety dajÄ…ce bonusy:",
          healthIns: "Zdrowotne",
          healthInsDesc: "regeneracja HP, jedzenia, picia",
          upgradeIns: "Na ulepszanie",
          upgradeInsDesc: "szybsze ulepszanie, mniejsza szansa zepsucia",
          repairIns: "Na naprawÄ™",
          repairInsDesc: "pokrywa 30-100% kosztÃ³w naprawy",
          survival: "Przetrwanie",
          hungerDrain: "GÅ‚Ã³d",
          thirstDrain: "Pragnienie",
          survivalTip:
            "Kupuj jedzenie i napoje w sklepie, lub wykup ubezpieczenie!",
          voucherSystem: "System bonÃ³w",
          voucherDesc:
            "TwÃ³rz bony pieniÄ™Å¼ne i wysyÅ‚aj znajomym przez WhatsApp, Messenger, Email lub SMS. PieniÄ…dze pobierane sÄ… dopiero gdy odbiorca zaakceptuje bon.",
          value: "wartoÅ›ci",
          // Nowa instrukcja
          workSystem: "System pracy",
          workDesc: "Wybierz zawÃ³d i pracuj 2 minuty w mini-grze:",
          jobsRange: "13 zawodÃ³w od Å‚atwych do trudnych",
          coinGame: "Åapanie monet",
          coinGameDesc: "Klikaj spadajÄ…ce monety +100 zÅ‚ za kaÅ¼dÄ…!",
          sleepMechanic: "Zasypianie",
          sleepMechanicDesc:
            "Trzymaj ekran Å¼eby nie zasnÄ…Ä‡! Spanie = strata do 90% zarobku",
          gameModes: "Tryby gry",
          gameModesDesc:
            "Kliknij tytuÅ‚ gry aby przeÅ‚Ä…czyÄ‡ miÄ™dzy trybem BeamNG (fikcyjne auta) a Real Life (prawdziwe marki). KaÅ¼dy tryb ma osobny postÄ™p!",
          coinsCollected: "Zebrane monety",
          // ÅšmierÄ‡ i checkpointy
          youDied: "ZginÄ…Å‚eÅ›!",
          loadingCheckpoint: "Wczytywanie ostatniego checkpointu...",
          noCheckpoint: "Brak checkpointu",
          noCheckpointReset: "Brak checkpointu - zaczynasz od nowa!",
          checkpoint: "Checkpoint",
          saveCheckpoint: "Zapisz checkpoint",
          checkpointCreated: "Checkpoint utworzony!",
          checkpointInfo: "JeÅ›li zginiesz, wrÃ³cisz do tego momentu.",
          confirmDeleteCheckpoint:
            "UsunÄ…Ä‡ checkpoint? JeÅ›li zginiesz, stracisz caÅ‚y postÄ™p!",
          checkpointDeleted: "Checkpoint usuniÄ™ty!",
          noCheckpointToDelete: "Nie masz checkpointu do usuniÄ™cia!",
          deathWarning: "Uwaga! Jak zdrowie spadnie do 0 - zginiesz!",
          death: "ÅšmierÄ‡",
          deathDesc:
            "GÅ‚Ã³d/woda = 0 â†’ tracisz HP. HP = 0 â†’ zginiesz i wrÃ³cisz do checkpointu!",
          checkpointSystem: "System checkpointÃ³w",
          createCheckpointInfo: "Tworzenie",
          createCheckpointDesc:
            "W menu Save'Ã³w kliknij 'Zapisz checkpoint' Å¼eby zapisaÄ‡ aktualny postÄ™p",
          respawn: "Odrodzenie",
          respawnDesc:
            "Po Å›mierci wrÃ³cisz do checkpointu. Brak checkpointu = reset postÄ™pu!",
        },
        en: {
          yourMoney: "YOUR MONEY",
          debt: "DEBT",
          instructions: "Instructions",
          earnKm: "Earnings (km)",
          repair: "Repair Car",
          buyCar: "Buy Car",
          sellCar: "Sell Car",
          work: "Work",
          garage: "Garage",
          upgrade: "Upgrade",
          sellValue: "Value",
          sell: "Sell",
          carBroken: "Car broken!",
          cantSellBroken: "Cannot sell broken car!",
          confirmSell: "Sell",
          forPrice: "for",
          sold: "Sold!",
          basePrice: "Base price",
          buyQuestion: "Buy",
          carBought: "Bought",
          upgradeCar: "Upgrading",
          startUpgrade: "Start upgrading",
          stopUpgrade: "Stop",
          upgrading: "Upgrading...",
          upgradeStopped: "Stopped",
          clickToStart: "Click to start",
          upgradeWarning: "Car may break during upgrade! ($150 + -5%)",
          carBrokeMsg: "Car broke! -$150, -5%",
          carBreakDebt: "Car break",
          buyCarFirst: "Buy a car first!",
          chooseJob: "Choose job:",
          bonuses: "bonuses",
          bonus: "bonus",
          stayAwake: "Hold to stay awake!",
          workDone: "Work done!",
          basePay: "Base pay",
          sleepPenalty: "Sleep penalty",
          total: "Total",
          taxes: "Taxes",
          card: "Beam-Pay Card",
          cardRealLife: "Real-Card",
          howToEarn: "How to earn money?",
          perKm: "Per km",
          sellCarTo: "Sell car",
          carPrice: "car price",
          fees: "Fees",
          fuel: "Fuel (max 10)",
          startFuel: "Start: 10 fuel points",
          taxesPer2km: "Taxes (per 2 km)",
          taxesPer10min: "Taxes (per 10 min)",
          repairCost: "Car repair",
          fine: "Fine",
          close: "Close",
          sendScreenshotKm: "Send screenshot with kilometers",
          clickOrDrag: "Click or drag screenshot",
          analyzing: "Analyzing...",
          collectEarnings: "Collect",
          sendScreenshotDamage: "Send screenshot of damaged car",
          repairCostInfo: "Repair cost:",
          payAndRepair: "Pay and repair",
          sendScreenshotCar: "Send screenshot with car price",
          get50percent: "You get 50%",
          buyCarBtn: "Buy",
          sellCarBtn: "Sell",
          taxInfo: "Tax info",
          taxRate: "Rate:",
          totalPaid: "Total paid:",
          nextTax: "Next tax in:",
          autoPay: "Auto pay",
          autoPayDesc: "Card pays automatically",
          debtInfo: "Debt info",
          debtDesc: "No money for tax = debt. 7 days to pay.",
          currentDebt: "Current debt:",
          payDebt: "Pay debt",
          balance: "Balance",
          cardSettings: "Card settings",
          spendingLimit: "Limit:",
          spent: "Spent:",
          remaining: "Left:",
          setLimit: "ğŸ“Š Set limit",
          resetSpent: "ğŸ”„ Reset",
          newLimit: "New limit",
          setLimitBtn: "Set",
          cancel: "Cancel",
          enterPin: "Enter PIN",
          enter6digitPin: "Enter 6-digit PIN",
          limitExceeded: "Limit exceeded!",
          pinRequired: "PIN required",
          transactionExceedsLimit: "Exceeds limit. Enter PIN.",
          enterPinBtn: "Enter PIN",
          selectLanguage: "Select language",
          daysLeft: "days left",
          notEnoughMoney: "Not enough money!",
          invalidScreenshot: "Cannot read data!",
          foundKm: "Found:",
          foundPrice: "Price:",
          noCarFound: "No car found in image!",
          enterKm: "Enter kilometers:",
          enterPrice: "Enter car price:",
          youGet50: "You get 50%:",
          youPay: "You pay:",
          generateQR: "Generate QR code",
          carName: "Car name (e.g. ETK 800)",
          carPricePlaceholder: "Price from screenshot",
          selectCarToSell: "Select car from garage:",
          sendCarPhoto: "Send photo of this car",
          noCarInGarage: "No cars in garage",
          boughtFor: "Bought for",
          inventory: "Inventory",
          health: "Health",
          food: "Food",
          water: "Water",
          foodTab: "Food",
          drinksTab: "Drinks",
          foodFull: "You can't eat more!",
          waterFull: "You can't drink more!",
          shop: "Shop",
          backpackContents: "Backpack contents:",
          emptyBackpack: "Backpack is empty",
          goToShop: "Go to shop to buy food!",
          useItem: "Use",
          tooFull: "You're full!",
          insurance: "Insurance",
          activeInsurances: "Active insurances",
          chooseInsurance: "Choose package:",
          cancelInsurance: "Cancel",
          confirmCancelWithRefund: "Cancel? Refund",
          confirmCancelNoRefund: "Cancel? No refund (used less than 3 times)",
          choosePeriod: "Choose period",
          hour: "Hour",
          day: "Day",
          week: "Week",
          month: "Month",
          perHour: "/hour",
          perDay: "/day",
          perWeek: "/week",
          perMonth: "/month",
          activated: "Activated",
          remaining: "Remaining",
          expired: "Expired",
          autoPayments: "Auto payments",
          autoPayInfo: "Taxes and insurance don't count toward limit",
          autoPay: "Auto-pay",
          noActiveInsurance: "No active insurances",
          alreadyHaveInsurance: "You already have this insurance!",
          insuranceDetails: "Details",
          price: "Price",
          totalPaid: "Total paid",
          benefitsReceived: "Benefits received",
          nextPayment: "Next payment",
          refund: "refund",
          noRefund: "no refund",
          // Products - food
          itemBurger: "Burger",
          itemPizza: "Pizza",
          itemHotdog: "Hot Dog",
          itemFries: "Fries",
          itemSandwich: "Sandwich",
          itemSalad: "Salad",
          itemApple: "Apple",
          itemBanana: "Banana",
          itemWatermelon: "Watermelon",
          itemChicken: "Chicken",
          itemSteak: "Steak",
          itemSushi: "Sushi",
          itemDonut: "Donut",
          itemIcecream: "Ice cream",
          itemChocolate: "Chocolate",
          // Products - drinks
          itemWater: "Water",
          itemCola: "Cola",
          itemJuice: "Juice",
          itemCoffee: "Coffee",
          itemTea: "Tea",
          itemMilk: "Milk",
          itemBeer: "Beer",
          itemWine: "Wine",
          itemSmoothie: "Smoothie",
          itemEnergyDrink: "Energy Drink",
          itemLemonade: "Lemonade",
          itemCoconut: "Coconut water",
          // Insurance - names
          insBasic: "Basic",
          insStandard: "Standard",
          insPremium: "Premium",
          insVip: "VIP",
          insUltimate: "Ultimate",
          insHealthBasic: "Health Basic",
          insHealthPlus: "Health Plus",
          insFoodBasic: "Food Basic",
          insFoodPlus: "Food Plus",
          insWaterBasic: "Water Basic",
          insWaterPlus: "Water Plus",
          insHealthFood: "Health + Food",
          insHealthWater: "Health + Water",
          insFoodWater: "Food + Water",
          // Upgrade insurances
          insUpgradeBasic: "Upgrade Basic",
          insUpgradePlus: "Upgrade Plus",
          insUpgradePro: "Upgrade Pro",
          insUpgradeMax: "Upgrade Max",
          insUpgradeBasicDesc: "+0.05%/s, -10% break chance",
          insUpgradePlusDesc: "+0.1%/s, -20% break chance",
          insUpgradeProDesc: "+0.15%/s, -30% break chance",
          insUpgradeMaxDesc: "+0.2%/s, -40% break chance",
          // Repair insurances
          insRepairBasic: "Repair Basic",
          insRepairPlus: "Repair Plus",
          insRepairFull: "Repair Full",
          insRepairBasicDesc: "30% repair costs covered",
          insRepairPlusDesc: "50% repair costs covered",
          insRepairFullDesc: "100% repair costs covered",
          noBrokenCars: "All cars are working!",
          goToGarage: "Go to Garage to upgrade cars",
          carNotBroken: "This car is not broken!",
          repairDebt: "Car repair",
          addedToDebt: "Added to debt",
          insuranceCovered: "Insurance covered",
          coinsCollected: "Coins collected",
          // Saves
          saves: "Saves",
          currentSave: "Current save",
          createSave: "New save",
          deleteSave: "Delete save",
          switchSave: "Switch",
          saveName: "Save name",
          confirmDeleteSave: "Delete this save?",
          cannotDeleteLastSave: "Cannot delete the last save!",
          saveCreated: "Save created!",
          active: "active",
          enterNewName: "Enter new name:",
          // Vouchers
          vouchers: "Vouchers",
          vouchersRealLife: "Coupons",
          createVoucher: "Create voucher",
          createVoucherRealLife: "Create coupon",
          voucherAmount: "Voucher amount",
          voucherMessage: "Message (optional)",
          redeemVoucher: "Redeem voucher",
          enterVoucherCode: "Enter voucher code",
          voucherRedeemed: "Voucher redeemed!",
          invalidVoucher: "Invalid voucher code!",
          voucherCreated: "Voucher created! Code:",
          voucherFrom: "From:",
          yourVouchers: "Your vouchers",
          noVouchers: "No vouchers",
          // Repair
          selectCarToRepair: "Select car to repair:",
          repairSelectedCar: "Repair selected car",
          repaired: "Repaired!",
          // Vouchers - extended
          vouchersToSend: "Vouchers to send",
          receivedVouchers: "Received vouchers",
          sendVoucher: "Send",
          acceptVoucher: "Accept",
          rejectVoucher: "Pass on",
          shareVoucher: "Send voucher",
          copyLink: "Copy link",
          linkCopied: "Link copied!",
          cancelVoucherConfirm: "Cancel voucher? Money will be refunded.",
          youReceivedVoucher: "You received a voucher worth",
          voucherAccepted: "Voucher accepted!",
          noReceivedVouchers: "No received vouchers",
          invalidAmount: "Enter a valid amount!",
          pendingVoucher: "Sent - waiting",
          cancelVoucherConfirm: "Cancel voucher?",
          shareTo: "Share to:",
          sendToOtherSave: "Or send to another save:",
          voucherSentToSave: "Voucher sent to",
          selectSaveForVoucher: "Which save to accept voucher?",
          cannotAcceptOwnVoucher: "Cannot accept your own voucher!",
          vouchersDescription:
            "Vouchers are virtual money you can send to friends via WhatsApp, Messenger, Email or SMS. The recipient can accept the voucher (get the money) or pass it on to someone else.",
          // Game mode
          selectMode: "Select mode",
          beamngDesc: "Cars from BeamNG.drive game - fictional brands",
          simulator: "Simulator",
          reallifeDesc: "Real car brands at realistic prices (-10%)",
          modeWarning: "Each mode has separate progress on the same save!",
          // Instructions
          earnDesc: "Do jobs to earn money:",
          driverJob: "Driver",
          factoryJob: "Factory work",
          sleepJob: "Sleep (AFK)",
          sellCarProfit: "Sell car",
          ofValue: "of value",
          garageSystem: "Garage system",
          garageDesc: "Buy, upgrade and sell cars:",
          upgradeInfo:
            "Click once - car upgrades in background. Value grows (50% â†’ 1000%)",
          breakRisk: "Break risk",
          breakInfo: "0.5%/s chance to break. Cost: 150 zÅ‚ + -5% value",
          selling: "Selling",
          sellInfo: "Price = base price Ã— upgrade percentage",
          payments: "Payments & fees",
          autoPayInfo2:
            "Enable in card settings - auto-pays taxes and insurances",
          debtSystem: "Debt system",
          debtInfo2: "No cash = debt. You have 7 days to pay!",
          insurances: "Insurances",
          insuranceDesc: "Various packages with bonuses:",
          healthIns: "Health",
          healthInsDesc: "regenerates HP, food, water",
          upgradeIns: "Upgrade",
          upgradeInsDesc: "faster upgrading, lower break chance",
          repairIns: "Repair",
          repairInsDesc: "covers 30-100% of repair costs",
          survival: "Survival",
          hungerDrain: "Hunger",
          thirstDrain: "Thirst",
          survivalTip: "Buy food and drinks in shop, or get insurance!",
          voucherSystem: "Voucher system",
          voucherDesc:
            "Create money vouchers and send to friends via WhatsApp, Messenger, Email or SMS. Money is deducted only when recipient accepts the voucher.",
          value: "value",
          // New instructions
          workSystem: "Work system",
          workDesc: "Choose a job and work 2 minutes in mini-game:",
          jobsRange: "13 jobs from easy to hard",
          coinGame: "Catching coins",
          coinGameDesc: "Click falling coins +100 zÅ‚ each!",
          sleepMechanic: "Falling asleep",
          sleepMechanicDesc:
            "Hold screen to stay awake! Sleeping = lose up to 90% of earnings",
          gameModes: "Game modes",
          gameModesDesc:
            "Click game title to switch between BeamNG mode (fictional cars) and Real Life (real brands). Each mode has separate progress!",
          coinsCollected: "Coins collected",
          // Death and checkpoints
          youDied: "You died!",
          loadingCheckpoint: "Loading last checkpoint...",
          noCheckpoint: "No checkpoint",
          noCheckpointReset: "No checkpoint - starting over!",
          checkpoint: "Checkpoint",
          saveCheckpoint: "Save checkpoint",
          checkpointCreated: "Checkpoint created!",
          checkpointInfo: "If you die, you'll return to this moment.",
          confirmDeleteCheckpoint:
            "Delete checkpoint? If you die, you'll lose all progress!",
          checkpointDeleted: "Checkpoint deleted!",
          noCheckpointToDelete: "No checkpoint to delete!",
          deathWarning: "Warning! If health drops to 0 - you die!",
          death: "Death",
          deathDesc:
            "Hunger/water = 0 â†’ lose HP. HP = 0 â†’ you die and return to checkpoint!",
          checkpointSystem: "Checkpoint system",
          createCheckpointInfo: "Creating",
          createCheckpointDesc:
            "In Saves menu click 'Save checkpoint' to save current progress",
          respawn: "Respawn",
          respawnDesc:
            "After death you'll return to checkpoint. No checkpoint = progress reset!",
        },
      };

      Object.keys(languages).forEach((lang) => {
        if (!translations[lang]) translations[lang] = translations.en;
      });

      let currentLang = localStorage.getItem("beamng_lang") || "pl";

      // ==================== SYSTEM SAVE'Ã“W ====================
      let saves = JSON.parse(localStorage.getItem("beamng_saves")) || [];
      let currentSaveId = localStorage.getItem("beamng_currentSave") || null;

      // Upewnij siÄ™ Å¼e jest minimum 1 save
      function ensureDefaultSave() {
        if (saves.length === 0) {
          const newSave = createNewSaveData("Save 1");
          saves.push(newSave);
          currentSaveId = newSave.id;
          localStorage.setItem("beamng_saves", JSON.stringify(saves));
          localStorage.setItem("beamng_currentSave", currentSaveId);
        }
        if (!currentSaveId || !saves.find((s) => s.id === currentSaveId)) {
          currentSaveId = saves[0].id;
          localStorage.setItem("beamng_currentSave", currentSaveId);
        }
      }

      function createNewSaveData(name) {
        return {
          id: "save_" + Date.now(),
          name: name,
          createdAt: Date.now(),
          data: {
            money: 1500,
            cardCode: generateCardCode(),
            limit: 10000,
            spent: 0,
            debt: 0,
            debtDeadline: null,
            totalTaxPaid: 0,
            autoPay: false,
            lastTaxTime: Date.now(),
            garage: [],
            health: 100,
            food: 1000,
            water: 1000,
            backpack: [],
            lastHungerTime: Date.now(),
            insurances: [],
            vouchersToSend: [],
            receivedVouchers: [],
          },
        };
      }

      // InterwaÅ‚y ulepszania aut - musi byÄ‡ przed loadSaveData
      let upgradeIntervals = {};

      // Tryb gry - musi byÄ‡ przed loadSaveData
      let gameMode = localStorage.getItem("beamng_gameMode") || "beamng";

      // getCurrentCars() jest zdefiniowane po listach aut (beamngCars, realLifeCars)

      function getCurrentSave() {
        return saves.find((s) => s.id === currentSaveId);
      }

      function loadSaveData() {
        const save = getCurrentSave();
        if (!save) return;

        // Zatrzymaj wszystkie aktywne ulepszania przed zaÅ‚adowaniem nowego save'a
        Object.keys(upgradeIntervals).forEach((idx) => {
          clearInterval(upgradeIntervals[idx]);
        });
        upgradeIntervals = {};

        // ZaÅ‚aduj dane wspÃ³lne (karta, PIN, limit, autoPay, lastTaxTime)
        const d = save.data;
        cardCode = d.cardCode || generateCardCode();
        pin = cardCode;
        limit = d.limit || 10000;
        autoPay = d.autoPay || false;
        lastTaxTime = d.lastTaxTime || Date.now();
        lastHungerTime = d.lastHungerTime || Date.now();

        // ZaÅ‚aduj dane specyficzne dla trybu
        const modeKey = gameMode === "reallife" ? "realLifeData" : "beamngData";
        const modeData = save[modeKey];

        if (modeData) {
          money = modeData.money;
          garage = modeData.garage || [];
          spent = modeData.spent || 0;
          debt = modeData.debt || 0;
          debtDeadline = modeData.debtDeadline || null;
          totalTaxPaid = modeData.totalTaxPaid || 0;
          health = modeData.health || 100;
          food = modeData.food || 1000;
          water = modeData.water || 1000;
          backpack = modeData.backpack || [];
          activeInsurances = modeData.activeInsurances || [];
        } else {
          // Fallback do starych danych lub nowy start
          money = d.money || 1500;
          garage = d.garage || [];
          spent = d.spent || 0;
          debt = d.debt || 0;
          debtDeadline = d.debtDeadline || null;
          totalTaxPaid = d.totalTaxPaid || 0;
          health = d.health || 100;
          food = d.food || 1000;
          water = d.water || 1000;
          backpack = d.backpack || [];
          activeInsurances = d.insurances || [];
        }

        // WznÃ³w ulepszania aut
        resumeUpgrades();
      }

      function saveSaveData() {
        const save = getCurrentSave();
        if (!save) return;

        // Zapisz dane wspÃ³lne
        save.data.cardCode = cardCode;
        save.data.limit = limit;
        save.data.autoPay = autoPay;
        save.data.lastTaxTime = lastTaxTime;
        save.data.lastHungerTime = lastHungerTime;

        // Zapisz dane specyficzne dla trybu
        const modeKey = gameMode === "reallife" ? "realLifeData" : "beamngData";
        save[modeKey] = {
          money: money,
          garage: [...garage],
          spent: spent,
          debt: debt,
          debtDeadline: debtDeadline,
          totalTaxPaid: totalTaxPaid,
          health: health,
          food: food,
          water: water,
          backpack: [...backpack],
          activeInsurances: [...activeInsurances],
        };

        // Zachowaj teÅ¼ vouchery (te sÄ… wspÃ³lne)
        if (!save.data.vouchersToSend) save.data.vouchersToSend = [];
        if (!save.data.receivedVouchers) save.data.receivedVouchers = [];

        localStorage.setItem("beamng_saves", JSON.stringify(saves));
      }

      function createSave(name) {
        const newSave = createNewSaveData(name);
        saves.push(newSave);
        localStorage.setItem("beamng_saves", JSON.stringify(saves));
        return newSave;
      }

      function deleteSave(saveId) {
        if (saves.length <= 1) {
          alert(
            translations[currentLang].cannotDeleteLastSave ||
              "Nie moÅ¼na usunÄ…Ä‡ ostatniego save!"
          );
          return false;
        }
        const idx = saves.findIndex((s) => s.id === saveId);
        if (idx === -1) return false;

        saves.splice(idx, 1);
        localStorage.setItem("beamng_saves", JSON.stringify(saves));

        if (currentSaveId === saveId) {
          currentSaveId = saves[0].id;
          localStorage.setItem("beamng_currentSave", currentSaveId);
          loadSaveData();
        }
        return true;
      }

      function switchSave(saveId) {
        if (currentSaveId === saveId) return;

        // Zapisz obecny stan
        saveSaveData();

        // PrzeÅ‚Ä…cz na nowy save
        currentSaveId = saveId;
        localStorage.setItem("beamng_currentSave", currentSaveId);

        // ZaÅ‚aduj dane nowego save'a
        loadSaveData();
        updateAllDisplays();
      }

      // ==================== DÅ¹WIÄ˜KI ====================
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      let audioCtx = null;

      function initAudio() {
        if (!audioCtx) {
          audioCtx = new AudioContext();
        }
        if (audioCtx.state === "suspended") {
          audioCtx.resume();
        }
      }

      // Generowanie dÅºwiÄ™kÃ³w syntetycznych
      function playSound(type) {
        initAudio();
        if (!audioCtx) return;

        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        switch (type) {
          case "coin": // ZÅ‚apanie monety - wysoki dÅºwiÄ™k
            oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(
              1760,
              audioCtx.currentTime + 0.1
            );
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.15
            );
            oscillator.type = "sine";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.15);
            break;

          case "buy": // Kupno - kasa
            oscillator.frequency.setValueAtTime(523, audioCtx.currentTime);
            oscillator.frequency.setValueAtTime(
              659,
              audioCtx.currentTime + 0.1
            );
            oscillator.frequency.setValueAtTime(
              784,
              audioCtx.currentTime + 0.2
            );
            gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.3
            );
            oscillator.type = "sine";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.3);
            break;

          case "sell": // SprzedaÅ¼ - cha-ching
            oscillator.frequency.setValueAtTime(1318, audioCtx.currentTime);
            oscillator.frequency.setValueAtTime(
              1568,
              audioCtx.currentTime + 0.08
            );
            gainNode.gain.setValueAtTime(0.25, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.2
            );
            oscillator.type = "sine";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.2);
            break;

          case "error": // BÅ‚Ä…d - niski dÅºwiÄ™k
            oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(
              100,
              audioCtx.currentTime + 0.2
            );
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.25
            );
            oscillator.type = "sawtooth";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.25);
            break;

          case "success": // Sukces - fanfara
            oscillator.frequency.setValueAtTime(523, audioCtx.currentTime);
            oscillator.frequency.setValueAtTime(
              659,
              audioCtx.currentTime + 0.1
            );
            oscillator.frequency.setValueAtTime(
              784,
              audioCtx.currentTime + 0.2
            );
            oscillator.frequency.setValueAtTime(
              1047,
              audioCtx.currentTime + 0.3
            );
            gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.5
            );
            oscillator.type = "sine";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.5);
            break;

          case "click": // KlikniÄ™cie przycisku
            oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.05
            );
            oscillator.type = "sine";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.05);
            break;

          case "eat": // Jedzenie
            oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
            oscillator.frequency.setValueAtTime(
              350,
              audioCtx.currentTime + 0.05
            );
            oscillator.frequency.setValueAtTime(
              300,
              audioCtx.currentTime + 0.1
            );
            gainNode.gain.setValueAtTime(0.15, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.15
            );
            oscillator.type = "sine";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.15);
            break;

          case "drink": // Picie
            oscillator.frequency.setValueAtTime(400, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(
              200,
              audioCtx.currentTime + 0.2
            );
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.25
            );
            oscillator.type = "sine";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.25);
            break;

          case "repair": // Naprawa
            oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
            oscillator.frequency.setValueAtTime(
              400,
              audioCtx.currentTime + 0.1
            );
            oscillator.frequency.setValueAtTime(
              300,
              audioCtx.currentTime + 0.2
            );
            oscillator.frequency.setValueAtTime(
              500,
              audioCtx.currentTime + 0.3
            );
            gainNode.gain.setValueAtTime(0.15, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.4
            );
            oscillator.type = "square";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.4);
            break;

          case "break": // Zepsucie
            oscillator.frequency.setValueAtTime(400, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(
              50,
              audioCtx.currentTime + 0.5
            );
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.5
            );
            oscillator.type = "sawtooth";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.5);
            break;

          case "upgrade": // Ulepszenie tick
            oscillator.frequency.setValueAtTime(
              800 + Math.random() * 200,
              audioCtx.currentTime
            );
            gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.05
            );
            oscillator.type = "sine";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.05);
            break;

          case "workStart": // Start pracy
            oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
            oscillator.frequency.setValueAtTime(
              554,
              audioCtx.currentTime + 0.15
            );
            oscillator.frequency.setValueAtTime(
              659,
              audioCtx.currentTime + 0.3
            );
            gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.45
            );
            oscillator.type = "sine";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.45);
            break;

          case "workEnd": // Koniec pracy
            oscillator.frequency.setValueAtTime(659, audioCtx.currentTime);
            oscillator.frequency.setValueAtTime(
              784,
              audioCtx.currentTime + 0.15
            );
            oscillator.frequency.setValueAtTime(
              1047,
              audioCtx.currentTime + 0.3
            );
            gainNode.gain.setValueAtTime(0.25, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.5
            );
            oscillator.type = "sine";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.5);
            break;

          case "voucher": // Bon
            oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
            oscillator.frequency.setValueAtTime(
              1100,
              audioCtx.currentTime + 0.1
            );
            oscillator.frequency.setValueAtTime(
              1320,
              audioCtx.currentTime + 0.2
            );
            gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.35
            );
            oscillator.type = "sine";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.35);
            break;

          case "insurance": // Ubezpieczenie
            oscillator.frequency.setValueAtTime(500, audioCtx.currentTime);
            oscillator.frequency.setValueAtTime(
              600,
              audioCtx.currentTime + 0.1
            );
            oscillator.frequency.setValueAtTime(
              700,
              audioCtx.currentTime + 0.2
            );
            gainNode.gain.setValueAtTime(0.15, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioCtx.currentTime + 0.3
            );
            oscillator.type = "triangle";
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.3);
            break;
        }
      }

      // ==================== STAN GRY ====================
      let money = 1500;
      let cardCode = generateCardCode();
      let pin = cardCode;
      let limit = 10000;
      let spent = 0;
      let debt = 0;
      let debtDeadline = null;
      let totalTaxPaid = 0;
      let autoPay = false;
      let lastTaxTime = Date.now();
      let garage = [];

      // Jedzenie/Picie/Zdrowie
      let health = 100;
      let food = 1000;
      let water = 1000;
      let backpack = [];
      let lastHungerTime = Date.now();
      const MAX_HEALTH = 100;
      const MAX_FOOD = 1000;
      const MAX_WATER = 1000;
      const HUNGER_INTERVAL = 5 * 60 * 1000; // Co 5 minut
      const FOOD_DECAY = 50; // -50 kcal co 5 min
      const WATER_DECAY = 80; // -80 ml co 5 min

      // Ubezpieczenia - wiele aktywnych, pÅ‚atnoÅ›ci cykliczne (godzina/dzieÅ„/tydzieÅ„)
      let activeInsurances = [];

      const insurancePackages = [
        // Combo
        {
          id: "basic",
          nameKey: "insBasic",
          icon: "ğŸ’Š",
          prices: { hour: 50, day: 200, week: 1000 },
          interval: 10,
          benefits: { hp: 3, kcal: 20, ml: 30 },
          descKey: "insBasicDesc",
        },

        {
          id: "standard",
          nameKey: "insStandard",
          icon: "ğŸ¥",
          prices: { hour: 100, day: 400, week: 2000 },
          interval: 10,
          benefits: { hp: 5, kcal: 40, ml: 50 },
          descKey: "insStandardDesc",
        },

        {
          id: "premium",
          nameKey: "insPremium",
          icon: "â­",
          prices: { hour: 180, day: 700, week: 3500 },
          interval: 8,
          benefits: { hp: 8, kcal: 50, ml: 60 },
          descKey: "insPremiumDesc",
        },

        {
          id: "vip",
          nameKey: "insVip",
          icon: "ğŸ‘‘",
          prices: { hour: 300, day: 1200, week: 6000 },
          interval: 5,
          benefits: { hp: 10, kcal: 60, ml: 80 },
          descKey: "insVipDesc",
        },

        {
          id: "ultimate",
          nameKey: "insUltimate",
          icon: "ğŸ’",
          prices: { hour: 500, day: 2000, week: 10000 },
          interval: 5,
          benefits: { hp: 15, kcal: 80, ml: 100 },
          descKey: "insUltimateDesc",
        },

        // Zdrowie
        {
          id: "health_basic",
          nameKey: "insHealthBasic",
          icon: "â¤ï¸",
          prices: { hour: 40, day: 150, week: 800 },
          interval: 10,
          benefits: { hp: 8, kcal: 0, ml: 0 },
          descKey: "insHealthBasicDesc",
        },

        {
          id: "health_plus",
          nameKey: "insHealthPlus",
          icon: "â¤ï¸â€ğŸ”¥",
          prices: { hour: 80, day: 300, week: 1500 },
          interval: 8,
          benefits: { hp: 15, kcal: 0, ml: 0 },
          descKey: "insHealthPlusDesc",
        },

        // Jedzenie
        {
          id: "food_basic",
          nameKey: "insFoodBasic",
          icon: "ğŸ",
          prices: { hour: 30, day: 120, week: 600 },
          interval: 10,
          benefits: { hp: 0, kcal: 60, ml: 0 },
          descKey: "insFoodBasicDesc",
        },

        {
          id: "food_plus",
          nameKey: "insFoodPlus",
          icon: "ğŸ”",
          prices: { hour: 70, day: 280, week: 1400 },
          interval: 8,
          benefits: { hp: 0, kcal: 120, ml: 0 },
          descKey: "insFoodPlusDesc",
        },

        // Picie
        {
          id: "water_basic",
          nameKey: "insWaterBasic",
          icon: "ğŸ’§",
          prices: { hour: 25, day: 100, week: 500 },
          interval: 10,
          benefits: { hp: 0, kcal: 0, ml: 80 },
          descKey: "insWaterBasicDesc",
        },

        {
          id: "water_plus",
          nameKey: "insWaterPlus",
          icon: "ğŸŒŠ",
          prices: { hour: 60, day: 250, week: 1200 },
          interval: 8,
          benefits: { hp: 0, kcal: 0, ml: 150 },
          descKey: "insWaterPlusDesc",
        },

        // Mix 2 w 1
        {
          id: "health_food",
          nameKey: "insHealthFood",
          icon: "ğŸ",
          prices: { hour: 60, day: 250, week: 1200 },
          interval: 10,
          benefits: { hp: 5, kcal: 50, ml: 0 },
          descKey: "insHealthFoodDesc",
        },

        {
          id: "health_water",
          nameKey: "insHealthWater",
          icon: "ğŸ’¦",
          prices: { hour: 55, day: 220, week: 1100 },
          interval: 10,
          benefits: { hp: 5, kcal: 0, ml: 60 },
          descKey: "insHealthWaterDesc",
        },

        {
          id: "food_water",
          nameKey: "insFoodWater",
          icon: "ğŸ¥—",
          prices: { hour: 50, day: 200, week: 1000 },
          interval: 10,
          benefits: { hp: 0, kcal: 50, ml: 60 },
          descKey: "insFoodWaterDesc",
        },

        // === UBEZPIECZENIA NA ULEPSZANIE AUT ===
        {
          id: "upgrade_basic",
          nameKey: "insUpgradeBasic",
          icon: "ğŸ”§",
          type: "upgrade",
          prices: { hour: 80, day: 300, week: 1500 },
          rateBonus: 0.05,
          safetyBonus: 0.001,
          descKey: "insUpgradeBasicDesc",
        },

        {
          id: "upgrade_plus",
          nameKey: "insUpgradePlus",
          icon: "âš™ï¸",
          type: "upgrade",
          prices: { hour: 150, day: 600, week: 3000 },
          rateBonus: 0.1,
          safetyBonus: 0.002,
          descKey: "insUpgradePlusDesc",
        },

        {
          id: "upgrade_pro",
          nameKey: "insUpgradePro",
          icon: "ğŸ› ï¸",
          type: "upgrade",
          prices: { hour: 250, day: 1000, week: 5000 },
          rateBonus: 0.15,
          safetyBonus: 0.003,
          descKey: "insUpgradeProDesc",
        },

        {
          id: "upgrade_max",
          nameKey: "insUpgradeMax",
          icon: "ğŸï¸",
          type: "upgrade",
          prices: { hour: 400, day: 1600, week: 8000 },
          rateBonus: 0.2,
          safetyBonus: 0.004,
          descKey: "insUpgradeMaxDesc",
        },

        // === UBEZPIECZENIA NA NAPRAWÄ˜ ===
        {
          id: "repair_basic",
          nameKey: "insRepairBasic",
          icon: "ğŸ©¹",
          type: "repair",
          prices: { hour: 30, day: 120, week: 600 },
          coveragePercent: 30,
          descKey: "insRepairBasicDesc",
        },

        {
          id: "repair_plus",
          nameKey: "insRepairPlus",
          icon: "ğŸ—ï¸",
          type: "repair",
          prices: { hour: 60, day: 240, week: 1200 },
          coveragePercent: 50,
          descKey: "insRepairPlusDesc",
        },

        {
          id: "repair_full",
          nameKey: "insRepairFull",
          icon: "ğŸ›¡ï¸",
          type: "repair",
          prices: { hour: 100, day: 400, week: 2000 },
          coveragePercent: 100,
          descKey: "insRepairFullDesc",
        },
      ];

      // Funkcja do pobierania nazwy ubezpieczenia
      function getInsuranceName(pkg) {
        const t = translations[currentLang] || translations.en;
        return t[pkg.nameKey] || pkg.nameKey;
      }

      function getInsuranceDesc(pkg) {
        const t = translations[currentLang] || translations.en;
        if (t[pkg.descKey]) return t[pkg.descKey];

        if (pkg.type === "upgrade") {
          return `+${pkg.rateBonus}%/s, -${Math.floor(
            ((pkg.safetyBonus * 1000) / 0.005) * 10
          )}% ${t.breakChance || "szansy zepsucia"}`;
        }
        if (pkg.type === "repair") {
          return `${pkg.coveragePercent}% ${
            t.repairCovered || "kosztÃ³w naprawy pokryte"
          }`;
        }

        return `+${pkg.benefits.hp} HP, +${pkg.benefits.kcal} kcal, +${pkg.benefits.ml} ml`;
      }

      let currentPin = "";
      let pendingAction = null;
      let currentEarnAmount = 0;
      let currentBuyPrice = 0;
      let currentSellPrice = 0;
      let selectedCarIndex = -1;
      const REPAIR_COST = 5000;

      // Produkty - jedzenie
      const foodItems = [
        {
          id: "burger",
          icon: "ğŸ”",
          nameKey: "itemBurger",
          price: 150,
          kcal: 350,
          ml: 0,
          hp: -5,
        },
        {
          id: "pizza",
          icon: "ğŸ•",
          nameKey: "itemPizza",
          price: 200,
          kcal: 400,
          ml: 0,
          hp: -5,
        },
        {
          id: "hotdog",
          icon: "ğŸŒ­",
          nameKey: "itemHotdog",
          price: 100,
          kcal: 250,
          ml: 0,
          hp: -3,
        },
        {
          id: "fries",
          icon: "ğŸŸ",
          nameKey: "itemFries",
          price: 80,
          kcal: 300,
          ml: 0,
          hp: -5,
        },
        {
          id: "sandwich",
          icon: "ğŸ¥ª",
          nameKey: "itemSandwich",
          price: 120,
          kcal: 280,
          ml: 0,
          hp: 0,
        },
        {
          id: "salad",
          icon: "ğŸ¥—",
          nameKey: "itemSalad",
          price: 180,
          kcal: 150,
          ml: 50,
          hp: 10,
        },
        {
          id: "apple",
          icon: "ğŸ",
          nameKey: "itemApple",
          price: 30,
          kcal: 80,
          ml: 50,
          hp: 5,
        },
        {
          id: "banana",
          icon: "ğŸŒ",
          nameKey: "itemBanana",
          price: 25,
          kcal: 100,
          ml: 20,
          hp: 3,
        },
        {
          id: "watermelon",
          icon: "ğŸ‰",
          nameKey: "itemWatermelon",
          price: 60,
          kcal: 50,
          ml: 200,
          hp: 8,
        },
        {
          id: "chicken",
          icon: "ğŸ—",
          nameKey: "itemChicken",
          price: 220,
          kcal: 350,
          ml: 0,
          hp: 5,
        },
        {
          id: "steak",
          icon: "ğŸ¥©",
          nameKey: "itemSteak",
          price: 350,
          kcal: 450,
          ml: 0,
          hp: 10,
        },
        {
          id: "sushi",
          icon: "ğŸ£",
          nameKey: "itemSushi",
          price: 280,
          kcal: 200,
          ml: 30,
          hp: 8,
        },
        {
          id: "donut",
          icon: "ğŸ©",
          nameKey: "itemDonut",
          price: 40,
          kcal: 250,
          ml: 0,
          hp: -8,
        },
        {
          id: "icecream",
          icon: "ğŸ¦",
          nameKey: "itemIcecream",
          price: 50,
          kcal: 200,
          ml: 30,
          hp: -3,
        },
        {
          id: "chocolate",
          icon: "ğŸ«",
          nameKey: "itemChocolate",
          price: 35,
          kcal: 300,
          ml: 0,
          hp: -5,
        },
      ];

      // Produkty - napoje
      const drinkItems = [
        {
          id: "water",
          icon: "ğŸ’§",
          nameKey: "itemWater",
          price: 20,
          kcal: 0,
          ml: 500,
          hp: 5,
        },
        {
          id: "cola",
          icon: "ğŸ¥¤",
          nameKey: "itemCola",
          price: 40,
          kcal: 150,
          ml: 330,
          hp: -5,
        },
        {
          id: "juice",
          icon: "ğŸ§ƒ",
          nameKey: "itemJuice",
          price: 50,
          kcal: 100,
          ml: 250,
          hp: 3,
        },
        {
          id: "coffee",
          icon: "â˜•",
          nameKey: "itemCoffee",
          price: 60,
          kcal: 20,
          ml: 200,
          hp: 0,
        },
        {
          id: "tea",
          icon: "ğŸµ",
          nameKey: "itemTea",
          price: 40,
          kcal: 5,
          ml: 250,
          hp: 5,
        },
        {
          id: "milk",
          icon: "ğŸ¥›",
          nameKey: "itemMilk",
          price: 35,
          kcal: 80,
          ml: 300,
          hp: 5,
        },
        {
          id: "beer",
          icon: "ğŸº",
          nameKey: "itemBeer",
          price: 80,
          kcal: 150,
          ml: 500,
          hp: -10,
        },
        {
          id: "wine",
          icon: "ğŸ·",
          nameKey: "itemWine",
          price: 150,
          kcal: 120,
          ml: 150,
          hp: -8,
        },
        {
          id: "smoothie",
          icon: "ğŸ¥¤",
          nameKey: "itemSmoothie",
          price: 100,
          kcal: 180,
          ml: 400,
          hp: 10,
        },
        {
          id: "energydrink",
          icon: "âš¡",
          nameKey: "itemEnergyDrink",
          price: 70,
          kcal: 100,
          ml: 250,
          hp: -15,
        },
        {
          id: "lemonade",
          icon: "ğŸ‹",
          nameKey: "itemLemonade",
          price: 45,
          kcal: 80,
          ml: 300,
          hp: 3,
        },
        {
          id: "coconut",
          icon: "ğŸ¥¥",
          nameKey: "itemCoconut",
          price: 90,
          kcal: 50,
          ml: 350,
          hp: 8,
        },
      ];

      // Funkcja do pobierania nazwy produktu
      function getItemName(item) {
        const t = translations[currentLang] || translations.en;
        return t[item.nameKey] || item.nameKey;
      }

      let currentShopTab = "food";

      // Lista wszystkich aut z BeamNG.drive z cenami
      const beamngCars = [
        // Autobello
        {
          id: "autobuggy",
          brand: "Autobello",
          model: "Autobuggy",
          year: "2018-2022",
          price: 45000,
          type: "buggy",
        },
        {
          id: "piccolina",
          brand: "Autobello",
          model: "Piccolina",
          year: "1957-1973",
          price: 8000,
          type: "classic",
        },
        {
          id: "stambecco",
          brand: "Autobello",
          model: "Stambecco",
          year: "1971-1988",
          price: 15000,
          type: "offroad",
        },

        // Bruckell
        {
          id: "bastion",
          brand: "Bruckell",
          model: "Bastion",
          year: "2016-2022",
          price: 42000,
          type: "muscle",
        },
        {
          id: "legran",
          brand: "Bruckell",
          model: "LeGran",
          year: "1984-1993",
          price: 12000,
          type: "sedan",
        },
        {
          id: "moonhawk",
          brand: "Bruckell",
          model: "Moonhawk",
          year: "1973-1978",
          price: 25000,
          type: "muscle",
        },
        {
          id: "nine",
          brand: "Bruckell",
          model: "Nine",
          year: "1933-1934",
          price: 35000,
          type: "classic",
        },

        // Burnside
        {
          id: "special",
          brand: "Burnside",
          model: "Special",
          year: "1952-1954",
          price: 28000,
          type: "classic",
        },

        // Cherrier
        {
          id: "tograc",
          brand: "Cherrier",
          model: "Tograc",
          year: "2020-2024",
          price: 38000,
          type: "suv",
        },
        {
          id: "vivace",
          brand: "Cherrier",
          model: "Vivace",
          year: "2020-2024",
          price: 32000,
          type: "hatchback",
        },

        // Civetta
        {
          id: "bolide",
          brand: "Civetta",
          model: "Bolide",
          year: "1981-1988",
          price: 85000,
          type: "supercar",
        },
        {
          id: "scintilla",
          brand: "Civetta",
          model: "Scintilla",
          year: "2020-2022",
          price: 120000,
          type: "supercar",
        },

        // ETK
        {
          id: "etk800",
          brand: "ETK",
          model: "800 Series",
          year: "2013-2018",
          price: 55000,
          type: "sedan",
        },
        {
          id: "etkiseries",
          brand: "ETK",
          model: "I-Series",
          year: "1985-1993",
          price: 18000,
          type: "coupe",
        },
        {
          id: "etkkseries",
          brand: "ETK",
          model: "K-Series",
          year: "2015-2021",
          price: 75000,
          type: "suv",
        },

        // FPU
        {
          id: "wydra",
          brand: "FPU",
          model: "Wydra",
          year: "2008-2023",
          price: 22000,
          type: "military",
        },

        // Gavril
        {
          id: "barstow",
          brand: "Gavril",
          model: "Barstow",
          year: "1969-1971",
          price: 35000,
          type: "muscle",
        },
        {
          id: "bluebuck",
          brand: "Gavril",
          model: "Bluebuck",
          year: "1962-1963",
          price: 32000,
          type: "classic",
        },
        {
          id: "dseries",
          brand: "Gavril",
          model: "D-Series",
          year: "1986-2003",
          price: 28000,
          type: "pickup",
        },
        {
          id: "grandmarshal",
          brand: "Gavril",
          model: "Grand Marshal",
          year: "1990-1997",
          price: 18000,
          type: "sedan",
        },
        {
          id: "hseries",
          brand: "Gavril",
          model: "H-Series",
          year: "1993-2017",
          price: 35000,
          type: "van",
        },
        {
          id: "roamer",
          brand: "Gavril",
          model: "Roamer",
          year: "1992-2005",
          price: 32000,
          type: "suv",
        },
        {
          id: "tseries",
          brand: "Gavril",
          model: "T-Series",
          year: "1972-1986",
          price: 65000,
          type: "truck",
        },
        {
          id: "mdseries",
          brand: "Gavril",
          model: "MD-Series",
          year: "1986-1998",
          price: 45000,
          type: "truck",
        },

        // Hirochi
        {
          id: "aurata",
          brand: "Hirochi",
          model: "Aurata",
          year: "2016-2022",
          price: 42000,
          type: "sport",
        },
        {
          id: "esbr",
          brand: "Hirochi",
          model: "eSBR",
          year: "2013-2020",
          price: 95000,
          type: "electric",
        },
        {
          id: "sbr4",
          brand: "Hirochi",
          model: "SBR4",
          year: "2013-2020",
          price: 68000,
          type: "sport",
        },
        {
          id: "sunburst",
          brand: "Hirochi",
          model: "Sunburst",
          year: "2009-2014",
          price: 28000,
          type: "sport",
        },

        // Ibishu
        {
          id: "200bx",
          brand: "Ibishu",
          model: "200BX",
          year: "1990-1994",
          price: 15000,
          type: "coupe",
        },
        {
          id: "240bx",
          brand: "Ibishu",
          model: "240BX",
          year: "1990-1994",
          price: 18000,
          type: "coupe",
        },
        {
          id: "covet",
          brand: "Ibishu",
          model: "Covet",
          year: "1986-1992",
          price: 8000,
          type: "hatchback",
        },
        {
          id: "diana",
          brand: "Ibishu",
          model: "Diana",
          year: "1990-1994",
          price: 12000,
          type: "sedan",
        },
        {
          id: "hopper",
          brand: "Ibishu",
          model: "Hopper",
          year: "1989-2001",
          price: 18000,
          type: "offroad",
        },
        {
          id: "miramar",
          brand: "Ibishu",
          model: "Miramar",
          year: "1963-1994",
          price: 22000,
          type: "classic",
        },
        {
          id: "pessima",
          brand: "Ibishu",
          model: "Pessima",
          year: "1988-2000",
          price: 10000,
          type: "sedan",
        },
        {
          id: "pigeon",
          brand: "Ibishu",
          model: "Pigeon",
          year: "1980-1989",
          price: 3000,
          type: "microcar",
        },
        {
          id: "wigeon",
          brand: "Ibishu",
          model: "Wigeon",
          year: "1980-1989",
          price: 4500,
          type: "microcar",
        },

        // Soliad
        {
          id: "wendover",
          brand: "Soliad",
          model: "Wendover",
          year: "1987-1995",
          price: 14000,
          type: "sedan",
        },
        {
          id: "lansdale",
          brand: "Soliad",
          model: "Lansdale",
          year: "1996-2007",
          price: 22000,
          type: "sedan",
        },

        // SP
        {
          id: "dunekicker",
          brand: "SP",
          model: "Dunekicker",
          year: "2008",
          price: 55000,
          type: "buggy",
        },
        {
          id: "rockbasher",
          brand: "SP",
          model: "Rockbasher",
          year: "2008-2018",
          price: 48000,
          type: "offroad",
        },

        // Wentward
        {
          id: "dt40l",
          brand: "Wentward",
          model: "DT40L",
          year: "1987-1996",
          price: 85000,
          type: "bus",
        },
      ];

      // Lista prawdziwych aut dla trybu Real Life (ceny realne -10%)
      const realLifeCars = [
        // MaÅ‚e / Miejskie
        {
          id: "fiat500",
          brand: "Fiat",
          model: "500",
          year: "2020-2024",
          price: 54000,
          type: "microcar",
        },
        {
          id: "toyota_yaris",
          brand: "Toyota",
          model: "Yaris",
          year: "2020-2024",
          price: 72000,
          type: "hatchback",
        },
        {
          id: "vw_polo",
          brand: "Volkswagen",
          model: "Polo",
          year: "2021-2024",
          price: 81000,
          type: "hatchback",
        },
        {
          id: "skoda_fabia",
          brand: "Å koda",
          model: "Fabia",
          year: "2021-2024",
          price: 67500,
          type: "hatchback",
        },
        {
          id: "opel_corsa",
          brand: "Opel",
          model: "Corsa",
          year: "2020-2024",
          price: 63000,
          type: "hatchback",
        },

        // Kompaktowe
        {
          id: "vw_golf",
          brand: "Volkswagen",
          model: "Golf",
          year: "2020-2024",
          price: 117000,
          type: "hatchback",
        },
        {
          id: "toyota_corolla",
          brand: "Toyota",
          model: "Corolla",
          year: "2020-2024",
          price: 108000,
          type: "sedan",
        },
        {
          id: "mazda3",
          brand: "Mazda",
          model: "3",
          year: "2020-2024",
          price: 99000,
          type: "hatchback",
        },
        {
          id: "honda_civic",
          brand: "Honda",
          model: "Civic",
          year: "2022-2024",
          price: 126000,
          type: "sedan",
        },
        {
          id: "ford_focus",
          brand: "Ford",
          model: "Focus",
          year: "2019-2023",
          price: 90000,
          type: "hatchback",
        },

        // Sedany
        {
          id: "bmw_3",
          brand: "BMW",
          model: "3 Series",
          year: "2020-2024",
          price: 189000,
          type: "sedan",
        },
        {
          id: "mercedes_c",
          brand: "Mercedes-Benz",
          model: "C-Class",
          year: "2021-2024",
          price: 207000,
          type: "sedan",
        },
        {
          id: "audi_a4",
          brand: "Audi",
          model: "A4",
          year: "2020-2024",
          price: 180000,
          type: "sedan",
        },
        {
          id: "skoda_octavia",
          brand: "Å koda",
          model: "Octavia",
          year: "2020-2024",
          price: 108000,
          type: "sedan",
        },
        {
          id: "toyota_camry",
          brand: "Toyota",
          model: "Camry",
          year: "2020-2024",
          price: 144000,
          type: "sedan",
        },

        // SUV
        {
          id: "toyota_rav4",
          brand: "Toyota",
          model: "RAV4",
          year: "2020-2024",
          price: 162000,
          type: "suv",
        },
        {
          id: "vw_tiguan",
          brand: "Volkswagen",
          model: "Tiguan",
          year: "2020-2024",
          price: 153000,
          type: "suv",
        },
        {
          id: "bmw_x3",
          brand: "BMW",
          model: "X3",
          year: "2021-2024",
          price: 243000,
          type: "suv",
        },
        {
          id: "mercedes_glc",
          brand: "Mercedes-Benz",
          model: "GLC",
          year: "2020-2024",
          price: 252000,
          type: "suv",
        },
        {
          id: "audi_q5",
          brand: "Audi",
          model: "Q5",
          year: "2020-2024",
          price: 234000,
          type: "suv",
        },
        {
          id: "volvo_xc60",
          brand: "Volvo",
          model: "XC60",
          year: "2020-2024",
          price: 225000,
          type: "suv",
        },
        {
          id: "hyundai_tucson",
          brand: "Hyundai",
          model: "Tucson",
          year: "2021-2024",
          price: 135000,
          type: "suv",
        },
        {
          id: "kia_sportage",
          brand: "Kia",
          model: "Sportage",
          year: "2022-2024",
          price: 126000,
          type: "suv",
        },

        // Sportowe
        {
          id: "porsche_911",
          brand: "Porsche",
          model: "911 Carrera",
          year: "2020-2024",
          price: 630000,
          type: "sport",
        },
        {
          id: "bmw_m4",
          brand: "BMW",
          model: "M4",
          year: "2021-2024",
          price: 450000,
          type: "sport",
        },
        {
          id: "audi_rs6",
          brand: "Audi",
          model: "RS6 Avant",
          year: "2020-2024",
          price: 585000,
          type: "sport",
        },
        {
          id: "mercedes_amg_gt",
          brand: "Mercedes-AMG",
          model: "GT",
          year: "2020-2024",
          price: 720000,
          type: "supercar",
        },
        {
          id: "ford_mustang",
          brand: "Ford",
          model: "Mustang GT",
          year: "2020-2024",
          price: 270000,
          type: "muscle",
        },
        {
          id: "chevrolet_camaro",
          brand: "Chevrolet",
          model: "Camaro SS",
          year: "2020-2024",
          price: 243000,
          type: "muscle",
        },
        {
          id: "nissan_gtr",
          brand: "Nissan",
          model: "GT-R",
          year: "2020-2024",
          price: 540000,
          type: "sport",
        },
        {
          id: "toyota_supra",
          brand: "Toyota",
          model: "GR Supra",
          year: "2020-2024",
          price: 270000,
          type: "sport",
        },

        // Elektryczne
        {
          id: "tesla_model3",
          brand: "Tesla",
          model: "Model 3",
          year: "2020-2024",
          price: 180000,
          type: "electric",
        },
        {
          id: "tesla_modelS",
          brand: "Tesla",
          model: "Model S",
          year: "2020-2024",
          price: 450000,
          type: "electric",
        },
        {
          id: "bmw_i4",
          brand: "BMW",
          model: "i4",
          year: "2022-2024",
          price: 270000,
          type: "electric",
        },
        {
          id: "mercedes_eqs",
          brand: "Mercedes-Benz",
          model: "EQS",
          year: "2022-2024",
          price: 540000,
          type: "electric",
        },
        {
          id: "porsche_taycan",
          brand: "Porsche",
          model: "Taycan",
          year: "2020-2024",
          price: 450000,
          type: "electric",
        },

        // Pickupy / Terenowe
        {
          id: "ford_ranger",
          brand: "Ford",
          model: "Ranger",
          year: "2020-2024",
          price: 180000,
          type: "pickup",
        },
        {
          id: "toyota_hilux",
          brand: "Toyota",
          model: "Hilux",
          year: "2020-2024",
          price: 189000,
          type: "pickup",
        },
        {
          id: "jeep_wrangler",
          brand: "Jeep",
          model: "Wrangler",
          year: "2020-2024",
          price: 270000,
          type: "offroad",
        },
        {
          id: "land_rover_defender",
          brand: "Land Rover",
          model: "Defender",
          year: "2020-2024",
          price: 315000,
          type: "offroad",
        },

        // Vany / Dostawcze
        {
          id: "vw_transporter",
          brand: "Volkswagen",
          model: "Transporter",
          year: "2020-2024",
          price: 180000,
          type: "van",
        },
        {
          id: "ford_transit",
          brand: "Ford",
          model: "Transit",
          year: "2020-2024",
          price: 162000,
          type: "van",
        },
        {
          id: "mercedes_sprinter",
          brand: "Mercedes-Benz",
          model: "Sprinter",
          year: "2020-2024",
          price: 189000,
          type: "van",
        },

        // Luksusowe
        {
          id: "bmw_7",
          brand: "BMW",
          model: "7 Series",
          year: "2020-2024",
          price: 450000,
          type: "sedan",
        },
        {
          id: "mercedes_s",
          brand: "Mercedes-Benz",
          model: "S-Class",
          year: "2021-2024",
          price: 540000,
          type: "sedan",
        },
        {
          id: "audi_a8",
          brand: "Audi",
          model: "A8",
          year: "2020-2024",
          price: 495000,
          type: "sedan",
        },
        {
          id: "bentley_continental",
          brand: "Bentley",
          model: "Continental GT",
          year: "2020-2024",
          price: 990000,
          type: "supercar",
        },
        {
          id: "rolls_royce_ghost",
          brand: "Rolls-Royce",
          model: "Ghost",
          year: "2020-2024",
          price: 1530000,
          type: "sedan",
        },
      ];

      // ==================== SYSTEM TRYBU GRY ====================
      // gameMode jest zdefiniowane wczeÅ›niej (przed loadSaveData)

      function getCurrentCars() {
        return gameMode === "reallife" ? realLifeCars : beamngCars;
      }

      function switchGameMode(mode) {
        const save = getCurrentSave();
        if (!save) return;

        // Zatrzymaj wszystkie ulepszania przed zmianÄ… trybu
        Object.keys(upgradeIntervals).forEach((idx) => {
          clearInterval(upgradeIntervals[idx]);
        });
        upgradeIntervals = {};

        // Zapisz aktualny stan do obecnego trybu
        saveModeData(gameMode);

        // ZmieÅ„ tryb
        gameMode = mode;
        localStorage.setItem("beamng_gameMode", mode);

        // ZaÅ‚aduj dane dla nowego trybu lub utwÃ³rz nowe
        loadModeData(mode);

        // Aktualizuj UI
        updateGameModeUI();
        updateAllDisplays();
        renderGarageModal();
        closeModal("gameMode");
      }

      function saveModeData(mode) {
        const save = getCurrentSave();
        if (!save) return;

        const modeKey = mode === "reallife" ? "realLifeData" : "beamngData";
        save[modeKey] = {
          money: money,
          garage: [...garage],
          spent: spent,
          debt: debt,
          debtDeadline: debtDeadline,
          totalTaxPaid: totalTaxPaid,
          health: health,
          food: food,
          water: water,
          backpack: [...backpack],
          activeInsurances: [...activeInsurances],
        };
        localStorage.setItem("beamng_saves", JSON.stringify(saves));
      }

      function loadModeData(mode) {
        const save = getCurrentSave();
        if (!save) return;

        const modeKey = mode === "reallife" ? "realLifeData" : "beamngData";
        const data = save[modeKey];

        if (data) {
          // ZaÅ‚aduj istniejÄ…ce dane
          money = data.money;
          garage = data.garage || [];
          spent = data.spent || 0;
          debt = data.debt || 0;
          debtDeadline = data.debtDeadline || null;
          totalTaxPaid = data.totalTaxPaid || 0;
          health = data.health || 100;
          food = data.food || 1000;
          water = data.water || 1000;
          backpack = data.backpack || [];
          activeInsurances = data.activeInsurances || [];
        } else {
          // Pierwszy raz w tym trybie - nowy start
          money = 1500;
          garage = [];
          spent = 0;
          debt = 0;
          debtDeadline = null;
          totalTaxPaid = 0;
          health = 100;
          food = 1000;
          water = 1000;
          backpack = [];
          activeInsurances = [];
        }

        // WznÃ³w ulepszania
        resumeUpgrades();
      }

      function updateGameModeUI() {
        const title = document.getElementById("gameModeTitle");
        const subtitle = document.getElementById("gameModeSubtitle");
        const t = translations[currentLang] || translations.en;

        // Elementy karty
        const cardBtn = document.querySelector('[data-translate="card"]');
        const cardTitle = document.querySelector(
          '#modalCard h2 [data-translate="card"]'
        );
        const cardLogo = document.querySelector(".card-logo");
        const pinInfo = document.querySelector(
          '[data-translate="enter6digitPin"]'
        );

        // Elementy bonÃ³w
        const vouchersTitle = document.querySelector(
          '#modalVouchers h2 [data-translate="vouchers"]'
        );
        const createVoucherBtns = document.querySelectorAll(
          '[data-translate="createVoucher"]'
        );
        const vouchersToSendTitle = document.querySelector(
          '[data-translate="vouchersToSend"]'
        );
        const receivedVouchersTitle = document.querySelector(
          '[data-translate="receivedVouchers"]'
        );
        const shareVoucherTitle = document.querySelector(
          '#modalShareVoucher h2 [data-translate="shareVoucher"]'
        );

        if (gameMode === "reallife") {
          title.textContent = "ğŸŒ Real Life";
          subtitle.textContent = t.simulator || "Symulator";
          document.body.style.background =
            "linear-gradient(135deg, #064e3b 0%, #022c22 100%)";

          // ZmieÅ„ nazwÄ™ karty
          if (cardBtn)
            cardBtn.textContent = t.cardRealLife || "Karta Real-Card";
          if (cardTitle)
            cardTitle.textContent = t.cardRealLife || "Karta Real-Card";
          if (cardLogo) cardLogo.textContent = "Real-Card";
          if (pinInfo)
            pinInfo.textContent =
              currentLang === "pl"
                ? "Wpisz 6-cyfrowy PIN z karty Real-Card"
                : "Enter 6-digit PIN from Real-Card";

          // ZmieÅ„ nazwy bonÃ³w na kupony
          if (vouchersTitle)
            vouchersTitle.textContent = t.vouchersRealLife || "Kupony";
          createVoucherBtns.forEach(
            (btn) =>
              (btn.textContent = t.createVoucherRealLife || "UtwÃ³rz kupon")
          );
          if (vouchersToSendTitle)
            vouchersToSendTitle.textContent =
              currentLang === "pl" ? "Kupony do wysÅ‚ania" : "Coupons to send";
          if (receivedVouchersTitle)
            receivedVouchersTitle.textContent =
              currentLang === "pl" ? "Otrzymane kupony" : "Received coupons";
          if (shareVoucherTitle)
            shareVoucherTitle.textContent =
              currentLang === "pl" ? "WyÅ›lij kupon" : "Send coupon";
        } else {
          title.textContent = "ğŸš— BeamNG Drive";
          subtitle.textContent = "Datapack";
          document.body.style.background =
            "linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)";

          // ZmieÅ„ nazwÄ™ karty
          if (cardBtn) cardBtn.textContent = t.card || "Karta Beam-Pay";
          if (cardTitle) cardTitle.textContent = t.card || "Karta Beam-Pay";
          if (cardLogo) cardLogo.textContent = "Beam-Pay";
          if (pinInfo)
            pinInfo.textContent =
              currentLang === "pl"
                ? "Wpisz 6-cyfrowy PIN z karty Beam-Pay"
                : "Enter 6-digit PIN from Beam-Pay Card";

          // ZmieÅ„ nazwy bonÃ³w
          if (vouchersTitle) vouchersTitle.textContent = t.vouchers || "Bony";
          createVoucherBtns.forEach(
            (btn) => (btn.textContent = t.createVoucher || "UtwÃ³rz bon")
          );
          if (vouchersToSendTitle)
            vouchersToSendTitle.textContent =
              currentLang === "pl" ? "Bony do wysÅ‚ania" : "Vouchers to send";
          if (receivedVouchersTitle)
            receivedVouchersTitle.textContent =
              currentLang === "pl" ? "Otrzymane bony" : "Received vouchers";
          if (shareVoucherTitle)
            shareVoucherTitle.textContent =
              currentLang === "pl" ? "WyÅ›lij bon" : "Send voucher";
        }

        // PodÅ›wietl aktywny tryb w modalu
        const beamngBtn = document.getElementById("modeBeamNG");
        const reallifeBtn = document.getElementById("modeRealLife");

        if (beamngBtn && reallifeBtn) {
          beamngBtn.style.borderColor =
            gameMode === "beamng" ? "#fff" : "transparent";
          reallifeBtn.style.borderColor =
            gameMode === "reallife" ? "#fff" : "transparent";
        }
      }

      // ==================== UI SAVE'Ã“W ====================
      function renderSavesList() {
        const list = document.getElementById("savesList");
        const t = translations[currentLang] || translations.en;
        const activeText = t.active || "aktywny";

        list.innerHTML = saves
          .map((save) => {
            const isCurrent = save.id === currentSaveId;

            // SprawdÅº checkpoint dla aktywnego save'a
            const modeKey =
              gameMode === "reallife"
                ? "realLifeCheckpoint"
                : "beamngCheckpoint";
            const hasCheckpoint = save[modeKey] ? true : false;
            const checkpointDate = hasCheckpoint
              ? new Date(save[modeKey].createdAt).toLocaleString()
              : null;

            // Pobierz dane z odpowiedniego trybu
            const modeDataKey =
              gameMode === "reallife" ? "realLifeData" : "beamngData";
            const modeData = save[modeDataKey] || save.data;
            const garageCount =
              modeData?.garage?.length || save.data?.garage?.length || 0;
            const saveMoney = modeData?.money ?? save.data?.money ?? 0;

            return `
                    <div style="padding:12px;margin-bottom:8px;background:${
                      isCurrent ? "rgba(74,222,128,0.2)" : "rgba(0,0,0,0.2)"
                    };border:2px solid ${
              isCurrent ? "#4ade80" : "#333"
            };border-radius:10px;">
                        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;">
                            <div style="flex:1;min-width:120px;">
                                <div style="font-weight:bold;font-size:1em;">${
                                  save.name
                                }</div>
                                <div style="font-size:0.8em;color:#888;">${saveMoney.toLocaleString()} ${getCurrency()} | ğŸš— ${garageCount}</div>
                            </div>
                            <div style="display:flex;gap:8px;flex-shrink:0;">
                                <button onclick="renameSave('${
                                  save.id
                                }')" style="padding:10px 14px;background:#f59e0b;color:white;border:none;border-radius:8px;cursor:pointer;font-size:1em;min-width:44px;min-height:44px;-webkit-tap-highlight-color:transparent;">âœï¸</button>
                                ${
                                  !isCurrent
                                    ? `<button onclick="switchSave('${save.id}')" style="padding:10px 16px;background:#3b82f6;color:white;border:none;border-radius:8px;cursor:pointer;font-size:1em;min-width:44px;min-height:44px;-webkit-tap-highlight-color:transparent;">â–¶</button>`
                                    : `<span style="color:#4ade80;font-size:0.85em;padding:10px;">âœ“ ${activeText}</span>`
                                }
                                ${
                                  saves.length > 1
                                    ? `<button onclick="handleDeleteSave('${save.id}')" style="padding:10px 16px;background:#ef4444;color:white;border:none;border-radius:8px;cursor:pointer;font-size:1em;min-width:44px;min-height:44px;-webkit-tap-highlight-color:transparent;">ğŸ—‘ï¸</button>`
                                    : ""
                                }
                            </div>
                        </div>
                        ${
                          isCurrent
                            ? `
                            <div style="margin-top:10px;padding-top:10px;border-top:1px solid #333;">
                                <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;">
                                    <div style="font-size:0.85em;">
                                        ${
                                          hasCheckpoint
                                            ? `
                                            <span style="color:#4ade80;">ğŸ’¾ ${
                                              t.checkpoint || "Checkpoint"
                                            }: ${checkpointDate}</span>
                                        `
                                            : `
                                            <span style="color:#888;">ğŸ“­ ${
                                              t.noCheckpoint ||
                                              "Brak checkpointu"
                                            }</span>
                                        `
                                        }
                                    </div>
                                    <div style="display:flex;gap:6px;">
                                        <button onclick="createCheckpoint()" style="padding:8px 12px;background:#10b981;color:white;border:none;border-radius:6px;cursor:pointer;font-size:0.85em;">
                                            ğŸ’¾ ${t.saveCheckpoint || "Zapisz"}
                                        </button>
                                        ${
                                          hasCheckpoint
                                            ? `
                                            <button onclick="deleteCheckpoint()" style="padding:8px 12px;background:#ef4444;color:white;border:none;border-radius:6px;cursor:pointer;font-size:0.85em;">
                                                ğŸ—‘ï¸
                                            </button>
                                        `
                                            : ""
                                        }
                                    </div>
                                </div>
                            </div>
                        `
                            : ""
                        }
                    </div>
                `;
          })
          .join("");
      }

      function renameSave(saveId) {
        const save = saves.find((s) => s.id === saveId);
        if (!save) return;

        const t = translations[currentLang] || translations.en;
        const newName = prompt(
          t.enterNewName || "WprowadÅº nowÄ… nazwÄ™:",
          save.name
        );

        if (newName && newName.trim()) {
          save.name = newName.trim();
          localStorage.setItem("beamng_saves", JSON.stringify(saves));
          renderSavesList();
          updateCurrentSaveDisplay();
        }
      }

      function handleCreateSave() {
        const nameInput = document.getElementById("newSaveName");
        const name = nameInput.value.trim() || "Save " + (saves.length + 1);

        const newSave = createSave(name);
        nameInput.value = "";

        renderSavesList();
        updateCurrentSaveDisplay();

        const t = translations[currentLang] || translations.en;
        alert(t.saveCreated || "Save utworzony!");
      }

      function handleDeleteSave(saveId) {
        const t = translations[currentLang] || translations.en;
        if (confirm(t.confirmDeleteSave || "UsunÄ…Ä‡ ten save?")) {
          if (deleteSave(saveId)) {
            renderSavesList();
            updateAllDisplays();
            updateCurrentSaveDisplay();
          }
        }
      }

      function updateCurrentSaveDisplay() {
        const display = document.getElementById("currentSaveDisplay");
        const save = getCurrentSave();
        if (display && save) {
          display.textContent = "ğŸ’¾ " + save.name;
        }
      }

      // ==================== UI BONÃ“W ====================
      let currentVoucherToShare = null;

      function renderVouchersList() {
        const toSendList = document.getElementById("vouchersToSendList");
        const receivedList = document.getElementById("receivedVouchersList");
        const t = translations[currentLang] || translations.en;
        const save = getCurrentSave();

        const noVouchersText =
          gameMode === "reallife"
            ? currentLang === "pl"
              ? "Brak kuponÃ³w"
              : "No coupons"
            : t.noVouchers || "Brak bonÃ³w";
        const noReceivedText =
          gameMode === "reallife"
            ? currentLang === "pl"
              ? "Brak otrzymanych kuponÃ³w"
              : "No received coupons"
            : t.noReceivedVouchers || "Brak otrzymanych bonÃ³w";

        if (!save || !save.data) {
          if (toSendList)
            toSendList.innerHTML = `<div style="color:#888;text-align:center;padding:15px;font-size:0.9em;">${noVouchersText}</div>`;
          if (receivedList)
            receivedList.innerHTML = `<div style="color:#888;text-align:center;padding:15px;font-size:0.9em;">${noReceivedText}</div>`;
          return;
        }

        // Bony do wysÅ‚ania - filtruj wedÅ‚ug aktualnego trybu
        const allVouchersToSend = save.data.vouchersToSend || [];
        const vouchersToSend = allVouchersToSend.filter(
          (v) => (v.gameMode || "beamng") === gameMode
        );

        if (vouchersToSend.length === 0) {
          toSendList.innerHTML = `<div style="color:#888;text-align:center;padding:15px;font-size:0.9em;">${noVouchersText}</div>`;
        } else {
          toSendList.innerHTML = vouchersToSend
            .map((v, idx) => {
              // ZnajdÅº rzeczywisty indeks w peÅ‚nej tablicy
              const realIdx = allVouchersToSend.findIndex(
                (vv) => vv.id === v.id
              );
              return `
                    <div style="padding:12px;margin-bottom:8px;background:linear-gradient(135deg,rgba(139,92,246,0.2),rgba(168,85,247,0.1));border:2px solid #8b5cf6;border-radius:12px;">
                        ${renderVoucherCard(v)}
                        <div style="font-size:0.75em;color:#f59e0b;text-align:center;margin:8px 0;">â³ ${
                          t.pendingVoucher || "Oczekuje na przyjÄ™cie"
                        }</div>
                        <div style="display:flex;gap:8px;margin-top:10px;">
                            <button onclick="openShareVoucher(${realIdx}, 'toSend')" style="flex:1;padding:10px;background:#8b5cf6;color:white;border:none;border-radius:8px;cursor:pointer;font-size:0.9em;-webkit-tap-highlight-color:transparent;">
                                ğŸ“¤ ${
                                  gameMode === "reallife"
                                    ? currentLang === "pl"
                                      ? "WyÅ›lij"
                                      : "Send"
                                    : t.sendVoucher || "WyÅ›lij"
                                }
                            </button>
                            <button onclick="cancelVoucher(${realIdx})" style="padding:10px 15px;background:#ef4444;color:white;border:none;border-radius:8px;cursor:pointer;font-size:0.9em;-webkit-tap-highlight-color:transparent;">
                                âŒ
                            </button>
                        </div>
                    </div>
                `;
            })
            .join("");
        }

        // Otrzymane bony - filtruj wedÅ‚ug aktualnego trybu
        const allReceivedVouchers = save?.data?.receivedVouchers || [];
        const receivedVouchers = allReceivedVouchers.filter(
          (v) => (v.gameMode || "beamng") === gameMode
        );

        if (receivedVouchers.length === 0) {
          receivedList.innerHTML = `<div style="color:#888;text-align:center;padding:15px;font-size:0.9em;">${noReceivedText}</div>`;
        } else {
          receivedList.innerHTML = receivedVouchers
            .map((v, idx) => {
              // ZnajdÅº rzeczywisty indeks w peÅ‚nej tablicy
              const realIdx = allReceivedVouchers.findIndex(
                (vv) => vv.id === v.id
              );
              return `
                    <div style="padding:12px;margin-bottom:8px;background:linear-gradient(135deg,rgba(16,185,129,0.2),rgba(5,150,105,0.1));border:2px solid #10b981;border-radius:12px;">
                        ${renderVoucherCard(v)}
                        <div style="font-size:0.8em;color:#888;margin-bottom:8px;">${
                          t.voucherFrom || "Od:"
                        } ${v.fromSave || "?"}</div>
                        <div style="display:flex;gap:8px;">
                            <button onclick="acceptVoucher(${realIdx})" style="flex:1;padding:10px;background:#10b981;color:white;border:none;border-radius:8px;cursor:pointer;font-size:0.9em;">
                                âœ… ${t.acceptVoucher || "Przyjmij"}
                            </button>
                            <button onclick="rejectVoucher(${realIdx})" style="flex:1;padding:10px;background:#f59e0b;color:white;border:none;border-radius:8px;cursor:pointer;font-size:0.9em;">
                                â†©ï¸ ${t.rejectVoucher || "PrzekaÅ¼ dalej"}
                            </button>
                        </div>
                    </div>
                `;
            })
            .join("");
        }
      }

      function renderVoucherCard(voucher) {
        const voucherMode = voucher.gameMode || gameMode;
        const isRealLife = voucherMode === "reallife";
        const titleText = isRealLife
          ? currentLang === "pl"
            ? "KUPON PODARUNKOWY"
            : "GIFT COUPON"
          : currentLang === "pl"
          ? "BON PODARUNKOWY"
          : "GIFT VOUCHER";
        const bgGradient = isRealLife
          ? "linear-gradient(145deg,#064e3b,#022c22)"
          : "linear-gradient(145deg,#1a1a2e,#16213e)";
        const borderColor = isRealLife ? "#10b981" : "#8b5cf6";
        const amountColor = isRealLife ? "#10b981" : "#8b5cf6";

        return `
                <div style="background:${bgGradient};border-radius:10px;padding:15px;text-align:center;border:1px dashed ${borderColor};">
                    <div style="font-size:2.5em;margin-bottom:5px;">${
                      isRealLife ? "ğŸ«" : "ğŸ"
                    }</div>
                    <div style="font-size:0.8em;color:#888;text-transform:uppercase;letter-spacing:2px;">${titleText}</div>
                    <div style="font-size:2em;font-weight:bold;color:${amountColor};margin:10px 0;">${voucher.amount.toLocaleString()} ${getCurrency()}</div>
                    ${
                      voucher.message
                        ? `<div style="font-size:0.9em;color:#aaa;font-style:italic;">"${voucher.message}"</div>`
                        : ""
                    }
                </div>
            `;
      }

      function handleCreateVoucher() {
        const amountInput = document.getElementById("voucherAmountInput");
        const messageInput = document.getElementById("voucherMessageInput");
        const t = translations[currentLang] || translations.en;

        const amount = parseInt(amountInput.value);
        if (!amount || amount <= 0) {
          alert(t.invalidAmount || "WprowadÅº prawidÅ‚owÄ… kwotÄ™!");
          return;
        }

        // SprawdÅº czy masz tyle pieniÄ™dzy (uwzglÄ™dnij juÅ¼ utworzone bony)
        const save = getCurrentSave();
        if (!save) return;
        if (!save.data) save.data = {};

        // Filtruj bony tylko z aktualnego trybu
        const pendingTotal = (save.data.vouchersToSend || [])
          .filter((v) => v.gameMode === gameMode)
          .reduce((sum, v) => sum + v.amount, 0);

        if (money - pendingTotal < amount) {
          playSound("error");
          alert(t.notEnoughMoney || "Nie masz wystarczajÄ…co pieniÄ™dzy!");
          return;
        }

        const voucher = {
          id:
            "bon_" + Date.now() + "_" + Math.random().toString(36).substr(2, 6),
          amount: amount,
          message: messageInput.value.trim(),
          createdAt: Date.now(),
          fromSave: save.name,
          fromSaveId: save.id,
          gameMode: gameMode, // Zapisz tryb gry
        };

        // NIE odejmuj pieniÄ™dzy - tylko dodaj do listy oczekujÄ…cych
        if (!save.data.vouchersToSend) save.data.vouchersToSend = [];
        save.data.vouchersToSend.push(voucher);

        saveSaveData();

        amountInput.value = "";
        messageInput.value = "";
        renderVouchersList();

        // Od razu otwÃ³rz udostÄ™pnianie
        currentVoucherToShare = {
          voucher,
          index: save.data.vouchersToSend.length - 1,
          source: "toSend",
        };
        openShareModal();
      }

      function cancelVoucher(idx) {
        const t = translations[currentLang] || translations.en;
        const save = getCurrentSave();

        if (!save.data.vouchersToSend || !save.data.vouchersToSend[idx]) return;

        // Bon jeszcze nie byÅ‚ przyjÄ™ty, wiÄ™c nic nie tracisz
        if (confirm(t.cancelVoucherConfirm || "AnulowaÄ‡ bon?")) {
          save.data.vouchersToSend.splice(idx, 1);
          saveSaveData();
          updateAllDisplays();
          renderVouchersList();
        }
      }

      function openShareVoucher(idx, source) {
        const save = getCurrentSave();
        const vouchers =
          source === "toSend"
            ? save.data.vouchersToSend
            : save.data.receivedVouchers;

        if (!vouchers || !vouchers[idx]) return;

        currentVoucherToShare = { voucher: vouchers[idx], index: idx, source };
        openShareModal();
      }

      function openShareModal() {
        if (!currentVoucherToShare) return;

        const v = currentVoucherToShare.voucher;
        const t = translations[currentLang] || translations.en;

        document.getElementById("shareVoucherPreview").innerHTML =
          renderVoucherCard(v);

        // Generuj przyciski udostÄ™pniania
        const buttonsDiv = document.getElementById("shareVoucherButtons");

        // Lista innych save'Ã³w (nie aktualny)
        const otherSaves = saves.filter((s) => s.id !== currentSaveId);

        buttonsDiv.innerHTML = `
                <p style="margin-bottom:10px;font-weight:bold;">${
                  t.shareTo || "UdostÄ™pnij do:"
                }</p>
                <div style="display:flex;flex-wrap:wrap;gap:10px;margin-bottom:15px;">
                    <button onclick="shareVoucherVia('messenger')" style="flex:1;min-width:120px;padding:12px;background:#0084ff;color:white;border:none;border-radius:10px;cursor:pointer;font-size:1em;">
                        ğŸ’¬ Messenger
                    </button>
                    <button onclick="shareVoucherVia('whatsapp')" style="flex:1;min-width:120px;padding:12px;background:#25d366;color:white;border:none;border-radius:10px;cursor:pointer;font-size:1em;">
                        ğŸ“± WhatsApp
                    </button>
                    <button onclick="shareVoucherVia('sms')" style="flex:1;min-width:120px;padding:12px;background:#8b5cf6;color:white;border:none;border-radius:10px;cursor:pointer;font-size:1em;">
                        ğŸ“¨ SMS
                    </button>
                    <button onclick="shareVoucherVia('email')" style="flex:1;min-width:120px;padding:12px;background:#ef4444;color:white;border:none;border-radius:10px;cursor:pointer;font-size:1em;">
                        ğŸ“§ Email
                    </button>
                </div>
                ${
                  otherSaves.length > 0
                    ? `
                    <p style="margin-bottom:10px;font-weight:bold;border-top:1px solid #333;padding-top:15px;">${
                      t.sendToOtherSave || "Lub wyÅ›lij na inny zapis:"
                    }</p>
                    <div style="display:flex;flex-direction:column;gap:8px;">
                        ${otherSaves
                          .map(
                            (s) => `
                            <button onclick="sendVoucherToSave('${s.id}')" style="padding:12px;background:rgba(0,0,0,0.3);color:white;border:2px solid #333;border-radius:10px;cursor:pointer;font-size:1em;text-align:left;">
                                ğŸ’¾ ${s.name}
                            </button>
                        `
                          )
                          .join("")}
                    </div>
                `
                    : ""
                }
            `;

        openModal("shareVoucher");
      }

      function getVoucherLink(voucher) {
        // Generuj czytelny link z parametrami
        const baseUrl = window.location.href.split("?")[0].split("#")[0];
        const params = new URLSearchParams();
        params.set("vid", voucher.id);
        params.set("amount", voucher.amount);
        params.set("from", voucher.fromSave);
        params.set("fromId", voucher.fromSaveId);
        params.set("mode", voucher.gameMode || gameMode); // Dodaj tryb gry
        if (voucher.message) params.set("msg", voucher.message);
        return baseUrl + "?" + params.toString();
      }

      function getShareMessage(voucher) {
        const t = translations[currentLang] || translations.en;
        const genderMsg = t.youReceivedVoucher || "DostaÅ‚eÅ›/aÅ› bon o wartoÅ›ci";
        return `ğŸ ${genderMsg} ${voucher.amount.toLocaleString()} ${getCurrency()}!\n\n`;
      }

      function shareVoucherVia(method) {
        if (!currentVoucherToShare) return;

        const v = currentVoucherToShare.voucher;
        const link = getVoucherLink(v);
        const message = getShareMessage(v);
        const fullText = message + link;

        switch (method) {
          case "whatsapp":
            window.open(
              "https://wa.me/?text=" + encodeURIComponent(fullText),
              "_blank"
            );
            break;
          case "messenger":
            window.open(
              "https://www.facebook.com/dialog/send?link=" +
                encodeURIComponent(link) +
                "&app_id=0&redirect_uri=" +
                encodeURIComponent(window.location.href),
              "_blank"
            );
            break;
          case "email":
            const subject =
              currentLang === "pl"
                ? "Bon podarunkowy BeamNG"
                : "BeamNG Gift Voucher";
            window.open(
              "mailto:?subject=" +
                encodeURIComponent(subject) +
                "&body=" +
                encodeURIComponent(fullText),
              "_blank"
            );
            break;
          case "sms":
            window.open("sms:?body=" + encodeURIComponent(fullText), "_blank");
            break;
        }

        closeModal("shareVoucher");
      }

      function sendVoucherToSave(targetSaveId) {
        if (!currentVoucherToShare) return;

        const t = translations[currentLang] || translations.en;
        const v = currentVoucherToShare.voucher;
        const targetSave = saves.find((s) => s.id === targetSaveId);

        if (!targetSave) return;

        // Dodaj bon do receivedVouchers w docelowym save'ie
        if (!targetSave.data.receivedVouchers)
          targetSave.data.receivedVouchers = [];
        targetSave.data.receivedVouchers.push({
          id: v.id,
          amount: v.amount,
          message: v.message,
          fromSave: v.fromSave,
          fromSaveId: v.fromSaveId,
          receivedAt: Date.now(),
        });

        localStorage.setItem("beamng_saves", JSON.stringify(saves));

        alert(
          `${t.voucherSentToSave || "Bon wysÅ‚any do"} "${targetSave.name}"!`
        );
        closeModal("shareVoucher");
        renderVouchersList();
      }

      function acceptVoucher(idx) {
        const save = getCurrentSave();
        if (!save.data.receivedVouchers || !save.data.receivedVouchers[idx])
          return;

        const voucher = save.data.receivedVouchers[idx];

        // ZnajdÅº save nadawcy i odejmij mu pieniÄ…dze
        const senderSave = saves.find((s) => s.id === voucher.fromSaveId);
        if (senderSave) {
          // UsuÅ„ bon z listy oczekujÄ…cych nadawcy
          if (senderSave.data.vouchersToSend) {
            const vIdx = senderSave.data.vouchersToSend.findIndex(
              (v) => v.id === voucher.id
            );
            if (vIdx !== -1) {
              senderSave.data.vouchersToSend.splice(vIdx, 1);
            }
          }
          // Odejmij pieniÄ…dze nadawcy
          senderSave.data.money = (senderSave.data.money || 0) - voucher.amount;
        }

        // Dodaj pieniÄ…dze odbiorcy
        money += voucher.amount;
        save.data.receivedVouchers.splice(idx, 1);

        saveSaveData();
        localStorage.setItem("beamng_saves", JSON.stringify(saves));
        updateAllDisplays();
        renderVouchersList();

        playSound("voucher");
        const t = translations[currentLang] || translations.en;
        alert(
          `âœ… ${
            t.voucherAccepted || "Bon przyjÄ™ty!"
          }\n+${voucher.amount.toLocaleString()} ${getCurrency()}`
        );
      }

      function rejectVoucher(idx) {
        const save = getCurrentSave();
        if (!save.data.receivedVouchers || !save.data.receivedVouchers[idx])
          return;

        // PrzenieÅ› do bonÃ³w do wysÅ‚ania (przekaÅ¼ dalej)
        const voucher = save.data.receivedVouchers[idx];
        voucher.fromSave = save.name;
        voucher.fromSaveId = save.id; // Teraz to ty wysyÅ‚asz

        if (!save.data.vouchersToSend) save.data.vouchersToSend = [];
        save.data.vouchersToSend.push(voucher);
        save.data.receivedVouchers.splice(idx, 1);

        saveSaveData();
        renderVouchersList();

        // Od razu otwÃ³rz udostÄ™pnianie
        currentVoucherToShare = {
          voucher,
          index: save.data.vouchersToSend.length - 1,
          source: "toSend",
        };
        openShareModal();
      }

      // SprawdÅº czy w URL jest bon do odebrania
      function checkUrlForVoucher() {
        const urlParams = new URLSearchParams(window.location.search);

        // Nowy format: ?vid=...&amount=...&from=...&fromId=...&mode=...
        const vid = urlParams.get("vid");
        const amount = urlParams.get("amount");
        const from = urlParams.get("from");
        const fromId = urlParams.get("fromId");
        const msg = urlParams.get("msg");
        const mode = urlParams.get("mode"); // Tryb gry bonu

        if (vid && amount && fromId) {
          const voucher = {
            id: vid,
            amount: parseInt(amount),
            fromSave: from || "?",
            fromSaveId: fromId,
            message: msg || "",
            gameMode: mode || "beamng", // DomyÅ›lnie beamng dla starych linkÃ³w
          };
          showReceivedVoucherModal(voucher);

          // UsuÅ„ parametry z URL
          window.history.replaceState(
            {},
            document.title,
            window.location.pathname
          );
        }
      }

      function showReceivedVoucherModal(voucher) {
        const t = translations[currentLang] || translations.en;

        // Nazwa trybu gry
        const modeName =
          voucher.gameMode === "reallife"
            ? currentLang === "pl"
              ? "Real Life"
              : "Real Life"
            : "BeamNG";
        const voucherTypeName =
          voucher.gameMode === "reallife"
            ? currentLang === "pl"
              ? "kupon"
              : "coupon"
            : currentLang === "pl"
            ? "bon"
            : "voucher";

        document.getElementById("voucherPreviewContent").innerHTML = `
                <div style="text-align:center;margin-bottom:20px;">
                    <div style="font-size:1.2em;color:#888;margin-bottom:15px;">${
                      t.youReceivedVoucher || "DostaÅ‚eÅ›/aÅ› bon o wartoÅ›ci"
                    }</div>
                    ${renderVoucherCard(voucher)}
                    <div style="font-size:0.9em;color:#888;margin-top:10px;">${
                      t.voucherFrom || "Od:"
                    } ${voucher.fromSave || "?"}</div>
                    <div style="font-size:0.85em;margin-top:8px;padding:6px 12px;background:${
                      voucher.gameMode === "reallife"
                        ? "rgba(16,185,129,0.2)"
                        : "rgba(255,107,53,0.2)"
                    };border-radius:20px;display:inline-block;">
                        ${
                          voucher.gameMode === "reallife" ? "ğŸŒ" : "ğŸš—"
                        } ${modeName}
                    </div>
                </div>
                
                <div style="display:flex;gap:10px;">
                    <button onclick="acceptReceivedVoucher()" style="flex:1;padding:15px;background:#10b981;color:white;border:none;border-radius:10px;font-size:1em;cursor:pointer;">
                        âœ… ${t.acceptVoucher || "Przyjmij"}
                    </button>
                    <button onclick="rejectReceivedVoucher()" style="flex:1;padding:15px;background:#f59e0b;color:white;border:none;border-radius:10px;font-size:1em;cursor:pointer;">
                        â†©ï¸ ${t.rejectVoucher || "PrzekaÅ¼ dalej"}
                    </button>
                </div>
            `;

        // Zapisz tymczasowo
        window.tempReceivedVoucher = voucher;
        openModal("voucherPreview");
      }

      function acceptReceivedVoucher() {
        if (!window.tempReceivedVoucher) return;

        const voucher = window.tempReceivedVoucher;
        const save = getCurrentSave();
        const t = translations[currentLang] || translations.en;
        const voucherMode = voucher.gameMode || "beamng";

        // ZnajdÅº save nadawcy (jeÅ›li na tym samym urzÄ…dzeniu)
        const senderSave = saves.find((s) => s.id === voucher.fromSaveId);
        if (senderSave) {
          // UsuÅ„ bon z listy oczekujÄ…cych nadawcy
          if (senderSave.data.vouchersToSend) {
            const vIdx = senderSave.data.vouchersToSend.findIndex(
              (v) => v.id === voucher.id
            );
            if (vIdx !== -1) {
              senderSave.data.vouchersToSend.splice(vIdx, 1);
            }
          }
          // Odejmij pieniÄ…dze nadawcy z odpowiedniego trybu
          const senderModeKey =
            voucherMode === "reallife" ? "realLifeData" : "beamngData";
          if (senderSave[senderModeKey]) {
            senderSave[senderModeKey].money =
              (senderSave[senderModeKey].money || 0) - voucher.amount;
          }
          localStorage.setItem("beamng_saves", JSON.stringify(saves));
        }

        // Dodaj pieniÄ…dze odbiorcy do odpowiedniego trybu
        const receiverModeKey =
          voucherMode === "reallife" ? "realLifeData" : "beamngData";

        // Upewnij siÄ™ Å¼e dane trybu istniejÄ…
        if (!save[receiverModeKey]) {
          save[receiverModeKey] = {
            money: 1500,
            garage: [],
            spent: 0,
            debt: 0,
            health: 100,
            food: 1000,
            water: 1000,
            backpack: [],
            activeInsurances: [],
          };
        }
        save[receiverModeKey].money =
          (save[receiverModeKey].money || 0) + voucher.amount;

        // JeÅ›li jesteÅ›my w tym samym trybie, zaktualizuj teÅ¼ lokalnÄ… zmiennÄ…
        if (voucherMode === gameMode) {
          money += voucher.amount;
        }

        localStorage.setItem("beamng_saves", JSON.stringify(saves));
        updateAllDisplays();
        closeModal("voucherPreview");

        playSound("voucher");
        const modeName = voucherMode === "reallife" ? "Real Life" : "BeamNG";
        const voucherTypeName =
          voucherMode === "reallife"
            ? currentLang === "pl"
              ? "Kupon przyjÄ™ty!"
              : "Coupon accepted!"
            : currentLang === "pl"
            ? "Bon przyjÄ™ty!"
            : "Voucher accepted!";
        alert(
          `âœ… ${voucherTypeName}\n+${voucher.amount.toLocaleString()} ${getCurrency()} (${modeName})`
        );

        window.tempReceivedVoucher = null;
      }

      function rejectReceivedVoucher() {
        if (!window.tempReceivedVoucher) return;

        const voucher = window.tempReceivedVoucher;
        const save = getCurrentSave();

        voucher.fromSave = save.name;
        voucher.fromSaveId = save.id;
        if (!save.data.vouchersToSend) save.data.vouchersToSend = [];
        save.data.vouchersToSend.push(voucher);

        saveSaveData();
        closeModal("voucherPreview");

        // Od razu otwÃ³rz udostÄ™pnianie
        currentVoucherToShare = {
          voucher,
          index: save.data.vouchersToSend.length - 1,
          source: "toSend",
        };
        openShareModal();

        window.tempReceivedVoucher = null;
      }

      // ==================== UI NAPRAWY ====================
      let selectedRepairCarIndex = null;

      function renderRepairCarList() {
        const list = document.getElementById("repairCarList");
        const t = translations[currentLang] || translations.en;

        // Filtruj tylko zepsute auta
        const brokenCars = garage.filter((car) => car.broken);

        if (brokenCars.length === 0) {
          list.innerHTML = `<div style="color:#888;text-align:center;padding:20px;">
                    <div style="font-size:3em;margin-bottom:10px;">âœ…</div>
                    <p>${t.noBrokenCars || "Wszystkie auta sÄ… sprawne!"}</p>
                    <p style="font-size:0.85em;margin-top:10px;">${
                      t.goToGarage || "IdÅº do GaraÅ¼u Å¼eby ulepszaÄ‡ auta"
                    }</p>
                </div>`;
          document.getElementById("repairResponse").style.display = "none";
          document.getElementById("repairBtn").style.display = "none";
          return;
        }

        list.innerHTML = brokenCars
          .map((car, idx) => {
            const realIdx = garage.findIndex((c) => c.id === car.id);
            return `
                    <div class="garage-item" onclick="selectCarForRepair(${realIdx})" style="cursor:pointer;background:rgba(239,68,68,0.1);border:2px solid ${
              selectedRepairCarIndex === realIdx ? "#f59e0b" : "#ef4444"
            };${
              selectedRepairCarIndex === realIdx
                ? "background:rgba(245,158,11,0.1);"
                : ""
            }">
                        <div>
                            <div class="car-name">ğŸ”§ ${car.brand} ${
              car.model
            }</div>
                            <div style="font-size:0.8em;color:#888;">${
                              car.year || ""
                            }</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="color:#ef4444;font-size:0.9em;">${
                              t.repairCost || "Koszt"
                            }: 150 ${getCurrency()}</div>
                            ${
                              selectedRepairCarIndex === realIdx
                                ? '<span style="color:#f59e0b;">âœ“ wybrane</span>'
                                : ""
                            }
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      function selectCarForRepair(idx) {
        selectedRepairCarIndex = idx;
        renderRepairCarList();
        document.getElementById("repairResponse").style.display = "block";
        document.getElementById("repairBtn").style.display = "block";

        // Aktualizuj wyÅ›wietlany koszt
        const insuranceHelp = getRepairInsuranceHelp();
        const finalCost = Math.max(0, 150 - insuranceHelp);
        document.getElementById(
          "repairCostDisplay"
        ).textContent = `-${finalCost.toLocaleString()} ${getCurrency()}`;
      }

      function confirmRepair() {
        const t = translations[currentLang] || translations.en;
        const repairCost = 150; // Koszt naprawy zepsutego auta

        if (
          selectedRepairCarIndex === null ||
          selectedRepairCarIndex >= garage.length
        ) {
          alert(t.selectCarToRepair || "Wybierz auto do naprawy!");
          return;
        }

        const car = garage[selectedRepairCarIndex];

        if (!car.broken) {
          alert(t.carNotBroken || "To auto nie jest zepsute!");
          return;
        }

        // SprawdÅº czy ma ubezpieczenie na naprawÄ™
        const insuranceHelp = getRepairInsuranceHelp();
        const finalCost = Math.max(0, repairCost - insuranceHelp);

        if (money < finalCost) {
          // Dodaj do dÅ‚ugÃ³w
          const save = getCurrentSave();
          if (!save.data.debts) save.data.debts = [];
          save.data.debts.push({
            type: "repair",
            amount: finalCost,
            description: `${t.repairDebt || "Naprawa auta"}: ${car.brand} ${
              car.model
            }`,
            date: Date.now(),
          });
          car.broken = false;
          saveState();
          updateAllDisplays();
          closeModal("repair");
          playSound("repair");
          alert(
            `ğŸ”§ ${car.brand} ${car.model} - ${
              t.repaired || "Naprawione!"
            }\nğŸ’³ ${
              t.addedToDebt || "Dodano do dÅ‚ugu"
            }: ${finalCost.toLocaleString()} ${getCurrency()}`
          );
        } else {
          money -= finalCost;
          spent += finalCost;
          car.broken = false;
          saveState();
          updateAllDisplays();
          closeModal("repair");
          playSound("repair");

          let msg = `ğŸ”§ ${car.brand} ${car.model} - ${
            t.repaired || "Naprawione!"
          }\n-${finalCost.toLocaleString()} ${getCurrency()}`;
          if (insuranceHelp > 0) {
            msg += `\nğŸ›¡ï¸ ${
              t.insuranceCovered || "Ubezpieczenie pokryÅ‚o"
            }: ${insuranceHelp.toLocaleString()} ${getCurrency()}`;
          }
          alert(msg);
        }

        selectedRepairCarIndex = null;
      }

      function getRepairInsuranceHelp() {
        const save = getCurrentSave();
        const activeIns = save.data.activeInsurances || [];
        let help = 0;

        activeIns.forEach((ins) => {
          if (ins.type === "repair" && ins.coveragePercent) {
            help = Math.max(help, 150 * (ins.coveragePercent / 100));
          }
        });

        return Math.floor(help);
      }

      // ==================== GARAÅ» ====================

      function renderGarageModal() {
        const list = document.getElementById("garageList");
        const empty = document.getElementById("garageEmpty");
        const t = translations[currentLang] || translations.en;

        if (garage.length === 0) {
          list.style.display = "none";
          empty.style.display = "block";
          return;
        }

        list.style.display = "block";
        empty.style.display = "none";

        list.innerHTML = garage
          .map((car, idx) => {
            const upgradePercent = car.upgradePercent || 50;
            const sellPrice = Math.floor(car.price * (upgradePercent / 100));
            const isBroken = car.broken;
            const isUpgrading = car.isUpgrading || false;

            return `
                    <div style="padding:15px;margin-bottom:10px;background:${
                      isBroken
                        ? "rgba(239,68,68,0.2)"
                        : isUpgrading
                        ? "rgba(99,102,241,0.2)"
                        : "rgba(0,0,0,0.3)"
                    };border:2px solid ${
              isBroken ? "#ef4444" : isUpgrading ? "#6366f1" : "#333"
            };border-radius:12px;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                            <div>
                                <div style="font-size:1.1em;font-weight:bold;">${
                                  car.brand
                                } ${car.model}</div>
                                <div style="font-size:0.85em;color:#888;">${
                                  car.year || ""
                                }</div>
                            </div>
                            <div style="text-align:right;">
                                <div style="font-size:0.8em;color:#888;">${
                                  t.sellValue || "WartoÅ›Ä‡"
                                }:</div>
                                <div style="color:#4ade80;font-weight:bold;">${sellPrice.toLocaleString()} ${getCurrency()}</div>
                                <div style="font-size:0.75em;color:${
                                  upgradePercent > 100 ? "#4ade80" : "#f59e0b"
                                };">(${upgradePercent.toFixed(1)}%)</div>
                            </div>
                        </div>
                        ${
                          isBroken
                            ? `
                            <div style="background:rgba(239,68,68,0.3);padding:8px;border-radius:8px;text-align:center;margin-bottom:10px;">
                                <span style="color:#ef4444;">ğŸ”§ ${
                                  t.carBroken || "Auto zepsute!"
                                }</span>
                            </div>
                        `
                            : isUpgrading
                            ? `
                            <div style="background:rgba(99,102,241,0.3);padding:8px;border-radius:8px;text-align:center;margin-bottom:10px;">
                                <span style="color:#6366f1;">âš¡ ${
                                  t.upgrading || "Ulepszanie w toku..."
                                }</span>
                            </div>
                        `
                            : ""
                        }
                        <div style="display:flex;gap:8px;">
                            ${
                              isBroken
                                ? `
                                <button onclick="goToRepair()" style="flex:1;padding:10px;background:#ef4444;color:white;border:none;border-radius:8px;cursor:pointer;">
                                    ğŸ”§ ${t.repair || "Napraw"}
                                </button>
                            `
                                : isUpgrading
                                ? `
                                <button onclick="stopCarUpgrade(${idx})" style="flex:1;padding:10px;background:#f59e0b;color:white;border:none;border-radius:8px;cursor:pointer;">
                                    â¸ï¸ ${t.stopUpgrade || "Zatrzymaj"}
                                </button>
                            `
                                : `
                                <button onclick="startCarUpgrade(${idx})" style="flex:1;padding:10px;background:#6366f1;color:white;border:none;border-radius:8px;cursor:pointer;">
                                    â¬†ï¸ ${t.startUpgrade || "Ulepszaj"}
                                </button>
                            `
                            }
                            <button onclick="sellCarFromGarage(${idx})" style="padding:10px 15px;background:#10b981;color:white;border:none;border-radius:8px;cursor:pointer;">
                                ğŸ’° ${t.sell || "Sprzedaj"}
                            </button>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      function goToRepair() {
        closeModal("garage");
        openModal("repair");
      }

      function sellCarFromGarage(idx) {
        const t = translations[currentLang] || translations.en;
        const car = garage[idx];
        if (!car) return;

        if (car.broken) {
          alert(
            t.cantSellBroken ||
              "Nie moÅ¼esz sprzedaÄ‡ zepsutego auta! Najpierw je napraw."
          );
          return;
        }

        // Zatrzymaj ulepszanie przed sprzedaÅ¼Ä…
        if (car.isUpgrading) {
          stopCarUpgrade(idx);
        }

        const upgradePercent = car.upgradePercent || 50;
        const sellPrice = Math.floor(car.price * (upgradePercent / 100));

        if (
          confirm(
            `${t.confirmSell || "SprzedaÄ‡"} ${car.brand} ${car.model} ${
              t.forPrice || "za"
            } ${sellPrice.toLocaleString()} ${getCurrency()}?`
          )
        ) {
          money += sellPrice;
          garage.splice(idx, 1);
          saveState();
          updateAllDisplays();
          renderGarageModal();
          renderGarage();
          alert(
            `âœ… ${
              t.sold || "Sprzedano!"
            } +${sellPrice.toLocaleString()} ${getCurrency()}`
          );
        }
      }

      // === NOWY SYSTEM ULEPSZANIA - jedno klikniÄ™cie, dziaÅ‚a w tle ===
      function startCarUpgrade(idx) {
        const car = garage[idx];
        if (!car || car.broken) return;

        car.isUpgrading = true;

        // Pobierz bonus z ubezpieczenia
        const upgradeBonus = getUpgradeBonus();
        const baseRate = 0.1 + upgradeBonus.rateBonus;
        const breakChance = 0.005 - upgradeBonus.safetyBonus;

        // Uruchom interwaÅ‚ dla tego auta
        upgradeIntervals[idx] = setInterval(() => {
          const currentCar = garage[idx];
          if (!currentCar || currentCar.broken) {
            stopCarUpgrade(idx);
            return;
          }

          // SprawdÅº czy siÄ™ zepsuÅ‚o
          if (Math.random() < Math.max(0.001, breakChance)) {
            carBrokeNew(idx);
            return;
          }

          // Ulepszaj
          currentCar.upgradePercent = Math.min(
            1000,
            (currentCar.upgradePercent || 50) + baseRate
          );
          playSound("upgrade");
          saveState();
        }, 1000);

        saveState();
        renderGarageModal();
      }

      function stopCarUpgrade(idx) {
        const car = garage[idx];
        if (!car) return;

        car.isUpgrading = false;

        if (upgradeIntervals[idx]) {
          clearInterval(upgradeIntervals[idx]);
          delete upgradeIntervals[idx];
        }

        saveState();
        renderGarageModal();
      }

      function carBrokeNew(idx) {
        const t = translations[currentLang] || translations.en;
        const car = garage[idx];
        if (!car) return;

        // Zatrzymaj ulepszanie
        car.isUpgrading = false;
        if (upgradeIntervals[idx]) {
          clearInterval(upgradeIntervals[idx]);
          delete upgradeIntervals[idx];
        }

        // Oznacz jako zepsute
        car.broken = true;
        car.upgradePercent = Math.max(50, (car.upgradePercent || 50) - 5);

        playSound("break");

        // Koszty zepsucia
        const repairDebt = 150;
        if (money >= repairDebt) {
          money -= repairDebt;
          spent += repairDebt;
        } else {
          addDebt(repairDebt - money);
          money = 0;
        }

        saveState();
        updateAllDisplays();
        renderGarageModal();

        alert(
          `ğŸ’¥ ${car.brand} ${car.model} ${
            t.carBrokeMsg || "siÄ™ zepsuÅ‚o!"
          }\n-150 ${getCurrency()}, -5% ${t.value || "wartoÅ›ci"}`
        );
      }

      // WznÃ³w ulepszanie po zaÅ‚adowaniu save'a
      function resumeUpgrades() {
        garage.forEach((car, idx) => {
          if (car.isUpgrading && !car.broken) {
            // Uruchom ponownie interwaÅ‚
            const upgradeBonus = getUpgradeBonus();
            const baseRate = 0.1 + upgradeBonus.rateBonus;
            const breakChance = 0.005 - upgradeBonus.safetyBonus;

            upgradeIntervals[idx] = setInterval(() => {
              const currentCar = garage[idx];
              if (!currentCar || currentCar.broken) {
                stopCarUpgrade(idx);
                return;
              }

              if (Math.random() < Math.max(0.001, breakChance)) {
                carBrokeNew(idx);
                return;
              }

              currentCar.upgradePercent = Math.min(
                1000,
                (currentCar.upgradePercent || 50) + baseRate
              );
              playSound("upgrade");
              saveState();
            }, 1000);
          }
        });
      }

      // Stary system - do usuniÄ™cia lub zostawienia dla kompatybilnoÅ›ci
      let upgradingCarIndex = null;
      let isUpgrading = false;
      let upgradeInterval = null;

      function openUpgradeModal(idx) {
        upgradingCarIndex = idx;
        const car = garage[idx];
        const t = translations[currentLang] || translations.en;

        document.getElementById("upgradeCarInfo").innerHTML = `
                <div style="font-size:2em;">ğŸš—</div>
                <div style="font-size:1.3em;font-weight:bold;">${car.brand} ${
          car.model
        }</div>
                <div style="color:#888;">${car.year || ""} â€¢ ${
          car.type || ""
        }</div>
                <div style="color:#4ade80;margin-top:5px;">${
                  t.basePrice || "Cena bazowa"
                }: ${car.price.toLocaleString()} ${getCurrency()}</div>
            `;

        updateUpgradeDisplay();
        document.getElementById(
          "upgradeStatus"
        ).innerHTML = `<span style="color:#888;">${
          t.clickToStart || "Kliknij aby rozpoczÄ…Ä‡ ulepszanie"
        }</span>`;
        document.getElementById(
          "upgradeBtn"
        ).innerHTML = `â–¶ï¸ <span data-translate="startUpgrade">${
          t.startUpgrade || "Rozpocznij ulepszanie"
        }</span>`;

        closeModal("garage");
        openModal("upgrade");
      }

      function updateUpgradeDisplay() {
        if (upgradingCarIndex === null) return;
        const car = garage[upgradingCarIndex];
        const percent = car.upgradePercent || 50;

        document.getElementById("upgradeSellPercent").textContent =
          percent.toFixed(1) + "%";
        document.getElementById("upgradeProgressBar").style.width =
          ((percent - 50) / 950) * 100 + "%";
      }

      function toggleUpgrade() {
        const t = translations[currentLang] || translations.en;

        if (isUpgrading) {
          stopUpgrade();
        } else {
          startUpgrade();
        }
      }

      function startUpgrade() {
        if (upgradingCarIndex === null) return;
        const t = translations[currentLang] || translations.en;

        isUpgrading = true;
        document.getElementById("upgradeBtn").innerHTML = `â¸ï¸ <span>${
          t.stopUpgrade || "Zatrzymaj"
        }</span>`;
        document.getElementById("upgradeBtn").style.background = "#ef4444";
        document.getElementById(
          "upgradeStatus"
        ).innerHTML = `<span style="color:#4ade80;">âš¡ ${
          t.upgrading || "Ulepszanie w toku..."
        }</span>`;

        // Pobierz bonus z ubezpieczenia
        const upgradeBonus = getUpgradeBonus();
        const baseRate = 0.1 + upgradeBonus.rateBonus;
        const breakChance = 0.005 - upgradeBonus.safetyBonus; // 0.5% co sekundÄ™ bazowo

        upgradeInterval = setInterval(() => {
          const car = garage[upgradingCarIndex];
          if (!car) {
            stopUpgrade();
            return;
          }

          // SprawdÅº czy siÄ™ zepsuÅ‚o
          if (Math.random() < Math.max(0.001, breakChance)) {
            carBroke();
            return;
          }

          // Ulepszaj
          car.upgradePercent = Math.min(
            1000,
            (car.upgradePercent || 50) + baseRate
          );
          playSound("upgrade");
          updateUpgradeDisplay();
          saveState();
        }, 1000);
      }

      function stopUpgrade() {
        const t = translations[currentLang] || translations.en;
        isUpgrading = false;
        if (upgradeInterval) clearInterval(upgradeInterval);
        upgradeInterval = null;

        document.getElementById("upgradeBtn").innerHTML = `â–¶ï¸ <span>${
          t.startUpgrade || "Rozpocznij ulepszanie"
        }</span>`;
        document.getElementById("upgradeBtn").style.background = "#10b981";
        document.getElementById(
          "upgradeStatus"
        ).innerHTML = `<span style="color:#888;">${
          t.upgradeStopped || "Ulepszanie zatrzymane"
        }</span>`;
      }

      function carBroke() {
        const t = translations[currentLang] || translations.en;
        stopUpgrade();
        playSound("break");

        const car = garage[upgradingCarIndex];
        car.broken = true;
        car.upgradePercent = Math.max(50, (car.upgradePercent || 50) - 5);

        const repairDebt = 150;
        if (money >= repairDebt) {
          money -= repairDebt;
          spent += repairDebt;
        } else {
          // Dodaj do dÅ‚ugÃ³w
          const save = getCurrentSave();
          if (!save.data.debts) save.data.debts = [];
          save.data.debts.push({
            type: "carBreak",
            amount: repairDebt,
            description: `${t.carBreakDebt || "Zepsucie auta"}: ${car.brand} ${
              car.model
            }`,
            date: Date.now(),
          });
        }

        saveState();
        updateAllDisplays();
        updateUpgradeDisplay();

        document.getElementById(
          "upgradeStatus"
        ).innerHTML = `<span style="color:#ef4444;">ğŸ’¥ ${
          t.carBrokeMsg || "Auto siÄ™ zepsuÅ‚o! -150 zÅ‚, -5%"
        }</span>`;

        alert(
          `ğŸ’¥ ${
            t.carBrokeMsg || "Auto siÄ™ zepsuÅ‚o!"
          }\n-150 ${getCurrency()}\n-5% wartoÅ›ci`
        );
      }

      function getUpgradeBonus() {
        // SprawdÅº aktywne ubezpieczenia na ulepszanie
        const save = getCurrentSave();
        const activeIns = save.data.activeInsurances || [];

        let rateBonus = 0;
        let safetyBonus = 0;

        activeIns.forEach((ins) => {
          if (ins.type === "upgrade") {
            rateBonus += ins.rateBonus || 0;
            safetyBonus += ins.safetyBonus || 0;
          }
        });

        return { rateBonus, safetyBonus };
      }

      function closeUpgradeModal() {
        stopUpgrade();
        upgradingCarIndex = null;
        closeModal("upgrade");
      }

      // ==================== PRACA ====================
      const jobs = [
        {
          id: "cleaner",
          name: "SprzÄ…tacz",
          nameEn: "Cleaner",
          basePay: 500,
          difficulty: 1,
        },
        {
          id: "cashier",
          name: "Kasjer",
          nameEn: "Cashier",
          basePay: 600,
          difficulty: 1,
        },
        {
          id: "waiter",
          name: "Kelner",
          nameEn: "Waiter",
          basePay: 700,
          difficulty: 1,
        },
        {
          id: "cook",
          name: "Kucharz",
          nameEn: "Cook",
          basePay: 900,
          difficulty: 2,
        },
        {
          id: "driver",
          name: "Kierowca",
          nameEn: "Driver",
          basePay: 1100,
          difficulty: 2,
        },
        {
          id: "mechanic",
          name: "Mechanik",
          nameEn: "Mechanic",
          basePay: 1300,
          difficulty: 2,
        },
        {
          id: "electrician",
          name: "Elektryk",
          nameEn: "Electrician",
          basePay: 1500,
          difficulty: 3,
        },
        {
          id: "programmer",
          name: "Programista",
          nameEn: "Programmer",
          basePay: 2200,
          difficulty: 3,
        },
        {
          id: "lawyer",
          name: "Prawnik",
          nameEn: "Lawyer",
          basePay: 2800,
          difficulty: 4,
        },
        {
          id: "doctor",
          name: "Lekarz",
          nameEn: "Doctor",
          basePay: 3200,
          difficulty: 4,
        },
        {
          id: "surgeon",
          name: "Chirurg",
          nameEn: "Surgeon",
          basePay: 4500,
          difficulty: 5,
        },
        {
          id: "pilot",
          name: "Pilot",
          nameEn: "Pilot",
          basePay: 5500,
          difficulty: 5,
        },
        {
          id: "ceo",
          name: "Dyrektor",
          nameEn: "CEO",
          basePay: 7000,
          difficulty: 5,
        },
      ];

      let workInterval = null;
      let sleepInterval = null;
      let coinInterval = null;
      let workTimeLeft = 120;
      let workEarned = 0;
      let workBonus = 0;
      let sleepLevel = 0;
      let currentJob = null;

      function renderJobsList() {
        const list = document.getElementById("jobsList");
        const t = translations[currentLang] || translations.en;

        list.innerHTML = jobs
          .map((job) => {
            const difficultyStars = "â­".repeat(job.difficulty);
            const jobName = currentLang === "pl" ? job.name : job.nameEn;

            return `
                    <div onclick="startWork('${
                      job.id
                    }')" style="padding:15px;margin-bottom:10px;background:rgba(0,0,0,0.3);border:2px solid #333;border-radius:12px;cursor:pointer;transition:all 0.2s;" onmouseover="this.style.borderColor='#6366f1'" onmouseout="this.style.borderColor='#333'">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div>
                                <div style="font-size:1.1em;font-weight:bold;">${jobName}</div>
                                <div style="font-size:0.85em;color:#888;">${difficultyStars}</div>
                            </div>
                            <div style="text-align:right;">
                                <div style="color:#4ade80;font-weight:bold;">${job.basePay.toLocaleString()} ${getCurrency()}</div>
                                <div style="font-size:0.75em;color:#888;">+ ${
                                  t.bonuses || "bonusy"
                                }</div>
                            </div>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      function startWork(jobId) {
        currentJob = jobs.find((j) => j.id === jobId);
        if (!currentJob) return;

        const t = translations[currentLang] || translations.en;
        workTimeLeft = 120;
        workEarned = 0;
        workBonus = 0;
        sleepLevel = 0;

        document.getElementById("workJobName").textContent =
          currentLang === "pl" ? currentJob.name : currentJob.nameEn;
        document.getElementById("workTimer").textContent = "2:00";
        document.getElementById("workEarned").textContent = "0";
        document.getElementById("workBonus").textContent = "0";
        document.getElementById("sleepOverlayTop").style.height = "0";
        document.getElementById("sleepOverlayBottom").style.height = "0";
        document.getElementById("coinsContainer").innerHTML = "";

        closeModal("work");
        openModal("workGame");
        playSound("workStart");

        // Timer
        workInterval = setInterval(() => {
          workTimeLeft--;
          const mins = Math.floor(workTimeLeft / 60);
          const secs = workTimeLeft % 60;
          document.getElementById("workTimer").textContent = `${mins}:${secs
            .toString()
            .padStart(2, "0")}`;

          if (workTimeLeft <= 0) {
            endWork();
          }
        }, 1000);

        // Zasypianie - im trudniejsza praca tym WOLNIEJ zasypiasz (bo jesteÅ› skupiony)
        // Ale Å‚atwiejsze prace = szybciej zasypiasz z nudÃ³w
        const sleepRate = 1.5 - currentJob.difficulty * 0.2; // 1â­ = 1.3, 5â­ = 0.5 - szybsze zasypianie
        sleepInterval = setInterval(() => {
          sleepLevel = Math.min(48, sleepLevel + sleepRate); // max 48% - prawie nic nie widaÄ‡
          updateSleepVisuals();
        }, 300); // szybsze tickowanie

        // SpadajÄ…ce monety - trudniejsza praca = wiÄ™cej monet (bo wiÄ™cej okazji)
        const coinRate = 800 + currentJob.difficulty * 200; // 1â­ = 1000ms, 5â­ = 1800ms miÄ™dzy monetami
        coinInterval = setInterval(() => {
          spawnCoin();
        }, coinRate);
      }

      function spawnCoin() {
        const container = document.getElementById("coinsContainer");
        const coin = document.createElement("div");
        coin.className = "falling-coin";
        coin.innerHTML = "ğŸ’°";
        coin.style.cssText = `
                position: absolute;
                top: -60px;
                left: ${Math.random() * 80 + 10}%;
                font-size: 4em;
                cursor: pointer;
                z-index: 5;
                transition: top 3s linear;
            `;

        coin.onclick = () => {
          playSound("coin");
          workBonus += 100;
          document.getElementById("workBonus").textContent =
            workBonus.toLocaleString();
          coin.innerHTML = "+100";
          coin.style.color = "#4ade80";
          coin.style.fontSize = "2em";
          setTimeout(() => coin.remove(), 300);
        };

        container.appendChild(coin);

        setTimeout(() => {
          coin.style.top = "calc(100% + 60px)";
        }, 50);

        setTimeout(() => {
          if (coin.parentNode) coin.remove();
        }, 3500);
      }

      function updateSleepVisuals() {
        document.getElementById("sleepOverlayTop").style.height =
          sleepLevel + "%";
        document.getElementById("sleepOverlayBottom").style.height =
          sleepLevel + "%";

        // Monety prawie niewidoczne przy max Å›nie
        const coinsOpacity = 1 - (sleepLevel / 48) * 0.95; // od 1 do 0.05
        document.getElementById("coinsContainer").style.opacity = coinsOpacity;
      }

      // PÅ‚ynne otwieranie oczu - im wiÄ™cej Å›pisz tym wolniej siÄ™ otwierajÄ…
      let wakeUpInterval = null;

      function startWakeUp() {
        if (wakeUpInterval) return;
        wakeUpInterval = setInterval(() => {
          // Im wiÄ™cej Å›pisz, tym wolniej otwierasz oczy (mniejszy krok)
          const openSpeed = Math.max(0.5, 3 - (sleepLevel / 48) * 2.5); // od 3 do 0.5
          sleepLevel = Math.max(0, sleepLevel - openSpeed);
          updateSleepVisuals();
        }, 50); // pÅ‚ynna animacja
      }

      function stopWakeUp() {
        if (wakeUpInterval) {
          clearInterval(wakeUpInterval);
          wakeUpInterval = null;
        }
      }

      function wakeUp() {
        // Pojedyncze klikniÄ™cie - maÅ‚e otwarcie
        const openSpeed = Math.max(0.5, 3 - (sleepLevel / 48) * 2.5);
        sleepLevel = Math.max(0, sleepLevel - openSpeed * 2);
        updateSleepVisuals();
      }

      function endWork() {
        clearInterval(workInterval);
        clearInterval(sleepInterval);
        clearInterval(coinInterval);
        stopWakeUp(); // Zatrzymaj otwieranie oczu

        const t = translations[currentLang] || translations.en;
        const basePay = currentJob.basePay;

        // Bonus za klikanie monet
        const totalEarned = basePay + workBonus;

        // Im wiÄ™cej Å›pisz (sleepLevel 0-45), tym wiÄ™cej TRACISZ (0-90%)
        const sleepPenalty = (sleepLevel / 45) * 0.9;
        const moneyLost = Math.floor(totalEarned * sleepPenalty);
        const finalPay = totalEarned - moneyLost;

        money += finalPay;
        saveState();
        updateAllDisplays();

        closeModal("workGame");
        playSound("workEnd");

        const penaltyPercent = Math.floor(sleepPenalty * 100);
        let msg = `ğŸ’¼ ${t.workDone || "Praca zakoÅ„czona!"}\n\n`;
        msg += `${
          t.basePay || "Podstawa"
        }: ${basePay.toLocaleString()} ${getCurrency()}\n`;
        msg += `ğŸ’° ${
          t.coinsCollected || "Zebrane monety"
        }: +${workBonus.toLocaleString()} ${getCurrency()}\n`;
        if (moneyLost > 0) {
          msg += `ğŸ˜´ ${
            t.sleepPenalty || "Strata za spanie"
          }: -${moneyLost.toLocaleString()} ${getCurrency()} (${penaltyPercent}%)\n`;
        }
        msg += `\n${
          t.total || "Razem"
        }: ${finalPay.toLocaleString()} ${getCurrency()}`;

        alert(msg);
        currentJob = null;
      }

      // ==================== INIT ====================
      function init() {
        ensureDefaultSave();
        loadSaveData();
        generateLangGrid();
        applyLanguage();
        updateGameModeUI();
        updateAllDisplays();
        updateCurrentSaveDisplay();
        checkMissedTaxes();
        checkMissedHunger();
        checkInsuranceBenefits();
        startTaxTimer();
        startHungerTimer();
        startInsuranceTimer();
        checkUrlForVoucher(); // SprawdÅº czy ktoÅ› wysÅ‚aÅ‚ bon przez link
      }

      function saveState() {
        saveSaveData();
        localStorage.setItem("beamng_lang", currentLang);
      }

      function generateCardCode() {
        let code = "";
        for (let i = 0; i < 6; i++) code += Math.floor(Math.random() * 10);
        return code;
      }

      // ==================== OBSÅUGA FORMULARZY ====================
      let currentImageDataForVerify = null;
      let carSearchQuery = "";

      // Renderuj listÄ™ aut do kupienia
      function renderCarBuyList() {
        const grid = document.getElementById("carBuyGrid");
        const query = carSearchQuery.toLowerCase();
        const cars = getCurrentCars();

        const filtered = cars.filter(
          (car) =>
            car.brand.toLowerCase().includes(query) ||
            car.model.toLowerCase().includes(query) ||
            car.type.toLowerCase().includes(query)
        );

        if (filtered.length === 0) {
          grid.innerHTML =
            '<div style="text-align:center;padding:20px;color:#888;grid-column:span 2;">Nie znaleziono aut</div>';
          return;
        }

        grid.innerHTML = filtered
          .map(
            (car) => `
                <div class="shop-item" onclick="buyCar('${
                  car.id
                }')" style="padding:10px;">
                    <div class="item-icon">ğŸš—</div>
                    <div class="item-name" style="font-size:0.8em;">${
                      car.brand
                    } ${car.model}</div>
                    <div class="item-stats">
                        <span style="color:#888;">${car.year}</span><br>
                        <span style="color:#aaa;font-size:0.9em;">${
                          car.type
                        }</span>
                    </div>
                    <div class="item-price">${car.price.toLocaleString()} ${getCurrency()}</div>
                </div>
            `
          )
          .join("");
      }

      function filterCars() {
        carSearchQuery = document.getElementById("carSearchInput").value;
        renderCarBuyList();
      }

      function buyCar(carId) {
        const cars = getCurrentCars();
        const car = cars.find((c) => c.id === carId);
        if (!car) return;

        const t = translations[currentLang] || translations.en;

        if (money < car.price) {
          alert(t.notEnoughMoney || "Nie masz wystarczajÄ…co pieniÄ™dzy!");
          return;
        }

        if (
          confirm(
            `${t.buyQuestion || "KupiÄ‡"} ${car.brand} ${car.model} ${
              t.forPrice || "za"
            } ${car.price.toLocaleString()} ${getCurrency()}?`
          )
        ) {
          // Dodaj do garaÅ¼u
          garage.push({
            id: car.id,
            brand: car.brand,
            model: car.model,
            name: `${car.brand} ${car.model}`,
            price: car.price,
            type: car.type,
            year: car.year,
            upgradePercent: 50,
          });

          money -= car.price;
          spent += car.price;
          saveState();
          updateAllDisplays();
          playSound("buy");
          const t = translations[currentLang] || translations.en;
          alert(`ğŸš™ ${t.carBought || "Kupiono"} ${car.brand} ${car.model}!`);
          closeModal("buy");
        }
      }

      // SPRZEDAÅ» - garaÅ¼
      function renderGarage() {
        const list = document.getElementById("sellGarageList");
        const empty = document.getElementById("sellEmptyGarage");
        const section = document.getElementById("sellGarageSection");

        if (garage.length === 0) {
          section.style.display = "none";
          empty.style.display = "block";
          return;
        }

        empty.style.display = "none";
        section.style.display = "block";

        list.innerHTML = garage
          .map((car, i) => {
            const upgradePercent = car.upgradePercent || 50;
            const sellPrice = Math.floor(car.price * (upgradePercent / 100));
            return `
                <div class="garage-item" onclick="sellCar(${i})" ${
              car.broken ? 'style="opacity:0.5;pointer-events:none;"' : ""
            }>
                    <div>
                        <div class="car-name">ğŸš— ${
                          car.name || car.brand + " " + car.model
                        }</div>
                        <div class="car-price">${car.year || ""}</div>
                    </div>
                    <div style="text-align:right;">
                        ${
                          car.broken
                            ? '<div style="color:#ef4444;">ğŸ”§ Zepsute</div>'
                            : `
                            <div style="color:#4ade80;font-weight:bold;">+${sellPrice.toLocaleString()} ${getCurrency()}</div>
                            <div style="color:#888;font-size:0.8em;">${upgradePercent.toFixed(
                              1
                            )}%</div>
                        `
                        }
                    </div>
                </div>
            `;
          })
          .join("");
      }

      function sellCar(index) {
        if (index < 0 || index >= garage.length) return;

        const car = garage[index];
        const t = translations[currentLang] || translations.en;

        if (car.broken) {
          alert(t.cantSellBroken || "Nie moÅ¼na sprzedaÄ‡ zepsutego auta!");
          return;
        }

        const upgradePercent = car.upgradePercent || 50;
        const sellPrice = Math.floor(car.price * (upgradePercent / 100));

        const carName = car.name || car.brand + " " + car.model;
        if (
          confirm(
            `${t.confirmSell || "SprzedaÄ‡"} ${carName} ${
              t.forPrice || "za"
            } ${sellPrice.toLocaleString()} ${getCurrency()}?`
          )
        ) {
          money += sellPrice;
          garage.splice(index, 1);
          saveState();
          updateAllDisplays();
          renderGarage();
          playSound("sell");
          alert(
            `ğŸ’¸ Sprzedano za ${sellPrice.toLocaleString()} ${getCurrency()}!`
          );

          if (garage.length === 0) {
            closeModal("sell");
          }
        }
      }

      // Inicjalizacja inputÃ³w - zarobek km
      function initEarnInputs() {
        const kmInput = document.getElementById("kmInput");
        const btn = document.getElementById("earnBtn");

        if (kmInput) kmInput.value = "";
        if (btn) btn.classList.remove("active");

        const calcSpan = document.getElementById("kmCalc");
        if (calcSpan) calcSpan.textContent = "0";
      }

      // Event listener dla km
      document.addEventListener("input", function (e) {
        if (e.target.id === "kmInput") {
          const km = parseFloat(e.target.value) || 0;
          document.getElementById("kmCalc").textContent = (
            km * 100
          ).toLocaleString();
          currentEarnAmount = Math.floor(km * 100);
          document.getElementById("earnBtn").classList.toggle("active", km > 0);
        }
      });

      function showSuccess(type, text, amount, amountClass) {
        const response = document.getElementById(type + "Response");
        const icon = type === "earn" ? "ğŸ›£ï¸" : type === "buy" ? "ğŸš™" : "ğŸ’¸";

        response.innerHTML = `
                <div class="result-icon">${icon}</div>
                <div class="result-text">${text}</div>
                <div class="result-amount ${amountClass}">${amount}</div>
            `;
        document.getElementById(type + "Btn").classList.add("active");
      }

      function showError(type) {
        const response = document.getElementById(type + "Response");
        response.innerHTML = `
                <div class="result-icon">âŒ</div>
                <div class="result-text" style="color: #f87171;">${
                  translations[currentLang].invalidScreenshot ||
                  "Nie rozpoznano danych!"
                }</div>
            `;
        document.getElementById(type + "Btn").classList.remove("active");
      }

      // ==================== SYSTEM WERYFIKACJI QR ====================
      let peer = null;
      let currentVerifyType = null;
      let currentImageData = null;
      let verifyResolve = null;

      // SprawdÅº czy to strona weryfikatora
      function checkIfVerifier() {
        const params = new URLSearchParams(window.location.search);
        const peerId = params.get("verify");
        const type = params.get("type");
        const img = params.get("img");

        if (peerId && type) {
          showVerifierPage(peerId, type, img);
          return true;
        }
        return false;
      }

      function showVerifierPage(peerId, type, imgData) {
        document.body.innerHTML = `
                <div class="verify-page">
                    <h2>ğŸ” Weryfikacja transakcji</h2>
                    <p id="verifyQuestion">${getVerifyQuestion(type)}</p>
                    <img id="verifyImage" src="${imgData || ""}" style="${
          imgData ? "" : "display:none"
        }">
                    <div id="verifyStatus">
                        <div class="loader" style="width:40px;height:40px;border:3px solid #333;border-top-color:#ff6b35;border-radius:50%;animation:spin 1s linear infinite;margin:20px auto;"></div>
                        <p>ÅÄ…czenie z graczem...</p>
                    </div>
                    <div class="verify-buttons" id="verifyButtons" style="display:none;">
                        <button class="verify-btn yes" onclick="sendVerifyResponse(true)">âœ… TAK</button>
                        <button class="verify-btn no" onclick="sendVerifyResponse(false)">âŒ NIE</button>
                    </div>
                    <div id="verifyResult" style="display:none;"></div>
                </div>
            `;

        // PoÅ‚Ä…cz z graczem
        connectToPlayer(peerId);
      }

      function getVerifyQuestion(type) {
        const questions = {
          repair: "Czy na tym obrazku widaÄ‡ uszkodzone auto?",
          sell: "Czy na tym obrazku widaÄ‡ auto?",
          sellDamage: "Czy auto na obrazku jest ZNISZCZONE?",
        };
        return questions[type] || "Czy obrazek jest prawidÅ‚owy?";
      }

      let verifierConn = null;

      function connectToPlayer(peerId) {
        const verifierPeer = new Peer();

        verifierPeer.on("open", () => {
          verifierConn = verifierPeer.connect(peerId);

          verifierConn.on("open", () => {
            document.getElementById("verifyStatus").innerHTML =
              '<p style="color:#4ade80;">âœ… PoÅ‚Ä…czono!</p>';
            document.getElementById("verifyButtons").style.display = "flex";
          });

          verifierConn.on("data", (data) => {
            if (data.type === "image") {
              document.getElementById("verifyImage").src = data.image;
              document.getElementById("verifyImage").style.display = "block";
            }
          });

          verifierConn.on("error", (err) => {
            document.getElementById("verifyStatus").innerHTML =
              '<p style="color:#ef4444;">âŒ BÅ‚Ä…d poÅ‚Ä…czenia</p>';
          });
        });

        verifierPeer.on("error", (err) => {
          document.getElementById("verifyStatus").innerHTML =
            '<p style="color:#ef4444;">âŒ Nie moÅ¼na poÅ‚Ä…czyÄ‡</p>';
        });
      }

      function sendVerifyResponse(approved) {
        if (verifierConn) {
          verifierConn.send({ type: "response", approved: approved });

          document.getElementById("verifyButtons").style.display = "none";
          document.getElementById("verifyResult").style.display = "block";
          document.getElementById("verifyResult").innerHTML = approved
            ? '<div class="verify-result">âœ…</div><p style="color:#4ade80;font-size:1.5em;">Transakcja potwierdzona!</p>'
            : '<div class="verify-result">âŒ</div><p style="color:#ef4444;font-size:1.5em;">Transakcja odrzucona!</p>';
        }
      }

      // Funkcja do generowania QR i czekania na weryfikacjÄ™
      function startVerification(type, imageData) {
        return new Promise((resolve) => {
          verifyResolve = resolve;
          currentVerifyType = type;
          currentImageData = imageData;

          // StwÃ³rz peer dla gracza
          if (peer) {
            peer.destroy();
          }

          peer = new Peer();

          peer.on("open", (id) => {
            // Generuj URL dla weryfikatora
            const baseUrl = window.location.href.split("?")[0];
            const verifyUrl = `${baseUrl}?verify=${id}&type=${type}`;

            // PokaÅ¼ QR
            showQRCode(type, verifyUrl, imageData);
          });

          peer.on("connection", (conn) => {
            conn.on("open", () => {
              // WyÅ›lij obrazek do weryfikatora
              conn.send({ type: "image", image: imageData });
              updateQRStatus("connected");
            });

            conn.on("data", (data) => {
              if (data.type === "response") {
                if (data.approved) {
                  updateQRStatus("approved");
                  resolve(true);
                } else {
                  updateQRStatus("rejected");
                  resolve(false);
                }
              }
            });
          });

          peer.on("error", (err) => {
            console.error("Peer error:", err);
            updateQRStatus("error");
            resolve(false);
          });
        });
      }

      function showQRCode(type, url, imageData) {
        const response = document.getElementById(type + "Response");

        response.innerHTML = `
                <div class="qr-section">
                    <h4>ğŸ“± PoproÅ› kogoÅ› o weryfikacjÄ™</h4>
                    <p>Niech zeskanuje kod QR telefonem</p>
                    <div class="qr-container" id="qr-${type}"></div>
                    <div class="qr-status waiting" id="qrStatus-${type}">
                        â³ Oczekiwanie na weryfikatora...
                    </div>
                </div>
            `;

        // Generuj QR kod
        new QRCode(document.getElementById(`qr-${type}`), {
          text: url,
          width: 180,
          height: 180,
          colorDark: "#1a1a2e",
          colorLight: "#ffffff",
        });
      }

      function updateQRStatus(status) {
        const statusEl = document.querySelector('[id^="qrStatus-"]');
        if (!statusEl) return;

        const type = currentVerifyType;
        const btn = document.getElementById(type + "Btn");

        switch (status) {
          case "connected":
            statusEl.className = "qr-status waiting";
            statusEl.innerHTML =
              "ğŸ”— Weryfikator poÅ‚Ä…czony, czekam na odpowiedÅº...";
            break;
          case "approved":
            statusEl.className = "qr-status success";
            statusEl.innerHTML = "âœ… Transakcja potwierdzona!";
            if (btn) btn.classList.add("active");

            // PokaÅ¼ teÅ¼ koszt/cenÄ™
            setTimeout(() => {
              showVerifiedResult(type);
            }, 1000);
            break;
          case "rejected":
            statusEl.className = "qr-status rejected";
            statusEl.innerHTML = "âŒ Transakcja odrzucona!";
            if (btn) btn.classList.remove("active");
            break;
          case "error":
            statusEl.className = "qr-status rejected";
            statusEl.innerHTML = "âŒ BÅ‚Ä…d poÅ‚Ä…czenia";
            break;
        }
      }

      function showVerifiedResult(type) {
        const response = document.getElementById(type + "Response");

        if (type === "repair") {
          response.innerHTML = `
                    <div class="result-icon">ğŸ”§âœ…</div>
                    <div class="result-text">${
                      translations[currentLang].repairCostInfo ||
                      "Koszt naprawy:"
                    }</div>
                    <div class="result-amount cost">-5,000 ${getCurrency()}</div>
                    <div style="color:#4ade80;margin-top:10px;font-size:0.9em;">Zweryfikowano!</div>
                `;
        } else if (type === "buy") {
          response.innerHTML = `
                    <div class="result-icon">ğŸš™âœ…</div>
                    <div class="result-text">${
                      translations[currentLang].foundPrice || "Cena auta:"
                    } ${currentBuyPrice.toLocaleString()} ${getCurrency()}</div>
                    <div class="result-amount cost">-${currentBuyPrice.toLocaleString()} ${getCurrency()}</div>
                    <div style="color:#4ade80;margin-top:10px;font-size:0.9em;">Zweryfikowano!</div>
                `;
        } else if (type === "sell") {
          response.innerHTML = `
                    <div class="result-icon">ğŸ’¸âœ…</div>
                    <div class="result-text">${
                      translations[currentLang].foundPrice || "Cena auta:"
                    } (50%)</div>
                    <div class="result-amount earn">+${currentSellPrice.toLocaleString()} ${getCurrency()}</div>
                    <div style="color:#4ade80;margin-top:10px;font-size:0.9em;">Zweryfikowano!</div>
                `;
        }
      }

      // Zmodyfikowana funkcja naprawy z QR
      async function analyzeRepairImage(input) {
        if (!input.files || !input.files[0]) return;

        const file = input.files[0];
        const preview = document.getElementById("repairPreview");
        const response = document.getElementById("repairResponse");
        const btn = document.getElementById("repairBtn");

        const reader = new FileReader();
        reader.onload = async function (e) {
          const imageData = e.target.result;
          preview.src = imageData;
          preview.style.display = "block";
          document.getElementById("repairUpload").style.display = "none";

          response.classList.add("active");

          // Uruchom weryfikacjÄ™ QR
          const approved = await startVerification("repair", imageData);

          if (!approved) {
            btn.classList.remove("active");
          }
        };
        reader.readAsDataURL(file);
      }

      function confirmCarVisible(type) {
        const response = document.getElementById(type + "Response");
        const btn = document.getElementById(type + "Btn");

        if (type === "repair") {
          response.innerHTML = `
                    <div class="result-icon">ğŸ”§</div>
                    <div class="result-text">${
                      translations[currentLang].repairCostInfo ||
                      "Koszt naprawy:"
                    }</div>
                    <div class="result-amount cost">-5,000 ${getCurrency()}</div>
                `;
          btn.classList.add("active");
        }
      }

      function denyCarVisible(type) {
        const response = document.getElementById(type + "Response");
        response.innerHTML = `
                <div class="result-icon">âŒ</div>
                <div class="result-text" style="color: #f87171;">${
                  translations[currentLang].noCarOnScreen ||
                  "WyÅ›lij screenshot z widocznym autem!"
                }</div>
            `;
        // Reset uploadu
        setTimeout(() => {
          resetUploadForm(type);
        }, 2000);
      }

      // ==================== AKCJE ====================
      function confirmEarn() {
        money += currentEarnAmount;
        saveState();
        updateAllDisplays();
        alert(`ğŸ’° +${currentEarnAmount.toLocaleString()} ${getCurrency()}!`);
        closeModal("earn");
      }

      function confirmRepair() {
        if (REPAIR_COST > money) {
          alert(
            translations[currentLang].notEnoughMoney ||
              "Nie masz wystarczajÄ…co pieniÄ™dzy!"
          );
          return;
        }

        if (spent + REPAIR_COST > limit) {
          pendingAction = "repair";
          closeModal("repair");
          openModal("limitExceeded");
          return;
        }

        money -= REPAIR_COST;
        spent += REPAIR_COST;
        saveState();
        updateAllDisplays();
        alert(`ğŸ”§ -5,000 ${getCurrency()}`);
        closeModal("repair");
      }

      // ==================== PODATKI ====================
      function checkMissedTaxes() {
        const now = Date.now();
        const elapsed = now - lastTaxTime;
        const missedTaxes = Math.floor(elapsed / (5 * 60 * 1000)); // Co 5 minut

        if (missedTaxes > 0) {
          const totalTax = missedTaxes * 500; // 500 zÅ‚ za kaÅ¼de 5 min

          if (autoPay) {
            if (money >= totalTax) {
              money -= totalTax;
              totalTaxPaid += totalTax;
            } else {
              const paid = money;
              money = 0;
              totalTaxPaid += paid;
              addDebt(totalTax - paid);
            }
          } else {
            addDebt(totalTax);
          }

          lastTaxTime = now;
          saveState();
        }
      }

      function startTaxTimer() {
        setInterval(updateNextTaxDisplay, 1000);
        setInterval(collectTax, 5 * 60 * 1000); // Co 5 minut
      }

      function collectTax() {
        if (autoPay) {
          if (money >= 500) {
            money -= 500;
            totalTaxPaid += 500;
          } else {
            totalTaxPaid += money;
            addDebt(500 - money);
            money = 0;
          }
        } else {
          addDebt(500);
        }

        lastTaxTime = Date.now();
        saveState();
        updateAllDisplays();
      }

      function addDebt(amount) {
        debt += amount;
        if (!debtDeadline) {
          const deadline = new Date();
          deadline.setDate(deadline.getDate() + 7);
          debtDeadline = deadline.toISOString();
        }
        saveState();
      }

      function updateNextTaxDisplay() {
        const elapsed = Date.now() - lastTaxTime;
        const remaining = 5 * 60 * 1000 - elapsed; // 5 minut

        if (remaining > 0) {
          const minutes = Math.floor(remaining / 60000);
          const seconds = Math.floor((remaining % 60000) / 1000);
          document.getElementById("nextTaxTime").textContent = `${minutes
            .toString()
            .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
        }
      }

      function toggleAutoPay() {
        autoPay = !autoPay;
        document
          .getElementById("autoPayToggle")
          .classList.toggle("active", autoPay);
        saveState();
      }

      function payDebt() {
        if (money >= debt) {
          money -= debt;
          debt = 0;
          debtDeadline = null;
          saveState();
          updateAllDisplays();
          alert("âœ… DÅ‚ug spÅ‚acony!");
        } else {
          alert(
            translations[currentLang].notEnoughMoney ||
              "Nie masz wystarczajÄ…co pieniÄ™dzy!"
          );
        }
      }

      // ==================== GÅÃ“D I PRAGNIENIE ====================
      function checkMissedHunger() {
        const now = Date.now();
        const elapsed = now - lastHungerTime;
        const missedIntervals = Math.floor(elapsed / HUNGER_INTERVAL);

        if (missedIntervals > 0) {
          // Zmniejsz jedzenie i picie
          food = Math.max(0, food - FOOD_DECAY * missedIntervals);
          water = Math.max(0, water - WATER_DECAY * missedIntervals);

          // JeÅ›li gÅ‚odny/spragniony - traÄ‡ zdrowie
          if (food <= 0 || water <= 0) {
            const healthLoss = missedIntervals * 5;
            health = Math.max(0, health - healthLoss);
          }

          lastHungerTime = now;
          saveState();
        }
      }

      function startHungerTimer() {
        // Sprawdzaj co sekundÄ™ dla aktualizacji wyÅ›wietlania
        setInterval(updateHungerDisplay, 1000);
        // ZuÅ¼ywaj gÅ‚Ã³d/pragnienie co 5 minut
        setInterval(consumeHunger, HUNGER_INTERVAL);
      }

      function consumeHunger() {
        food = Math.max(0, food - FOOD_DECAY);
        water = Math.max(0, water - WATER_DECAY);

        // JeÅ›li gÅ‚odny/spragniony - traÄ‡ zdrowie
        if (food <= 0 || water <= 0) {
          health = Math.max(0, health - 5);
        }

        lastHungerTime = Date.now();
        saveState();
        updateAllDisplays();

        // SprawdÅº Å›mierÄ‡
        checkDeath();

        // OstrzeÅ¼enie gdy niski poziom
        if (food <= 100 && food > 0) {
          console.log("âš ï¸ GÅ‚odujesz!");
        }
        if (water <= 100 && water > 0) {
          console.log("âš ï¸ Chcesz piÄ‡!");
        }
        if (health <= 20 && health > 0) {
          console.log("âš ï¸ Niskie zdrowie!");
        }
      }

      function checkDeath() {
        if (health <= 0) {
          playerDied();
        }
      }

      function playerDied() {
        const t = translations[currentLang] || translations.en;
        const save = getCurrentSave();

        // Zatrzymaj wszystkie ulepszania
        Object.keys(upgradeIntervals).forEach((idx) => {
          clearInterval(upgradeIntervals[idx]);
        });
        upgradeIntervals = {};

        // SprawdÅº czy jest checkpoint
        const modeKey =
          gameMode === "reallife" ? "realLifeCheckpoint" : "beamngCheckpoint";
        const checkpoint = save[modeKey];

        if (checkpoint) {
          // PrzywrÃ³Ä‡ z checkpointu
          alert(
            `ğŸ’€ ${t.youDied || "ZginÄ…Å‚eÅ›!"}\n\n${
              t.loadingCheckpoint || "Wczytywanie ostatniego checkpointu..."
            }`
          );
          loadCheckpoint();
        } else {
          // Brak checkpointu - reset do poczÄ…tku
          alert(
            `ğŸ’€ ${t.youDied || "ZginÄ…Å‚eÅ›!"}\n\n${
              t.noCheckpoint || "Brak checkpointu - zaczynasz od nowa!"
            }`
          );
          resetModeProgress();
        }

        updateAllDisplays();
        renderGarageModal();
      }

      function createCheckpoint() {
        const t = translations[currentLang] || translations.en;
        const save = getCurrentSave();
        if (!save) return;

        const modeKey =
          gameMode === "reallife" ? "realLifeCheckpoint" : "beamngCheckpoint";

        // Zapisz aktualny stan jako checkpoint
        save[modeKey] = {
          money: money,
          garage: JSON.parse(JSON.stringify(garage)),
          spent: spent,
          debt: debt,
          debtDeadline: debtDeadline,
          totalTaxPaid: totalTaxPaid,
          health: health,
          food: food,
          water: water,
          backpack: JSON.parse(JSON.stringify(backpack)),
          activeInsurances: JSON.parse(JSON.stringify(activeInsurances)),
          createdAt: Date.now(),
        };

        localStorage.setItem("beamng_saves", JSON.stringify(saves));

        alert(
          `âœ… ${t.checkpointCreated || "Checkpoint utworzony!"}\n\n${
            t.checkpointInfo || "JeÅ›li zginiesz, wrÃ³cisz do tego momentu."
          }`
        );
        renderSavesList();
      }

      function loadCheckpoint() {
        const save = getCurrentSave();
        if (!save) return;

        const modeKey =
          gameMode === "reallife" ? "realLifeCheckpoint" : "beamngCheckpoint";
        const checkpoint = save[modeKey];

        if (!checkpoint) return;

        money = checkpoint.money;
        garage = JSON.parse(JSON.stringify(checkpoint.garage));
        spent = checkpoint.spent;
        debt = checkpoint.debt;
        debtDeadline = checkpoint.debtDeadline;
        totalTaxPaid = checkpoint.totalTaxPaid;
        health = checkpoint.health;
        food = checkpoint.food;
        water = checkpoint.water;
        backpack = JSON.parse(JSON.stringify(checkpoint.backpack));
        activeInsurances = JSON.parse(
          JSON.stringify(checkpoint.activeInsurances)
        );

        // WznÃ³w ulepszania
        resumeUpgrades();
        saveState();
      }

      function resetModeProgress() {
        money = 1500;
        garage = [];
        spent = 0;
        debt = 0;
        debtDeadline = null;
        totalTaxPaid = 0;
        health = 100;
        food = 1000;
        water = 1000;
        backpack = [];
        activeInsurances = [];

        saveState();
      }

      function deleteCheckpoint() {
        const t = translations[currentLang] || translations.en;
        const save = getCurrentSave();
        if (!save) return;

        const modeKey =
          gameMode === "reallife" ? "realLifeCheckpoint" : "beamngCheckpoint";

        if (!save[modeKey]) {
          alert(t.noCheckpointToDelete || "Nie masz checkpointu do usuniÄ™cia!");
          return;
        }

        if (
          confirm(
            t.confirmDeleteCheckpoint ||
              "UsunÄ…Ä‡ checkpoint? JeÅ›li zginiesz, stracisz caÅ‚y postÄ™p!"
          )
        ) {
          delete save[modeKey];
          localStorage.setItem("beamng_saves", JSON.stringify(saves));
          alert(t.checkpointDeleted || "Checkpoint usuniÄ™ty!");
          renderSavesList();
        }
      }

      function updateHungerDisplay() {
        // MoÅ¼na tu dodaÄ‡ timer do nastÄ™pnego zuÅ¼ycia
      }

      // ==================== UBEZPIECZENIA ====================
      let selectedInsurancePackage = null;

      function renderInsuranceList() {
        const list = document.getElementById("insuranceList");
        const activeSection = document.getElementById(
          "activeInsurancesSection"
        );
        const activeList = document.getElementById("activeInsurancesList");
        const activeCount = document.getElementById("activeCount");

        const t = translations[currentLang] || translations.en;

        // PokaÅ¼ aktywne ubezpieczenia
        if (activeInsurances.length > 0) {
          activeSection.style.display = "block";
          activeCount.textContent = activeInsurances.length;

          activeList.innerHTML = activeInsurances
            .map((ins, idx) => {
              const pkg = insurancePackages.find((p) => p.id === ins.packageId);
              if (!pkg) return "";

              const periodText =
                ins.period === "hour"
                  ? t.perHour || "/godz"
                  : ins.period === "day"
                  ? t.perDay || "/dzieÅ„"
                  : t.perWeek || "/tydzieÅ„";

              const remaining = ins.nextPaymentAt - Date.now();
              const hoursLeft = Math.max(
                0,
                Math.floor(remaining / (60 * 60 * 1000))
              );
              const minsLeft = Math.max(
                0,
                Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000))
              );

              return `
                        <div style="background:rgba(74,222,128,0.1);border:1px solid #4ade80;border-radius:8px;padding:8px;margin-bottom:5px;display:flex;justify-content:space-between;align-items:center;">
                            <div>
                                <div style="font-weight:bold;font-size:0.9em;">${
                                  pkg.icon
                                } ${getInsuranceName(pkg)}</div>
                                <div style="font-size:0.75em;color:#888;">${ins.price.toLocaleString()} ${getCurrency()} ${periodText}</div>
                                <div style="font-size:0.7em;color:#aaa;">â±ï¸ ${hoursLeft}h ${minsLeft}m | ${
                ins.autoPay ? "âœ…" : "âŒ"
              } Auto</div>
                            </div>
                            <button onclick="showInsuranceDetails(${idx})" style="padding:5px 10px;background:#ff6b35;color:white;border:none;border-radius:5px;font-size:0.8em;cursor:pointer;">ğŸ“‹</button>
                        </div>
                    `;
            })
            .join("");
        } else {
          activeSection.style.display = "none";
        }

        // Lista pakietÃ³w do kupienia
        list.innerHTML = insurancePackages
          .map((pkg) => {
            const isOwned = activeInsurances.some(
              (i) => i.packageId === pkg.id
            );

            return `
                <div class="garage-item" onclick="${
                  isOwned ? "" : `showInsurancePeriods('${pkg.id}')`
                }" style="${
              isOwned ? "opacity:0.5;cursor:default;border-color:#4ade80;" : ""
            }">
                    <div>
                        <div class="car-name">${pkg.icon} ${getInsuranceName(
              pkg
            )}</div>
                        <div style="font-size:0.75em;color:#aaa;">${getInsuranceDesc(
                          pkg
                        )} co ${pkg.interval} min</div>
                    </div>
                    <div style="text-align:right;font-size:0.75em;">
                        <div style="color:#ff6b35;">${
                          pkg.prices.hour
                        } zÅ‚<span style="color:#666;">/h</span></div>
                        <div style="color:#ff6b35;">${
                          pkg.prices.day
                        } zÅ‚<span style="color:#666;">/d</span></div>
                        <div style="color:#ff6b35;">${
                          pkg.prices.week
                        } zÅ‚<span style="color:#666;">/tyg</span></div>
                        ${
                          isOwned
                            ? '<div style="color:#4ade80;margin-top:2px;">âœ…</div>'
                            : ""
                        }
                    </div>
                </div>
            `;
          })
          .join("");
      }

      function showInsurancePeriods(packageId) {
        selectedInsurancePackage = insurancePackages.find(
          (p) => p.id === packageId
        );
        if (!selectedInsurancePackage) return;

        const pkg = selectedInsurancePackage;
        const t = translations[currentLang] || translations.en;

        document.getElementById("insurancePeriodDetails").innerHTML = `
                <div style="font-size:2em;">${pkg.icon}</div>
                <div style="font-weight:bold;font-size:1.2em;">${getInsuranceName(
                  pkg
                )}</div>
                <div style="color:#aaa;font-size:0.9em;">${getInsuranceDesc(
                  pkg
                )} co ${pkg.interval} min</div>
            `;

        document.getElementById("periodOptions").innerHTML = `
                <button onclick="buyInsurance('hour')" style="padding:15px;background:linear-gradient(145deg,#10b981,#059669);color:white;border:none;border-radius:10px;font-size:1em;cursor:pointer;display:flex;justify-content:space-between;align-items:center;">
                    <span>â° ${t.hour || "Godzina"}</span>
                    <span style="font-weight:bold;">${pkg.prices.hour.toLocaleString()} ${getCurrency()}</span>
                </button>
                <button onclick="buyInsurance('day')" style="padding:15px;background:linear-gradient(145deg,#3b82f6,#2563eb);color:white;border:none;border-radius:10px;font-size:1em;cursor:pointer;display:flex;justify-content:space-between;align-items:center;">
                    <span>ğŸ“… ${t.day || "DzieÅ„"}</span>
                    <span style="font-weight:bold;">${pkg.prices.day.toLocaleString()} ${getCurrency()}</span>
                </button>
                <button onclick="buyInsurance('week')" style="padding:15px;background:linear-gradient(145deg,#8b5cf6,#7c3aed);color:white;border:none;border-radius:10px;font-size:1em;cursor:pointer;display:flex;justify-content:space-between;align-items:center;">
                    <span>ğŸ“† ${t.week || "TydzieÅ„"}</span>
                    <span style="font-weight:bold;">${pkg.prices.week.toLocaleString()} ${getCurrency()}</span>
                </button>
            `;

        openModal("insurancePeriod");
      }

      function buyInsurance(period) {
        if (!selectedInsurancePackage) return;

        const pkg = selectedInsurancePackage;
        let price, duration;

        if (period === "hour") {
          price = pkg.prices.hour;
          duration = 60 * 60 * 1000; // 1 godzina
        } else if (period === "day") {
          price = pkg.prices.day;
          duration = 24 * 60 * 60 * 1000; // 1 dzieÅ„
        } else {
          price = pkg.prices.week;
          duration = 7 * 24 * 60 * 60 * 1000; // 1 tydzieÅ„
        }

        if (money < price) {
          alert(
            translations[currentLang].notEnoughMoney ||
              "Nie masz wystarczajÄ…co pieniÄ™dzy!"
          );
          return;
        }

        // SprawdÅº czy juÅ¼ ma to ubezpieczenie
        if (activeInsurances.some((i) => i.packageId === pkg.id)) {
          alert(
            translations[currentLang].alreadyHaveInsurance ||
              "JuÅ¼ masz to ubezpieczenie!"
          );
          return;
        }

        money -= price;
        activeInsurances.push({
          packageId: pkg.id,
          period: period,
          price: price,
          totalPaid: price,
          benefitCount: 0,
          autoPay: true,
          startedAt: Date.now(),
          lastBenefitAt: Date.now(),
          nextPaymentAt: Date.now() + duration,
        });

        playSound("insurance");
        saveState();
        updateAllDisplays();
        closeModal("insurancePeriod");
        renderInsuranceList();

        const t = translations[currentLang] || translations.en;
        alert(`ğŸ¥ ${getInsuranceName(pkg)} - ${t.activated || "Aktywowane"}!`);
      }

      function showInsuranceDetails(index) {
        if (index < 0 || index >= activeInsurances.length) return;

        const ins = activeInsurances[index];
        const pkg = insurancePackages.find((p) => p.id === ins.packageId);
        if (!pkg) return;

        const t = translations[currentLang] || translations.en;
        const periodText =
          ins.period === "hour"
            ? t.perHour || "/godz"
            : ins.period === "day"
            ? t.perDay || "/dzieÅ„"
            : t.perWeek || "/tydzieÅ„";

        const remaining = ins.nextPaymentAt - Date.now();
        const daysLeft = Math.floor(remaining / (24 * 60 * 60 * 1000));
        const hoursLeft = Math.floor(
          (remaining % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000)
        );
        const minsLeft = Math.floor(
          (remaining % (60 * 60 * 1000)) / (60 * 1000)
        );

        // Oblicz zwrot (10% jeÅ›li uÅ¼yto 3+ razy)
        const refund =
          ins.benefitCount >= 3 ? Math.floor(ins.totalPaid * 0.1) : 0;

        document.getElementById("insuranceDetailsContent").innerHTML = `
                <div style="text-align:center;margin-bottom:20px;">
                    <div style="font-size:3em;">${pkg.icon}</div>
                    <div style="font-weight:bold;font-size:1.3em;">${getInsuranceName(
                      pkg
                    )}</div>
                    <div style="color:#aaa;">${getInsuranceDesc(pkg)} co ${
          pkg.interval
        } min</div>
                </div>
                
                <div style="background:rgba(0,0,0,0.2);border-radius:10px;padding:15px;margin-bottom:15px;">
                    <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                        <span>${t.price || "Cena"}:</span>
                        <span style="color:#ff6b35;font-weight:bold;">${ins.price.toLocaleString()} ${getCurrency()} ${periodText}</span>
                    </div>
                    <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                        <span>${t.totalPaid || "ZapÅ‚acono Å‚Ä…cznie"}:</span>
                        <span>${ins.totalPaid.toLocaleString()} ${getCurrency()}</span>
                    </div>
                    <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                        <span>${
                          t.benefitsReceived || "Otrzymane korzyÅ›ci"
                        }:</span>
                        <span>${ins.benefitCount}x</span>
                    </div>
                    <div style="display:flex;justify-content:space-between;">
                        <span>${t.nextPayment || "NastÄ™pna pÅ‚atnoÅ›Ä‡"}:</span>
                        <span>${
                          daysLeft > 0 ? daysLeft + "d " : ""
                        }${hoursLeft}h ${minsLeft}m</span>
                    </div>
                </div>
                
                <div class="tax-toggle" style="margin-bottom:15px;">
                    <div>
                        <strong>${t.autoPay || "Automatyczne pÅ‚acenie"}</strong>
                    </div>
                    <div class="toggle-switch ${
                      ins.autoPay ? "active" : ""
                    }" onclick="toggleInsuranceAutoPay(${index})"></div>
                </div>
                
                <button onclick="cancelInsurance(${index})" style="width:100%;padding:12px;background:#ef4444;color:white;border:none;border-radius:10px;font-size:1em;cursor:pointer;">
                    âŒ ${t.cancelInsurance || "Zrezygnuj"} ${
          refund > 0
            ? `(${
                t.refund || "zwrot"
              }: ${refund.toLocaleString()} ${getCurrency()})`
            : `(${t.noRefund || "brak zwrotu"})`
        }
                </button>
            `;

        openModal("insuranceDetails");
      }

      function toggleInsuranceAutoPay(index) {
        if (index < 0 || index >= activeInsurances.length) return;
        activeInsurances[index].autoPay = !activeInsurances[index].autoPay;
        saveState();
        showInsuranceDetails(index);
        updateCardDisplay();
      }

      function cancelInsurance(index) {
        if (index < 0 || index >= activeInsurances.length) return;

        const ins = activeInsurances[index];
        const pkg = insurancePackages.find((p) => p.id === ins.packageId);
        const t = translations[currentLang] || translations.en;

        // Oblicz zwrot
        const refund =
          ins.benefitCount >= 3 ? Math.floor(ins.totalPaid * 0.1) : 0;

        const confirmMsg =
          refund > 0
            ? `${
                t.confirmCancelWithRefund || "ZrezygnowaÄ‡? Zwrot"
              }: ${refund.toLocaleString()} ${getCurrency()}`
            : t.confirmCancelNoRefund ||
              "ZrezygnowaÄ‡? Brak zwrotu (uÅ¼yto mniej niÅ¼ 3 razy)";

        if (confirm(confirmMsg)) {
          if (refund > 0) {
            money += refund;
          }
          activeInsurances.splice(index, 1);
          saveState();
          updateAllDisplays();
          closeModal("insuranceDetails");
          renderInsuranceList();
        }
      }

      function checkInsuranceBenefits() {
        const now = Date.now();
        let needsSave = false;

        for (let i = activeInsurances.length - 1; i >= 0; i--) {
          const ins = activeInsurances[i];
          const pkg = insurancePackages.find((p) => p.id === ins.packageId);
          if (!pkg) continue;

          // SprawdÅº czy czas na pÅ‚atnoÅ›Ä‡
          if (now >= ins.nextPaymentAt) {
            let duration;
            if (ins.period === "hour") duration = 60 * 60 * 1000;
            else if (ins.period === "day") duration = 24 * 60 * 60 * 1000;
            else duration = 7 * 24 * 60 * 60 * 1000;

            if (ins.autoPay) {
              // Auto-pay: pÅ‚aÄ‡ lub idÅº na dÅ‚ug, ale ZAWSZE kontynuuj ubezpieczenie
              if (money >= ins.price) {
                money -= ins.price;
                ins.totalPaid += ins.price;
              } else {
                // Nie ma kasy - pÅ‚aÄ‡ ile moÅ¼esz, reszta na dÅ‚ug
                const paid = money;
                money = 0;
                ins.totalPaid += paid;
                addDebt(ins.price - paid);
              }
              ins.nextPaymentAt = now + duration;
              needsSave = true;
            } else {
              // Nie auto-pay = dÅ‚ug i usuÅ„ ubezpieczenie
              addDebt(ins.price);
              activeInsurances.splice(i, 1);
              needsSave = true;
              continue;
            }
          }

          // Przyznaj korzyÅ›ci
          const intervalMs = pkg.interval * 60 * 1000;
          if (now - ins.lastBenefitAt >= intervalMs) {
            if (pkg.benefits.hp > 0)
              health = Math.min(MAX_HEALTH, health + pkg.benefits.hp);
            if (pkg.benefits.kcal > 0)
              food = Math.min(MAX_FOOD, food + pkg.benefits.kcal);
            if (pkg.benefits.ml > 0)
              water = Math.min(MAX_WATER, water + pkg.benefits.ml);

            ins.lastBenefitAt = now;
            ins.benefitCount++;
            needsSave = true;
          }
        }

        if (needsSave) {
          saveState();
          updateAllDisplays();
        }
      }

      function startInsuranceTimer() {
        setInterval(checkInsuranceBenefits, 60 * 1000);
      }

      // ==================== WYÅšWIETLANIE ====================
      function updateAllDisplays() {
        updateMoneyDisplay();
        updateCardDisplay();
        updateDebtDisplay();
        updateTaxDisplay();
        updateStatusBars();
      }

      function updateStatusBars() {
        // Zdrowie
        const healthPercent = (health / MAX_HEALTH) * 100;
        document.getElementById("healthBar").style.width = healthPercent + "%";
        document.getElementById(
          "healthValue"
        ).textContent = `${health}/${MAX_HEALTH}`;

        // Jedzenie
        const foodPercent = (food / MAX_FOOD) * 100;
        document.getElementById("foodBar").style.width = foodPercent + "%";
        document.getElementById(
          "foodValue"
        ).textContent = `${food}/${MAX_FOOD} kcal`;

        // Picie
        const waterPercent = (water / MAX_WATER) * 100;
        document.getElementById("waterBar").style.width = waterPercent + "%";
        document.getElementById(
          "waterValue"
        ).textContent = `${water}/${MAX_WATER} ml`;
      }

      function updateInventoryDisplay() {
        document.getElementById(
          "invHealth"
        ).textContent = `${health}/${MAX_HEALTH} HP`;
        document.getElementById(
          "invFood"
        ).textContent = `${food}/${MAX_FOOD} kcal`;
        document.getElementById(
          "invWater"
        ).textContent = `${water}/${MAX_WATER} ml`;
      }

      function showShopTab(tab) {
        currentShopTab = tab;
        document
          .querySelectorAll("#modalShop .inv-tab")
          .forEach((t) => t.classList.remove("active"));
        event.target.classList.add("active");
        renderShopItems();
      }

      // SKLEP - kupowanie do plecaka
      function renderShopItems() {
        const grid = document.getElementById("shopGrid");
        const items = currentShopTab === "food" ? foodItems : drinkItems;

        grid.innerHTML = items
          .map(
            (item) => `
                <div class="shop-item" onclick="buyToBackpack('${
                  item.id
                }', '${currentShopTab}')">
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-name">${getItemName(item)}</div>
                    <div class="item-stats">
                        ${
                          item.kcal > 0
                            ? `<span class="positive">+${item.kcal} kcal</span><br>`
                            : ""
                        }
                        ${
                          item.ml > 0
                            ? `<span class="positive">+${item.ml} ml</span><br>`
                            : ""
                        }
                        ${
                          item.hp > 0
                            ? `<span class="positive">+${item.hp} HP</span>`
                            : ""
                        }
                        ${
                          item.hp < 0
                            ? `<span class="negative">${item.hp} HP</span>`
                            : ""
                        }
                    </div>
                    <div class="item-price">${item.price} zÅ‚</div>
                </div>
            `
          )
          .join("");
      }

      function buyToBackpack(itemId, type) {
        const items = type === "food" ? foodItems : drinkItems;
        const item = items.find((i) => i.id === itemId);
        if (!item) return;

        if (money < item.price) {
          alert(
            translations[currentLang].notEnoughMoney ||
              "Nie masz wystarczajÄ…co pieniÄ™dzy!"
          );
          return;
        }

        // Kup i dodaj do plecaka
        money -= item.price;
        backpack.push({ ...item, type: type });

        playSound("buy");
        saveState();
        updateAllDisplays();

        alert(`${item.icon} ${getItemName(item)} â†’ ğŸ’`);
      }

      // EKWIPUNEK - zawartoÅ›Ä‡ plecaka
      function renderBackpack() {
        const grid = document.getElementById("backpackGrid");
        const empty = document.getElementById("emptyBackpack");

        if (backpack.length === 0) {
          grid.style.display = "none";
          empty.style.display = "block";
          return;
        }

        grid.style.display = "grid";
        empty.style.display = "none";

        // Grupuj przedmioty
        const grouped = {};
        backpack.forEach((item, index) => {
          if (!grouped[item.id]) {
            grouped[item.id] = { ...item, count: 0, indices: [] };
          }
          grouped[item.id].count++;
          grouped[item.id].indices.push(index);
        });

        grid.innerHTML = Object.values(grouped)
          .map((item) => {
            // SprawdÅº czy moÅ¼na uÅ¼yÄ‡
            const foodPercent = (food / MAX_FOOD) * 100;
            const waterPercent = (water / MAX_WATER) * 100;
            const canUse =
              (item.kcal > 0 && foodPercent < 98) ||
              (item.ml > 0 && waterPercent < 98) ||
              (item.kcal === 0 && item.ml === 0);
            const blocked = !canUse;

            return `
                <div class="shop-item ${blocked ? "blocked" : ""}" onclick="${
              blocked ? "" : `useItem('${item.id}')`
            }" style="${blocked ? "opacity:0.5;cursor:not-allowed;" : ""}">
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-name">${getItemName(item)} ${
              item.count > 1
                ? `<span style="color:#ff6b35;">x${item.count}</span>`
                : ""
            }</div>
                    <div class="item-stats">
                        ${
                          item.kcal > 0
                            ? `<span class="positive">+${item.kcal} kcal</span><br>`
                            : ""
                        }
                        ${
                          item.ml > 0
                            ? `<span class="positive">+${item.ml} ml</span><br>`
                            : ""
                        }
                        ${
                          item.hp > 0
                            ? `<span class="positive">+${item.hp} HP</span>`
                            : ""
                        }
                        ${
                          item.hp < 0
                            ? `<span class="negative">${item.hp} HP</span>`
                            : ""
                        }
                    </div>
                    ${
                      blocked
                        ? `<div style="color:#f87171;font-size:0.8em;margin-top:5px;">â›” ${
                            translations[currentLang].tooFull || "JesteÅ› peÅ‚ny!"
                          }</div>`
                        : `<div style="color:#4ade80;font-size:0.85em;margin-top:5px;">â–¶ ${
                            translations[currentLang].useItem || "UÅ¼yj"
                          }</div>`
                    }
                </div>
            `;
          })
          .join("");
      }

      function useItem(itemId) {
        const index = backpack.findIndex((i) => i.id === itemId);
        if (index === -1) return;

        const item = backpack[index];

        // SprawdÅº czy moÅ¼na uÅ¼yÄ‡ (pasek < 98%)
        const foodPercent = (food / MAX_FOOD) * 100;
        const waterPercent = (water / MAX_WATER) * 100;

        if (item.kcal > 0 && foodPercent >= 98) {
          alert(
            translations[currentLang].foodFull || "Nie moÅ¼esz wiÄ™cej jeÅ›Ä‡!"
          );
          return;
        }
        if (item.ml > 0 && waterPercent >= 98) {
          alert(
            translations[currentLang].waterFull || "Nie moÅ¼esz wiÄ™cej piÄ‡!"
          );
          return;
        }

        // UÅ¼yj przedmiotu
        food = Math.min(food + item.kcal, MAX_FOOD);
        water = Math.min(water + item.ml, MAX_WATER);
        health = Math.max(0, Math.min(health + item.hp, MAX_HEALTH));

        // DÅºwiÄ™k
        if (item.ml > 0) {
          playSound("drink");
        } else {
          playSound("eat");
        }

        // UsuÅ„ z plecaka
        backpack.splice(index, 1);

        saveState();
        updateAllDisplays();
        updateInventoryDisplay();
        renderBackpack();

        let effectText = "";
        if (item.kcal > 0) effectText += `+${item.kcal} kcal `;
        if (item.ml > 0) effectText += `+${item.ml} ml `;
        if (item.hp > 0) effectText += `+${item.hp} HP`;
        if (item.hp < 0) effectText += `${item.hp} HP`;

        alert(`${item.icon} ${getItemName(item)}\n${effectText}`);
      }

      function formatCurrency(amount) {
        const symbol = currentLang === "en" ? "$" : "zÅ‚";
        return amount.toLocaleString() + " " + symbol;
      }

      function getCurrency() {
        return currentLang === "en" ? "$" : "zÅ‚";
      }

      function updateMoneyDisplay() {
        const display = document.getElementById("moneyDisplay");
        display.textContent = formatCurrency(money);
        display.classList.toggle("low", money < 5000);
      }

      function updateCardDisplay() {
        document.getElementById("cardCode").textContent = cardCode;
        document.getElementById("cardBalance").textContent =
          formatCurrency(money);
        document.getElementById("limitValue").textContent =
          formatCurrency(limit);
        document.getElementById("spentValue").textContent =
          formatCurrency(spent);
        document.getElementById("remainingValue").textContent = formatCurrency(
          limit - spent
        );
        document.getElementById("limitBar").style.width =
          Math.min((spent / limit) * 100, 100) + "%";

        // Lista ubezpieczeÅ„ na karcie
        const listEl = document.getElementById("insuranceAutoPayList");
        const noInsEl = document.getElementById("noInsurancesCard");
        const t = translations[currentLang] || translations.en;

        if (activeInsurances.length > 0) {
          noInsEl.style.display = "none";
          listEl.innerHTML = activeInsurances
            .map((ins, idx) => {
              const pkg = insurancePackages.find((p) => p.id === ins.packageId);
              if (!pkg) return "";

              const periodText =
                ins.period === "day"
                  ? t.perDay || "/d"
                  : ins.period === "week"
                  ? t.perWeek || "/tyg"
                  : t.perMonth || "/mies";

              return `
                        <div class="tax-toggle" style="margin-bottom:8px;padding:8px;background:rgba(0,0,0,0.2);border-radius:8px;">
                            <div>
                                <strong style="font-size:0.9em;">${
                                  pkg.icon
                                } ${getInsuranceName(pkg)}</strong>
                                <p style="font-size:0.7em;color:#888;margin:0;">${
                                  ins.price
                                } zÅ‚ ${periodText}</p>
                            </div>
                            <div class="toggle-switch ${
                              ins.autoPay ? "active" : ""
                            }" onclick="toggleInsuranceAutoPayFromCard(${idx})"></div>
                        </div>
                    `;
            })
            .join("");
        } else {
          noInsEl.style.display = "block";
          listEl.innerHTML = "";
        }
      }

      function toggleInsuranceAutoPayFromCard(index) {
        if (index < 0 || index >= activeInsurances.length) return;
        activeInsurances[index].autoPay = !activeInsurances[index].autoPay;
        saveState();
        updateCardDisplay();
      }

      function updateDebtDisplay() {
        const debtDisplay = document.getElementById("debtDisplay");

        if (debt > 0) {
          debtDisplay.classList.add("active");
          document.getElementById("debtAmount").textContent =
            debt.toLocaleString() + " " + getCurrency();

          if (debtDeadline) {
            const daysLeft = Math.ceil(
              (new Date(debtDeadline) - new Date()) / (1000 * 60 * 60 * 24)
            );
            document.getElementById(
              "debtDeadline"
            ).textContent = `${daysLeft} ${
              translations[currentLang].daysLeft || "dni do spÅ‚aty"
            }`;
          }

          document.getElementById("currentDebt").textContent =
            debt.toLocaleString() + " " + getCurrency();
          document.getElementById("payDebtBtn").style.display = "block";
        } else {
          debtDisplay.classList.remove("active");
          document.getElementById("currentDebt").textContent = "0 zÅ‚";
          document.getElementById("payDebtBtn").style.display = "none";
        }
      }

      function updateTaxDisplay() {
        document.getElementById("totalTaxPaid").textContent =
          totalTaxPaid.toLocaleString() + " " + getCurrency();
        document
          .getElementById("autoPayToggle")
          .classList.toggle("active", autoPay);
      }

      // ==================== MODALS ====================
      function openModal(type) {
        document
          .getElementById(
            "modal" + type.charAt(0).toUpperCase() + type.slice(1)
          )
          .classList.add("active");

        if (type === "card") updateCardDisplay();
        if (type === "tax") {
          updateTaxDisplay();
          updateDebtDisplay();
        }
        if (type === "pin") {
          currentPin = "";
          updatePinDisplay();
        }
        if (type === "sell") {
          renderGarage();
        }
        if (type === "buy") {
          carSearchQuery = "";
          document.getElementById("carSearchInput").value = "";
          renderCarBuyList();
        }
        if (type === "earn") initEarnInputs();
        if (type === "repair") {
          selectedRepairCarIndex = null;
          renderRepairCarList();
        }
        if (type === "shop") {
          currentShopTab = "food";
          renderShopItems();
          document
            .querySelectorAll("#modalShop .inv-tab")
            .forEach((t, i) => t.classList.toggle("active", i === 0));
        }
        if (type === "inventory") {
          updateInventoryDisplay();
          renderBackpack();
        }
        if (type === "insurance") {
          renderInsuranceList();
        }
        if (type === "saves") {
          renderSavesList();
        }
        if (type === "vouchers") {
          renderVouchersList();
        }
        if (type === "garage") {
          renderGarageModal();
        }
        if (type === "work") {
          renderJobsList();
        }
      }

      function closeModal(type) {
        document
          .getElementById(
            "modal" + type.charAt(0).toUpperCase() + type.slice(1)
          )
          .classList.remove("active");
      }

      function resetUploadForm(type) {
        const fileEl = document.getElementById(type + "File");
        const previewEl = document.getElementById(type + "Preview");
        const uploadEl = document.getElementById(type + "Upload");
        const responseEl = document.getElementById(type + "Response");
        const btnEl = document.getElementById(type + "Btn");

        if (fileEl) fileEl.value = "";
        if (previewEl) previewEl.style.display = "none";
        if (uploadEl) uploadEl.style.display = "block";
        if (responseEl) responseEl.classList.remove("active");
        if (btnEl) btnEl.classList.remove("active");
      }

      // ==================== PIN ====================
      function updatePinDisplay() {
        for (let i = 1; i <= 6; i++) {
          const digit = document.getElementById("pin" + i);
          digit.textContent = currentPin.length >= i ? "â—" : "";
          digit.classList.toggle("filled", currentPin.length >= i);
        }
      }

      function addPinDigit(d) {
        if (currentPin.length < 6) {
          currentPin += d;
          updatePinDisplay();
        }
      }
      function deletePinDigit() {
        currentPin = currentPin.slice(0, -1);
        updatePinDisplay();
      }

      function confirmPin() {
        if (currentPin === pin) {
          if (pendingAction === "resetLimit") {
            spent = 0;
            saveState();
            updateCardDisplay();
            alert("âœ…");
          } else if (pendingAction === "setLimit") {
            const newLimit = parseInt(
              document.getElementById("newLimitInput").value
            );
            if (newLimit >= 100) {
              limit = newLimit;
              saveState();
              updateCardDisplay();
              alert("âœ…");
            }
          } else if (pendingAction === "repair") {
            money -= REPAIR_COST;
            spent += REPAIR_COST;
            saveState();
            updateAllDisplays();
            alert(`ğŸ”§ -5,000 ${getCurrency()}`);
            closeModal("repair");
          } else if (pendingAction === "buy") {
            money -= currentBuyPrice;
            spent += currentBuyPrice;
            saveState();
            updateAllDisplays();
            alert(`ğŸš™ -${currentBuyPrice.toLocaleString()} ${getCurrency()}`);
            closeModal("buy");
          }
          pendingAction = null;
          closeModal("pin");
        } else {
          alert("âŒ PIN");
          currentPin = "";
          updatePinDisplay();
        }
      }

      function setNewLimit() {
        const newLimit = parseInt(
          document.getElementById("newLimitInput").value
        );
        if (newLimit >= 100) {
          pendingAction = "setLimit";
          closeModal("setLimit");
          openModal("pin");
        } else {
          alert("âŒ Min. 100 zÅ‚");
        }
      }

      // ==================== JÄ˜ZYKI =========================
      function generateLangGrid() {
        const grid = document.getElementById("langGrid");
        grid.innerHTML = "";
        Object.entries(languages).forEach(([code, lang]) => {
          const option = document.createElement("div");
          option.className =
            "lang-option" + (code === currentLang ? " selected" : "");
          option.innerHTML = `${lang.flag} ${lang.name}`;
          option.onclick = () => {
            currentLang = code;
            saveState();
            applyLanguage();
            updateAllDisplays();
            generateLangGrid();
            closeModal("language");
          };
          grid.appendChild(option);
        });
      }

      function applyLanguage() {
        const trans = translations[currentLang] || translations.en;
        document.querySelectorAll("[data-translate]").forEach((el) => {
          if (trans[el.getAttribute("data-translate")]) {
            el.textContent = trans[el.getAttribute("data-translate")];
          }
        });
      }

      // ==================== DRAG & DROP ====================
      ["repair", "sell"].forEach((type) => {
        const area = document.getElementById(type + "Upload");
        if (!area) return;
        area.addEventListener("dragover", (e) => {
          e.preventDefault();
          area.classList.add("dragover");
        });
        area.addEventListener("dragleave", () =>
          area.classList.remove("dragover")
        );
        area.addEventListener("drop", (e) => {
          e.preventDefault();
          area.classList.remove("dragover");
          const file = e.dataTransfer.files[0];
          if (file?.type.startsWith("image/")) {
            const input = document.getElementById(type + "File");
            const dt = new DataTransfer();
            dt.items.add(file);
            input.files = dt.files;
            if (type === "repair") analyzeRepairImage(input);
            else if (type === "sell") startSellQR(input);
          }
        });
      });

      // Background tax
      document.addEventListener("visibilitychange", () => {
        if (!document.hidden) {
          checkMissedTaxes();
          updateAllDisplays();
        }
      });
      window.addEventListener("beforeunload", saveState);

      // START - sprawdÅº czy to strona weryfikatora
      if (!checkIfVerifier()) {
        init();
      }
    </script>
  </body>
</html>
